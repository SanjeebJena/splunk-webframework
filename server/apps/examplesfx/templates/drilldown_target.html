{% extends "splunkdj:base_with_app_bar.html" %}

{% load splunkmvc %}

{% block title %}{{app_name}} Home Page{% endblock title %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}splunkjs/css/dashboard.css">
{% endblock css %}

{% block content %}

<div class="dashboard-body container-fluid main-section-body" data-role="main">
    <div class="row">
        <div class="span12 dashboard-header clearfix">
            <h2>Drilldown - the target page</h2>
        </div>
    </div>
    <div class="dashboard-row">
        <div class="dashboard-cell" style="width: 100%;">
            <div class="dashboard-panel">
                <div class="dashboard-element">
                    <div class="panel-head">
                    </div>
                    <div class="panel-body">
                        <p>This page is the target of the drilldown example. When you
                        clicked on the table, we navigated here. You can see in the
                        code how we use the <code>mvc.loadDrilldown</code> helper
                        to load the drilldown parameters, and then we start the searches.
                        At this point, everything is operating as it normally would,
                        and you can interact with the components as you would normally.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dashboard-row">
        <div class="dashboard-cell" style="width: 50%;">
            <div class="dashboard-panel">
                <div class="dashboard-element">
                    <div class="panel-head">
                        <h3>Chart 1</h3>
                    </div>
                    <div class="panel-body">
                        {% chart id="chart1" managerid="search1" type="line" %}
                    </div>
                </div>
            </div>
        </div>
        <div class="dashboard-cell" style="width: 50%;">
            <div class="dashboard-panel">
                <div class="dashboard-element">
                    <div class="panel-head">
                        <h3>Chart 2</h3>
                    </div>
                    <div class="panel-body">
                        {% chart id="chart2" managerid="search2" type="line" %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dashboard-row">
        <div class="dashboard-cell" style="width: 100%;">
            <div class="dashboard-panel">
                <div class="dashboard-element">
                    <div class="panel-head">
                        <h3>My Table</h3>
                    </div>
                    <div class="panel-body">
                        {% resulttable id="table1" managerid="search1" %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content%}

{% block managers %}
    {% searchmanager id="search1" search="index=_internal sourcetype=$sourcetype$ | timechart count" 
        preview=True cache=60 status_buckets=300 autostart=False %}
        
    {% searchmanager id="search2" search="index=_internal source=$source$ | head 1000 | timechart count" 
        preview=True cache=60 status_buckets=300 autostart=False %}
{% endblock managers %}

{% block js %}
<script>
    require(["splunkjs/ready!"], function(mvc) {
        // Since we know this page is the target of a drilldown, we can just use the
        // drilldown helper to load the information that is encoded in the URL.
        mvc.loadDrilldown(); 
        
        var search1 = mvc.Components.getInstance("search1");
        var search2 = mvc.Components.getInstance("search2");
        
        // Since we told the managers to not autostart, after the drilldown,
        // we need to start them.
        search1.startSearch();
        search2.startSearch();
    });
</script>
{% endblock js %}
