define("util/xml_utils",["jquery","underscore"],function(e,t){function n(t){var n=e.parseXML(t);return e(n.childNodes[0])}function r(t){var n=e.parseXML("<x></x>");return n.createCDATASection(t)}function i(t){var n,r,s=5,o=t.TEXT_NODE||3;while(s--)for(n=0;n<t.childNodes.length;n++)r=t.childNodes[n],r!==undefined&&(r.nodeType===o?/^\s*$/.test(r.nodeValue)?t.removeChild(r):r.nodeValue=e.trim(r.nodeValue):(r.nodeType===t.ELEMENT_NODE||r.nodeType===t.DOCUMENT_NODE)&&i(r))}function o(e){var t=["\n"],n=e;while(n--)t.push(s);return t.join("")}function u(e,n,r){if(!n||!n.childNodes)return;var i=n.TEXT_NODE||3;for(var s=0;s<=n.childNodes.length;s++){var a=n.childNodes[s-1],f=n.childNodes[s];f&&f.nodeType!==i&&(!a||a.nodeType!==i)&&n.insertBefore(e.createTextNode(o(r)),f),s===n.childNodes.length&&a&&a.nodeType!==i&&n.appendChild(e.createTextNode(o(r-1)))}t.chain(n.childNodes).filter(function(e){return e.nodeType===n.ELEMENT_NODE}).each(function(t){u(e,t,r+1)})}function a(e){return i(e[0]),u(e[0],e[0].childNodes[0],1),e}function f(t){return t instanceof e&&(t=t[0]),Object.prototype.hasOwnProperty.call(t,"xml")?t.xml:(new XMLSerializer).serializeToString(t)}var s="	";return{$node:n,cdata:r,stripEmptyTextNodes:i,formatXMLDocument:a,serialize:f}}),define("models/Dashboard",["jquery","underscore","splunk.util","models/services/data/ui/View","util/xml_utils","models/Base"],function(e,t,n,r,i,s){var o="html",u="chart",a="event",f="single",l="table",c=[u,a,f,l],h=s.extend({constructor:function(e){this._dash=e,s.prototype.constructor.call(this)},validation:{label:{required:!0,msg:t("No Title specified").t()}},apply:function(){this._dash._applyMetadata(this.toJSON())},save:function(){return arguments.length&&this.set.apply(this,arguments),this._dash._applyMetadata(this.toJSON()),this._dash.save.apply(this._dash,arguments)},fetch:function(){var t=this._dash._extractMetadata();this.set(t);var n=e.Deferred();return n.resolve(this),n}}),p=r.extend({initialize:function(e,t){r.prototype.initialize.apply(this,arguments),this.indent=(t||{}).indent!==!1},initializeAssociated:function(){r.prototype.initializeAssociated.apply(this,arguments);var e=this.meta=new h(this);this.entry.content.on("change:eai:data",function(){e.fetch()},this),e.fetch()},associatedOff:function(e,t,n){r.prototype.associatedOff.apply(this,arguments),this.meta.off(e,t,n)},get$XML:function(){var t=this.isXML()&&this.entry.content.get("eai:data")||"<dashboard/>",n=e.parseXML(t);return e(n).find("script").remove(),e(n)},set$XML:function(e){var t=i.serialize(this.indent?i.formatXMLDocument(e):e);this.setXML(t)},setXML:function(e){this.entry.content.set("eai:data",e),this.entry.content.set("eai:type","views")},_extractMetadata:function(){var e=this.isXML(),t=e?this.get$XML():null;return{label:e&&t.find(":eq(0) > label").text()||this.entry.get("name"),description:e&&t.find(":eq(0) > description").text()||""}},_applyMetadata:function(e){var t=this.get$XML(),n=t.find(":eq(0) > label"),r=t.find(":eq(0) > description"),s=e.label,o=e.description;s!==undefined&&s!==null&&(n.length||(n=i.$node("<label/>"),t.find(":eq(0)").prepend(n)),n.text(s)),o!==undefined&&o!==null&&(o!==undefined&&o!==""||!r.length?r.length||(r=i.$node("<description/>"),n.length?r.insertAfter(n):t.find(":eq(0)").prepend(r)):r.remove(),r.text(o)),this.set$XML(t)},getLabel:function(){var e=this.meta.get("label");return e===undefined?"":e},setLabel:function(e){this.setLabelAndDescription(e,undefined)},getDescription:function(){return this.meta.get("description")},setDescription:function(e){this.setLabelAndDescription(undefined,e)},setLabelAndDescription:function(e,t){this._applyMetadata({label:e,description:t})},get$Rows:function(){var e=this.get$XML();return e.find(":eq(0) > row")},appendNewPanel:function(n,r){var s=t.indexOf(c,n)!=-1,u=n===o,a,f;if(s||u){s?a=t.template(this.nonHTMLPanelTemplate,{panelType:n,properties:r}):a=t.template(this.HTMLPanelTemplate,{properties:r}),f=this.get$XML();var l=i.$node("<row/>");e(l).append(i.$node(a)),f.find(":eq(0)").append(l),this.set$XML(f)}},nonHTMLPanelTemplate:'                <<%- panelType %>>                    <% if (properties.title) { %>                        <title><%- properties.title %></title>                    <% } %>                    <% if (properties.searchString) { %>                        <searchString><%- properties.searchString %></searchString>                        <% if (properties.earliestTime) { %>                            <earliestTime><%- properties.earliestTime %></earliestTime>                        <% } %>                        <% if (properties.latestTime) { %>                            <latestTime><%- properties.latestTime %></latestTime>                        <% } %>                    <% } else if (properties.pivotSearch) { %>                        <pivotSearch>                            <model><%= properties.pivotSearch.model %></model>                            <object><%= properties.pivotSearch.object %></object>                            <filters><%= properties.pivotSearch.filters %></filters>                            <cells><%= properties.pivotSearch.cells %></cells>                            <rows><%= properties.pivotSearch.rows %></rows>                            <columns><%= properties.pivotSearch.columns %></columns>                        </pivotSearch>                    <% } else if (properties.searchName) { %>                        <searchName><%- properties.searchName %></searchName>                    <% } %>                    <% if (properties.fields) { %>                        <fields><%- properties.fields %></fields>                    <% } %>                    <% _.each(properties.options, function(value, key) { %>                        <option name="<%- key %>"><%- value %></option>                    <% }) %>                </<%- panelType %>>            ',HTMLPanelTemplate:"<html><%= properties.html %></html>"},{panelXMLToPanelTypeAndProperties:function(t){var n={},r=e(t),s;return t.nodeName===o?(s=i.serialize(t),{panelType:t.nodeName,properties:{html:e.trim(s.replace(/^\s*<html>|<\/html>\s*$/g,""))}}):(r.children().each(function(t,r){var i=e(r);r.nodeName!=="option"?n[r.nodeName]=i.text():(n.options=n.options||{},n.options[i.attr("name")]=i.text())}),{panelType:t.nodeName,properties:n})},reportToPropertiesFromPanelType:function(e,n,r){var i=t.indexOf(c,e)!=-1,s={},o,a,l,h;if(!i)throw"Unsupported panel type";return!n.isNew()&&!r?s.searchName=n.entry.get("name"):(s.searchString=n.entry.content.get("search"),l=n.entry.content.get("dispatch.earliest_time"),l&&(s.earliestTime=l),h=n.entry.content.get("dispatch.latest_time"),h&&(s.latestTime=h)),e===u?s.options=n.entry.content.filterByWildcards(["^display.visualizations.charting..*"],{strip:"display.visualizations."}):e===f&&(s.options=n.entry.content.filterByWildcards(["^display.visualizations.singlevalue..*"],{strip:"display.visualizations.singlevalue."})),s}});p.Entry=p.Entry.extend({});var d=p.Entry.Content;return p.Entry.Content=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments)},validate:function(t){var n=t["eai:data"],r,i;if(n!=void 0){r=e.parseXML(n),i=r.firstChild;if(i.nodeName!=="dashboard"&&i.nodeName!=="form")return{"eai:data":"You must declare a dashbaord node."}}}}),p}),define("splunkjs/mvc/simplexml/controller",["require","splunk.config","models/Dashboard","models/Application","util/router_utils","models/classicurl","backbone","jquery","underscore","../../mvc","util/xml_utils","../utils","util/pdf_utils","util/console","uri/route","../sharedmodels","splunk.jquery.csrf","models/services/AppLocal","models/services/authentication/User","util/splunkd_utils"],function(e){var t=e("splunk.config"),n=e("models/Dashboard"),r=e("models/Application"),i=e("util/router_utils"),s=e("models/classicurl"),o=e("backbone"),u=e("jquery"),a=e("underscore"),f=e("../../mvc"),l=e("util/xml_utils"),c=e("../utils"),h=e("util/pdf_utils"),p=e("util/console"),d=e("uri/route"),v=e("../sharedmodels");e("splunk.jquery.csrf");var m=e("models/services/AppLocal"),g=e("models/services/authentication/User"),y=e("util/splunkd_utils"),b=n.extend({getFlattenedXML:function(e){if(!this._itemOrder)throw new Error("Cannot create flattened XML without the item order being captured first");var t=l.$node,n=this;e=e||{};var r=t("<dashboard/>");return t("<label/>").text(this.meta.get("label")).appendTo(r),this.meta.has("description")&&t("<description/>").text(this.meta.get("description")).appendTo(r),a(this._itemOrder).each(function(i){var s=t("<row/>");if(a(i).any(function(e){return e.length>1})){var o=a(i).map(function(e){return e.length}).join(",");s.attr("grouping",o)}a(i).chain().flatten().each(function(t){var r=f.Components.get(t),i=r.model.mapToXML(a.extend({tokens:!1},e)),o=l.$node("<"+i.type+"/>").attr("id",t);i.attributes!==undefined&&o.attr(i.attributes);if(i.content)i.cdata?o.append(l.cdata(i.content)):o.text(i.content);else{n._applyTitle(o,i);var u=f.Components.get(r.model.entry.content.get("display.general.manager"));e.useLoadjob!==!1&&u&&u.job?n._applySearch(o,{search:{type:"inline",search:"| loadjob "+u.job.sid+" ignore_running=t"}}):n._applySearch(o,i),n._applyOptions(o,i),n._applyTags(o,i)}o.appendTo(s)}),s.appendTo(r)}),e&&e.indent&&l.formatXMLDocument(r),l.serialize(r)},updateElement:function(e,t,n){p.log("About to update item=%o with settings=%o",e,t);var r=this.get$XML(),i=r.find("#"+e);if(!i.length){var s=a(this._itemOrder).chain().flatten().indexOf(e).value();p.log("Node with ID=%o not found. Search for item with index=%o",e,s);if(s===-1)throw new Error("Unable to find dashboard element with ID "+e);i=r.find("row").children()[s];if(!i)throw new Error("Unable to find dashboard element with ID "+e);i=u(i)}i=i[0],p.log("Updating XML node: ",i),l.stripEmptyTextNodes(i);var o=l.$node("<"+t.type+"/>");o.attr("id",e),p.log("children",i.childNodes);while(i.childNodes.length)o.append(i.childNodes[0]);return n&&n.clearOptions&&o.find("option").remove(),this._applyTitle(o,t),this._applySearch(o,t),this._applyFields(o,t),this._applyOptions(o,t),this._applyTags(o,t),u(i).replaceWith(o),p.DEBUG_ENABLED&&(l.formatXMLDocument(r),p.log(l.serialize(r))),this.set$XML(r),this.save()},deleteElement:function(e){var t=this.get$XML(),n=t.find("#"+e);if(!n.length){var r=a(this._itemOrder).chain().flatten().indexOf(e).value();p.error("Node with ID=%o not found. Search for item with index=%o",e,r);if(r===-1)throw new Error("Unable to find dashboard element with ID "+e);n=t.find("row").children()[r];if(!n)throw new Error("Unable to find dashboard element with ID "+e);n=u(n)}var i=this;a.each(this._itemOrder,function(t,n){a.each(t,function(t,r){var s=a(t).indexOf(e);s>-1&&delete i._itemOrder[n][r]})});var s=n.parents("row");return n.remove(),s.children().length===0&&s.remove(),this.set$XML(t),this.save()},addElement:function(e,t){var n=l.$node("<row/>"),r=l.$node("<"+t.type+"/>").attr("id",e);this._itemOrder.push([[t.id]]),n.append(r),this._applyTitle(r,t),this._applySearch(r,t);var i=this.get$XML();return i.find(":eq(0)").append(n),p.DEBUG_ENABLED&&(l.formatXMLDocument(i),p.log(l.serialize(i))),this.set$XML(i),this.save()},saveFormSettings:function(e,t,n){var r=this.get$XML(),i,s;if(e){r=this._migrateViewType(r,"form"),i=r.find(":eq(0)"),s=r.find(":eq(0)>fieldset");if(!s.length){s=l.$node('<fieldset autoRun="true" submitButton="false"></fieldset>');var o=r.find(":eq(0)>description");o.length?s.insertAfter(o):(o=r.find(":eq(0)>label"),o.length?s.insertAfter(o):s.prependTo(i))}var f=a.find(s.find('input[type="time"]'),function(e){var t=u(e).find("token");return t.length===0||!u.trim(t.text)});if(t){var c;f?(c=u(f).find("default"),c.length||(c=l.$node("<default></default>").appendTo(f))):(f=l.$node('<input type="time" searchWhenChanged="true" />'),c=l.$node("<default></default>").appendTo(f),s.append(f)),n?a.isString(n)?c.text(n):(c.empty(),n.earliestTime&&l.$node("<earliestTime></earliestTime>").text(n.earliestTime).appendTo(c),n.latestTime&&l.$node("<latestTime></latestTime>").text(n.latestTime).appendTo(c)):c.remove()}else u(f).remove()}else r=this._migrateViewType(r,"dashboard"),r.find(":eq(0)>fieldset").remove();p.DEBUG_ENABLED&&(l.formatXMLDocument(r),p.log(l.serialize(r))),this.set$XML(r),this.save()},_migrateViewType:function(e,t){var n=e.find(":eq(0)");if(n.prop("tagName")!==t){e=u(u.parseXML("<"+t+"/>"));var r=e.find(":eq(0)"),i=n[0];a(i.attributes).each(function(e){r.attr(e.nodeName,e.nodeValue)});while(i.childNodes.length)r.append(i.childNodes[0])}return e},_applyOptions:function(e,t){t.options&&a.each(t.options,function(t,n){var r=e.find('option[name="'+n+'"]');t===""||t===null||t===void 0?r.remove():r.length?r.text(t):l.$node("<option/>").attr("name",n).text(t).appendTo(e)}),t.removeOptions&&a(t.removeOptions).each(function(t){e.find('option[name="'+t+'"]').remove()})},_applyTags:function(e,t){t.tags&&a.each(t.tags,function(t,n){e.find(n).remove(),(a.isArray(t)&&t.length||t)&&l.$node("<"+n+"/>").text(t).appendTo(e)})},_applyTitle:function(e,t){var n=e.find("title");t.title&&(n.length||(n=l.$node("<title/>").prependTo(e)),n.text(t.title))},_applyFields:function(e,t){var n=e.find("fields");t.fields&&(n.length||(n=l.$node("<fields/>").prependTo(e)),n.text(t.fields))},_applySearch:function(e,t){if(t.search){e.find("searchString,searchTemplate,searchName,pivotSearch,earliestTime,latestTime").remove();var n=e.find("title");switch(t.search.type){case"inline":var r=l.$node("<searchString/>").text(t.search.search);n.length?r.insertAfter(n):r.prependTo(e),t.search.latest_time&&l.$node("<latestTime/>").text(t.search.latest_time).insertAfter(r),t.search.earliest_time&&l.$node("<earliestTime/>").text(t.search.earliest_time).insertAfter(r);break;case"saved":var i=l.$node("<searchName/>").text(t.search.name);n.length?i.insertAfter(n):i.prependTo(e);break;case"pivot":throw new Error("Pivot search not implemented!");default:throw new Error("Unknown search type: "+t.search.type)}}},captureItemOrder:function(e){this._itemOrder=e,this._itemOrderMap=a.object(a.flatten(e),this.get$XML().find("row").children()),this.validateItemOrder(),p.DEBUG_ENABLED&&p.log("Captured dashboard item order: %o",JSON.stringify(this._itemOrder))},validateItemOrder:function(){a(this._itemOrderMap).each(function(e,t){var n=u(e).attr(t);if(n!==undefined&&n!==t)throw new Error("Invalid Item order. Expected node with ID "+t+". Instead saw "+n)})},setItemOrder:function(e){if(!this._itemOrder)this.captureItemOrder(e);else if(!a.isEqual(e,this._itemOrder)){var t=this.get$XML(),n=this._itemOrderMap;t.find("row").remove(),a(e).each(function(e){var r=l.$node("<row/>");if(a(e).any(function(e){return e.length>1})){var i=a(e).map(function(e){return e.length}).join(",");r.attr("grouping",i)}a.chain(e).flatten().each(function(e){var t=n[e];u(t).attr("id",e).find("script").remove(),r.append(t)}),r.children().length||p.DEBUG_ENABLED&&p.log("Created empty row for items %o and map %o",e,n),t.find("dashboard,form").append(r)}),this.set$XML(l.formatXMLDocument(t)),p.log("Saving new item order",e,t[0]),this.save(),this._itemOrder=e}else p.log("no changes")},isEditable:function(){return this.isDashboard()||this.isForm()}}),w=o.Router.extend({initialize:function(e){this.model=e.model,this.app=e.app},routes:{":locale/app/:app/:page?*qs":"view",":locale/app/:app/:page":"view",":locale/app/:app/:page/edit?*qs":"edit",":locale/app/:app/:page/edit":"edit","*root/:locale/app/:app/:page?*qs":"rootedView","*root/:locale/app/:app/:page":"rootedView","*root/:locale/app/:app/:page/edit?*qs":"rootedEdit","*root/:locale/app/:app/:page/edit":"rootedEdit",":locale/manager/:app/:page?*qs":"view",":locale/manager/:app/:page":"view","*root/:locale/manager/:app/:page?*qs":"rootedView","*root/:locale/manager/:app/:page":"rootedView","dj/:app/:page/":"appfx","dj/:app/:page/?*qs":"appfx","*root/dj/:app/:page/":"rootedAppfx","*root/dj/:app/:page/?*qs":"rootedAppfx"},view:function(){p.log("ROUTE: view"),this.model.set("edit",!1),this.page.apply(this,arguments)},edit:function(){p.log("ROUTE: edit"),this.model.set("edit",!0),this.page.apply(this,arguments)},rootedView:function(e){this.app.set("root",e),this.view.apply(this,a.rest(arguments))},rootedEdit:function(e){this.app.set("root",e),this.edit.apply(this,a.rest(arguments))},page:function(e,t,n){p.log("ROUTE: page(locale=%o, app=%o, page=%o)",e,t,n),this.app.set({locale:e,app:t,page:n}),s.fetch()},appfx:function(e,t){this.app.set("appfx",!0),this.page("en-US",e,t)},rootedAppfx:function(e){this.app.set("root",e),this.appfx.apply(this,a.rest(arguments))},updateUrl:function(){var e=[this.app.get("root")||"",this.app.get("locale"),"app",this.app.get("app"),this.app.get("page")];this.model.get("edit")&&e.push("edit");var t=[e.join("/")],n=s.toURLEncodedQueryString();n.length&&t.push(n),this.navigate(t.join("?"),{replace:!1})}}),E=function(){this.readyDfd=u.Deferred();var e=this.model=new o.Model,t=this.collection={},n=this.model.app=v.get("app"),r=this.model.appLocal=v.get("appLocal"),s=this.model.user=v.get("user"),a=this.collection.times=v.get("times");this.router=new w({model:this.model,app:n}),i.start_backbone_history();var f=this.model.view=new b;this.model.view.fetch({url:d.splunkdNS(n.get("root"),n.get("locale"),n.get("owner"),n.get("app"),[f.url,n.get("page")].join("/"))}).done(this._onViewModelLoad.bind(this)),h.isPdfServiceAvailable().always(function(t){e.set("pdf_available",t)}),this._onViewModelLoadDfd=u.Deferred(),this.model.on("change:edit",this.router.updateUrl,this.router)};a.extend(E.prototype,o.Events,{_onViewModelLoad:function(){var e=this.model;e.set("editable",e.view.isEditable()),e.view.isXML()&&(e.set("label",this.model.view.getLabel()),e.set("description",this.model.view.getDescription()),e.on("change:label change:description",function(){e.view.setLabelAndDescription(e.get("label"),e.get("description")),e.view.save()})),this._onViewModelLoadDfd.resolve(this.model.view)},onViewModelLoad:function(e,t){this._onViewModelLoadDfd.done(e.bind(t||null))},getStateModel:function(){return this.model},isEditMode:function(){return this.model.get("edit")===!0},getClassicUrlModel:a.once(function(){return c.syncModels(s,f.Global).auto("push"),s}),getPersistentStore:function(e){switch(e){case"uri":return this.getClassicUrlModel();default:throw"Unsupported persistent store "+e}},onReady:function(e){u.when(this.readyDfd,this._onViewModelLoadDfd).then(e)},ready:function(){this.readyDfd.resolve()}});var S=new E;return p.DEBUG_ENABLED&&(window.Dashboard=S),S.getClassicUrlModel(),S}),define("models/services/authorization/Role",["models/SplunkDBase"],function(e){return e.extend({url:"authorization/roles",initialize:function(){e.prototype.initialize.apply(this,arguments)}})}),define("collections/services/authorization/Roles",["models/services/authorization/Role","collections/SplunkDsBase"],function(e,t){return t.extend({initialize:function(){t.prototype.initialize.apply(this,arguments)},url:"authorization/roles",model:e})}),define("views/shared/documentcontrols/dialogs/permissions_dialog/ACL",["underscore","jquery","backbone","module","views/Base","views/shared/controls/SyntheticCheckboxControl"],function(e,t,n,r,i,s){return i.extend({moduleId:r.id,className:"push-margins",initialize:function(){i.prototype.initialize.apply(this,arguments),this.children.read=new i,this.children.write=new i,this.model.perms.on("change:Everyone.read",function(){this.toggleEveryone("read")},this),this.model.perms.on("change:Everyone.write",function(){this.toggleEveryone("write")},this)},appendRow:function(e,t){this.$("tbody").append('<tr class="'+e+'">                    <td class="role-name">'+e+'</td>                    <td class="perms-read '+e+'-checkbox"></td>                    <td class="perms-write '+e+'-checkbox"></td>                </tr>'),this.children.readCheckbox=new s({modelAttribute:e+".read",model:this.model.perms,checkboxClassName:t+" "+e+" read btn"}),this.children.writeCheckbox=new s({modelAttribute:e+".write",model:this.model.perms,checkboxClassName:t+" "+e+" write btn"}),this.$("td.perms-read."+e+"-checkbox").append(this.children.readCheckbox.render().el),this.$("td.perms-write."+e+"-checkbox").append(this.children.writeCheckbox.render().el),this.children.read.children[e]=this.children.readCheckbox,this.children.write.children[e]=this.children.writeCheckbox},toggleEveryone:function(t){var n=this.model.perms.get("Everyone."+t),r=this.children[t];e.each(r.children,function(e,t){t!=="Everyone"&&(n?e.disable():e.enable())})},render:function(){return this.$el.html(this.compiledTemplate({_:e})),this.appendRow(e("Everyone").t()),this.collection.each(function(e){this.appendRow(e.entry.get("name"),"role")}.bind(this)),this.toggleEveryone("read"),this.toggleEveryone("write"),this},template:'            <table class="table table-striped table-condensed table-scroll table-border-row">                <thead>                    <tr>                        <td></td>                        <th><%- _("Read").t() %></th>                        <th><%- _("Write").t() %></th>                    </tr>                </thead>                <tbody>                </tbody>            </table>        '})}),define("views/shared/documentcontrols/dialogs/permissions_dialog/Master",["jquery","underscore","backbone","module","models/ACLReadOnly","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/documentcontrols/dialogs/permissions_dialog/ACL","views/shared/FlashMessages","util/splunkd_utils"],function(e,t,n,r,i,s,o,u,a,f){return s.extend({moduleId:r.id,initialize:function(r){s.prototype.initialize.apply(this,arguments),this.model.document||(this.model={document:this.model,nameModel:this.model.entry}),this.model.perms=new n.Model,this.model.inmem=new i(e.extend(!0,{},this.model.document.entry.acl.toJSON()));var l={nameLabel:t("Name").t(),nameKey:"name"};t.defaults(this.options,l),this.translateToPermsModel(),this.children.flashMessage=new a({model:{inmem:this.model.inmem,report:this.model.document,reportAcl:this.model.document.acl}}),this.children.name=new o({controlType:"Label",controlOptions:{modelAttribute:this.options.nameKey,model:this.model.nameModel},label:this.options.nameLabel}),this.children.owner=new o({controlType:"Label",controlOptions:{modelAttribute:"owner",model:this.model.inmem},label:t("Owner").t()}),this.children.app=new o({controlType:"Label",controlOptions:{modelAttribute:"app",model:this.model.inmem},label:t("App").t()}),this.children.display_for=new o({controlType:"SyntheticRadio",controlClass:"controls-thirdblock",controlOptions:{modelAttribute:"sharing",model:this.model.inmem,items:[{label:t("Owner").t(),value:f.USER,className:"user"},{label:t("App").t(),value:f.APP,className:"app"},{label:t("All Apps").t(),value:f.GLOBAL,className:"global"}],save:!1},label:t("Display For").t()}),this.children.acl=new u({model:{perms:this.model.perms},collection:this.collection}),this.model.inmem.on("change:sharing",function(){this.model.inmem.get("sharing")===f.USER?this.children.acl.$el.hide():this.children.acl.$el.show()},this)},events:e.extend({},s.prototype.events,{"click .btn-primary":function(e){this.translateFromPermsModel();var t=this.model.inmem.toDataPayload();this.model.document.acl.save({},{data:t,success:function(e,n){this.hide(),this.model.document.fetch({url:f.fullpath(this.model.document.url+"/"+this.model.document.entry.get("name"),{sharing:t.sharing,app:this.model.inmem.get("app"),owner:t.owner}),success:function(){this.model.document.trigger("updateCollection")}.bind(this)})}.bind(this)}),e.preventDefault()}}),translateToPermsModel:function(){var e=this.model.inmem.get("perms")||{};this.model.perms.set("Everyone.read",t.indexOf(e.read,"*")!=-1),this.model.perms.set("Everyone.write",t.indexOf(e.write,"*")!=-1),this.collection.each(function(n){var r=n.entry.get("name");this.model.perms.set(r+".read",t.indexOf(e.read,r)!=-1),this.model.perms.set(r+".write",t.indexOf(e.write,r)!=-1)}.bind(this))},translateFromPermsModel:function(){var e={read:[],write:[]};this.model.perms.get("Everyone.read")&&e.read.push("*"),this.model.perms.get("Everyone.write")&&e.write.push("*"),this.collection.each(function(t){var n=t.entry.get("name");this.model.perms.get(n+".read")&&e.read.push(n),this.model.perms.get(n+".write")&&e.write.push(n)}.bind(this)),this.model.inmem.set("perms",e)},setView:function(){this.model.inmem.get("can_share_user")||this.children.display_for.$(".user").attr("disabled",!0),this.model.inmem.get("can_share_app")||this.children.display_for.$(".app").attr("disabled",!0),this.model.inmem.get("can_share_global")||this.children.display_for.$(".global").attr("disabled",!0),this.model.inmem.get("modifiable")||this.children.display_for.$(".btn").attr("disabled",!0),this.model.inmem.get("sharing")==="user"?this.children.acl.$el.hide():this.children.acl.$el.show()},render:function(){return this.$el.html(s.TEMPLATE),this.$(s.HEADER_TITLE_SELECTOR).html(t("Edit Permissions").t()),this.$(s.BODY_SELECTOR).addClass("modal-body-scrolling"),this.$(s.BODY_SELECTOR).prepend(this.children.flashMessage.render().el),this.$(s.BODY_SELECTOR).append(s.FORM_HORIZONTAL),this.$(s.BODY_FORM_SELECTOR).append(this.children.name.render().el),this.$(s.BODY_FORM_SELECTOR).append(this.children.owner.render().el),this.$(s.BODY_FORM_SELECTOR).append(this.children.app.render().el),this.$(s.BODY_FORM_SELECTOR).append(this.children.display_for.render().el),this.$(s.BODY_FORM_SELECTOR).append(this.children.acl.render().el),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_CANCEL),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_SAVE),this.setView(),this}})}),define("splunkjs/mvc/simplexml/dialog/dashboardtitle",["underscore","backbone","module","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages"],function(e,t,n,r,i,s){return r.extend({moduleId:n.id,initialize:function(t){r.prototype.initialize.apply(this,arguments),this.children.flashMessage=new s({model:this.model}),this.children.titleField=new i({controlType:"Text",controlOptions:{modelAttribute:"label",model:this.model},label:e("Title").t()}),this.children.descriptionField=new i({controlType:"Textarea",controlOptions:{modelAttribute:"description",model:this.model},label:e("Description").t()})},events:$.extend({},r.prototype.events,{"click .btn-primary":function(e){this.hide(),e.preventDefault()}}),render:function(){return this.$el.html(r.TEMPLATE),this.$(r.HEADER_TITLE_SELECTOR).html(e("Edit Title or Description").t()),this.$(r.BODY_SELECTOR).prepend(this.children.flashMessage.render().el),this.$(r.BODY_SELECTOR).append(r.FORM_HORIZONTAL),this.$(r.BODY_FORM_SELECTOR).append(this.children.titleField.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.descriptionField.render().el),this.$(r.FOOTER_SELECTOR).append(r.BUTTON_CANCEL),this.$(r.FOOTER_SELECTOR).append(r.BUTTON_SAVE),this}})}),define("splunkjs/mvc/simplexml/mapper",["require","underscore","../mvc","../savedsearchmanager","backbone","util/console"],function(e){var t=e("underscore"),n=e("../mvc"),r=e("../savedsearchmanager"),i=e("backbone"),s=e("util/console"),o=function(){};t.extend(o.prototype,{tagName:"#abstract",map:function(){},getSearch:function(e,t){var i=n.Components.get(e),s;if(i instanceof r)s={type:"saved",name:i.get("searchname",t)};else{var o=t.tokens!==!1?i.query.get("search",t):i.query.resolve();s={type:"inline",search:o,earliest_time:i.search.get("earliest_time"),latest_time:i.search.get("latest_time")}}return s},toXML:function(e,t){t=t||{tokens:!0};var n={type:this.tagName,title:e.get("display.general.title",t),search:this.getSearch(e.get("display.general.manager",t),t),options:{}};return this.map(e,n,t),n.options.fields&&(n.fields=n.options.fields,delete n.options.fields),n}});var u={};return o.register=function(e,t){u[e]=t},o.get=function(e){var t=u[e];if(!t)throw new Error("No mapper for type "+e);return new t},o.extend=i.Model.extend,o}),define("models/DashboardReport",["require","jquery","underscore","models/Report","splunkjs/mvc/simplexml/controller","splunkjs/mvc/simplexml/mapper","util/console","splunkjs/mvc/tokenawaremodel"],function(e){var t=e("jquery"),n=e("underscore"),r=e("models/Report"),i=e("splunkjs/mvc/simplexml/controller"),s=e("splunkjs/mvc/simplexml/mapper"),o=e("util/console"),u=e("splunkjs/mvc/tokenawaremodel"),a=r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments)},saveXML:function(e){var t=this.entry.content.get("display.general.id");return o.log("[%o] Saving Panel Element XML...",t),i.model.view.updateElement(t,this.mapToXML(),e)},mapToXML:function(e){var t=this.entry.content.get("display.general.type"),n=["display",t,"type"].join(".");this.entry.content.has(n)&&(t=[t,this.entry.content.get(n)].join(":")),o.log("Looking up mapper for type ",t);var r=s.get(t);return o.log("Found mapper",r),r.toXML(this.entry.content,e)},deleteXML:function(){var e=i.model.view.deleteElement(this.entry.content.get("display.general.id"));e&&this.trigger("removedPanel")},defaults:{"display.visualizations.charting.axisY.scale":"linear","display.visualizations.charting.axisX.scale":"linear","display.visualizations.charting.axisX.minimumNumber":"","display.visualizations.charting.axisX.maximumNumber":"","display.visualizations.charting.axisY.minimumNumber":"","display.visualizations.charting.axisY.maximumNumber":"","display.visualizations.charting.axisTitleX.text":"","display.visualizations.charting.axisTitleY.text":"","display.visualizations.charting.axisLabelsX.majorUnit":"","display.visualizations.charting.axisLabelsY.majorUnit":"","display.visualizations.charting.legend.placement":"right","display.visualizations.charting.legend.labelStyle.overflowMode":"ellipsisMiddle","display.visualizations.charting.chart.stackMode":"default","display.visualizations.charting.chart.nullValueMode":"zero","display.visualizations.charting.chart.rangeValues":'["0","30","70","100"]',"display.visualizations.charting.chart.style":"shiny","display.visualizations.charting.gaugeColors":'["84E900", "FFE800", "BF3030"]'},validation:{"display.visualizations.charting.axisX.minimumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisX.maximumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisY.minimumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisY.maximumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisLabelsX.majorUnit":{pattern:"number",min:Number.MIN_VALUE,msg:"Please enter a positive number",required:!1},"display.visualizations.charting.axisLabelsY.majorUnit":{pattern:"number",min:Number.MIN_VALUE,msg:"Please enter a positive number",required:!1},"display.visualizations.charting.axisY.scale":{fn:"validateYScaleAndStacking",required:!1},"display.visualizations.charting.chart.stackMode":{fn:"validateYScaleAndStacking",required:!1},"display.visualizations.charting.chart.rangeValues":{fn:"validateRangeValues",required:!1}},validateXAxisExtremes:function(e,t,r){var i=parseFloat(r["display.visualizations.charting.axisX.minimumNumber"]),s=parseFloat(r["display.visualizations.charting.axisX.maximumNumber"]);if(!n.isNaN(i)&&!n.isNaN(s)&&s<=i)return"The minimum value must be less than maximum value"},validateYAxisExtremes:function(e,t,r){var i=parseFloat(r["display.visualizations.charting.axisY.minimumNumber"]),s=parseFloat(r["display.visualizations.charting.axisY.maximumNumber"]);if(!n.isNaN(i)&&!n.isNaN(s)&&s<=i)return"The minimum value must be less than maximum value"},validateYScaleAndStacking:function(e,t,n){var r=n["display.visualizations.charting.axisY.scale"],i=n["display.visualizations.charting.chart.stackMode"];if(r==="log"&&i!=="default")return"Log scale and stacking cannot be enabled at the same time"},validateRangeValues:function(e){var r=n(e?JSON.parse(e):[]).map(parseFloat);if(n(r).any(n.isNaN)||!e)return"All color ranges must be valid numbers";var i=n.uniq(r),s=t.extend([],r).sort(function(e,t){return e-t});if(!n.isEqual(r,i)||!n.isEqual(r,s))return"Color ranges must be entered from lowest to highest"},attrToArray:function(e){var t=this.get(e);return t?n.values(JSON.parse(t)):[]},rangesValuesToArray:function(){return this.attrToArray("display.visualizations.charting.chart.rangeValues")},gaugeColorsToArray:function(){return this.attrToArray("display.visualizations.charting.gaugeColors")}});return a.Entry.Content=u.extend({applyTokensByDefault:!0}),a}),define("util/moment/compactFromNow",["util/moment"],function(e){function n(e,n,r){var i=t(Math.abs(e)/1e3),s=t(i/60),o=t(s/60),u=t(o/24),a=t(u/365),f=i<45&&["s",i]||s===1&&["m"]||s<45&&["mm",s]||o===1&&["h"]||o<22&&["hh",o]||u===1&&["d"]||u<=25&&["dd",u]||u<=45&&["M"]||u<345&&["MM",t(u/30)]||a===1&&["y"]||["yy",a],l=f[0],c=f[1]||1,h=e>0,p=(r._compactRelativeTime||{})[l];return p===undefined?r.relativeTime(c,!!n,l,h):typeof p=="function"?p(c,n,l,h):p.replace(/%d/i,c)}var t=Math.round;return e.duration.fn.humanizeCompact=function(e){var t=+this,r=n(t,!e,this.lang());return e&&(r=this.lang().pastFuture(t,r)),this.lang().postformat(r)},e.fn.compactFromNow=function(t){return e.duration(this.diff(e())).lang(this.lang()._abbr).humanizeCompact(!t)},e}),define("splunkjs/mvc/refreshtimeindicatorview",["require","exports","module","./mvc","./basesplunkview","util/moment","util/moment/compactFromNow","underscore"],function(e,t,n){function f(){o(u).each(function(e){e()})}function l(e){delete u[e],o.isEmpty(u)&&(clearInterval(a),a=null)}function c(e,t,n){u[e]&&l(e),u[e]=o.bind(t,n),a||(a=setInterval(f,1e3))}var r=e("./mvc"),i=e("./basesplunkview"),s=e("util/moment");e("util/moment/compactFromNow");var o=e("underscore"),u={},a,h=i.extend({moduleId:n.id,className:"splunk-timeindicator",initialize:function(){this.bindToComponent(this.options.manager,this.onManagerChange,this),this.timer=o.uniqueId("timer_")},onManagerChange:function(e,t){this.manager&&this.manager.off(null,null,this),this.manager=t;if(!t)return;this.manager.on("search:start",this.clear,this),this.manager.on("search:progress",this.onSearchProgress,this),this.manager.on("search:done",this.onSearchProgress,this),this.manager.on("search:fail",this.clear,this),this.manager.on("search:cancelled",this.clear,this),t.replayLastSearchEvent(this)},clear:function(){l(this.timer),this.$el.html("&nbsp;")},updateRefreshTime:function(){this.refreshTime&&(s().diff(this.refreshTime)<1e4?this.$el.hide():(this.$el.text(this.refreshTime.compactFromNow()).show(),this.$el.attr("title",o("Last refresh: ").t()+this.refreshTime.format("LLL"))))},onSearchProgress:function(e){var t=(e||{}).content||{};if(t.dispatchState==="FAILED")this.clear();else if(t.dispatchState==="PARSING"||t.dispatchState==="QUEUED")this.clear();else if(t.dispatchState==="RUNNING")t.isRealTimeSearch?(l(this.timer),this.$el.text(o("Real-time").t())):this.clear();else if(t.dispatchState==="DONE"){this.refreshTime=s(this.manager.job.published());if(!this.refreshTime){this.clear();return}this.clear(),this.updateRefreshTime(),c(this.timer,this.updateRefreshTime,this)}},render:function(){return this.$el.html("&nbsp;"),this},remove:function(){return l(this.timer),this.onManagerChange(null,null),i.prototype.remove.call(this)}});return h}),define("splunkjs/mvc/resultslinkview",["require","exports","module","jquery","underscore","splunk.util","splunk.window","models/Job","uri/route","views/shared/jobstatus/buttons/ExportResultsDialog","./basesplunkview","./mvc","./utils","./sharedmodels"],function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("splunk.util"),o=e("splunk.window"),u=e("models/Job"),a=e("uri/route"),f=e("views/shared/jobstatus/buttons/ExportResultsDialog"),l=e("./basesplunkview"),c=e("./mvc"),h=e("./utils"),p=e("./sharedmodels");return l.extend({moduleId:n.id,initialize:function(){this.bindToComponent(this.options.manager,this.onManagerChange,this),this.searchJobModel=new u,this.applicationModel=p.get("app"),this.listenTo(this.model.entry.content,"change:search",i.bind(this.render,this))},onManagerChange:function(e,t){this.manager&&(this.manager.off(null,null,this),this.manager=null);if(!t)return;this.manager=t,this.manager.on("search:start",this.onSearchStart,this),this.manager.job&&this.onSearchStart(this.manager.job)},onSearchStart:function(e){this.searchJobModel.set("id",e.sid),this.searchJobModel.fetch(),this.$pivotButton&&this.$pivotButton.off("click").on("click",this.openPivot.bind(this)).show(),this.$searchButton&&this.$searchButton.off("click").on("click",this.openSearch.bind(this)).show(),this.$exportButton&&this.$exportButton.off("click").on("click",this.exportResults.bind(this)).show(),this.$inspectButton&&this.$inspectButton.off("click").on("click",this.inspectSearch.bind(this)).show()},openSearch:function(e){e&&e.preventDefault();var t=this.options,n=this.manager,r,i,s;t["link.openSearch.search"]?(r={q:t["link.openSearch.search"]},i=t["link.openSearch.searchEarliestTime"]||n.search.get("earliest_time"),i!=null&&(r.earliest=i),s=t["link.openSearch.searchLatestTime"]||n.search.get("latest_time"),s!=null&&(r.latest=s)):t["link.openSearch.viewTarget"]?r={sid:this.searchJobModel.get("id")}:(r={sid:this.searchJobModel.get("id"),q:n.query.get("search")},i=n.search.get("earliest_time"),i!=null&&(r.earliest=i),s=n.search.get("latest_time"),s!=null&&(r.latest=s));var o=h.getPageInfo(),u=a.page(o.root,o.locale,o.app,t["link.openSearch.viewTarget"]||"search",{data:r});window.open(u,"_blank")},exportResults:function(e){e&&e.preventDefault();var t=new f({model:{searchJob:this.searchJobModel,application:this.applicationModel}});t.render().appendTo(r("body")),t.show()},inspectSearch:function(e){e&&e.preventDefault();var t=h.getPageInfo(),n=a.jobInspector(t.root,t.locale,t.app,this.searchJobModel.get("id"));o.open(n,"splunk_job_inspector",{width:870,height:560,menubar:!1})},openPivot:function(e){e&&e.preventDefault();var t=h.getPageInfo(),n,r;if(this.model.has("id")){var i=this.model.get("id");n={s:i},this.model.entry.content.has("dispatch.earliest_time")&&(n.earliest=this.model.entry.content.get("dispatch.earliest_time"),n.latedst=this.model.entry.content.get("dispatch.latest_time")),r=a.pivot(t.root,t.locale,t.app,{data:n}),h.redirect(r,!0)}else{var s=this.model.entry.content.get("search");n={q:s},this.model.entry.content.has("dispatch.earliest_time")&&(n.earliest=this.model.entry.content.get("dispatch.earliest_time"),n.latest=this.model.entry.content.get("dispatch.latest_time")),r=a.pivot(t.root,t.locale,t.app,{data:n}),h.redirect(r,!0)}},render:function(){var e;return this.model.isPivotReport()?e=i.template(this.pivotTemplate):e=i.template(this.template),this.$el.html(e({options:this.options})),this.resolveBooleanOptions("link.openPivot.visible","link.visible",!0)?this.$pivotButton=this.$(".pivot-button").hide():this.$(".pivot-button").remove(),this.resolveBooleanOptions("link.openSearch.visible","link.visible",!0)?this.$searchButton=this.$(".search-button").hide():this.$(".search-button").remove(),this.resolveBooleanOptions("link.exportResults.visible","link.visible",!0)?this.$exportButton=this.$(".export-button").hide():this.$(".export-button").remove(),this.resolveBooleanOptions("link.inspectSearch.visible","link.visible",!0)?this.$inspectButton=this.$(".inspect-button").hide():this.$(".inspect-button").remove(),this.$searchButton||this.$exportButton||this.$inspectButton?this.$el.show():this.$el.hide(),this.$("> a").tooltip({animation:!1,container:"body"}),this},resolveBooleanOptions:function(){var e=this.options,t;for(var n=0,r=arguments.length-1;n<r;n++){t=e[arguments[n]];if(t!=null)return s.normalizeBoolean(t)}return s.normalizeBoolean(arguments[arguments.length-1])},template:'            <a href="#search" class="search-button btn-pill" title="<%- options[\'link.openSearch.text\'] || _(\'Open in Search\').t() %>">                <i class="icon-search"></i>                <span class="hide-text"><%- options[\'link.openSearch.text\'] || _("Open in Search").t() %></span>            </a><a href="#export" class="export-button btn-pill" title="<%- _(\'Export\').t() %>">                <i class="icon-export"></i>                <span class="hide-text"><%- _("Export").t() %></span>            </a><a href="#inspect" class="inspect-button btn-pill" title="<%- _(\'Inspect\').t() %>">                <i class="icon-info"></i>                <span class="hide-text"><%- _("Inspect").t() %></span>            </a>        ',pivotTemplate:'            <a href="#pivot" class="pivot-button btn-pill" title="<%- _(\'Open in Pivot\').t() %>">                <i class="icon-pivot"></i>                <span class="hide-text"><%- _("Open in Pivot").t() %></span>            </a><a href="#export" class="export-button btn-pill" title="<%- _(\'Export\').t() %>">                <i class="icon-export"></i>                <span class="hide-text"><%- _("Export").t() %></span>            </a><a href="#inspect" class="inspect-button btn-pill" title="<%- _(\'Inspect\').t() %>">                <i class="icon-info"></i>                <span class="hide-text"><%- _("Inspect").t() %></span>            </a>        '})}),define("views/shared/vizcontrols/custom_controls/DrilldownRadio",["underscore","jquery","module","views/shared/controls/SyntheticRadioControl","splunk.util"],function(e,t,n,r,i){return r.extend({moduleId:n.id,initialize:function(){t.extend(this.options,{modelAttribute:"display.visualizations.charting.drilldown",items:[{label:e("Yes").t(),value:"1"},{label:e("No").t(),value:"0"}],save:!1,elastic:!0}),r.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/DrilldownRadioGroup",["underscore","module","views/shared/controls/ControlGroup","./DrilldownRadio"],function(e,t,n,r){return n.extend({moduleId:t.id,initialize:function(){var t=new r({model:this.model});this.options.label=e("Drilldown").t(),this.options.controls=[t],n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/StackModeControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){var t=[{value:"default",icon:"bar-beside",tooltip:e("not stacked").t()},{value:"stacked",icon:"bar-stacked",tooltip:e("stacked").t()}];this.options.allowStacked100!==!1&&t.push({value:"stacked100",icon:"bar-stacked-100",tooltip:e("stacked 100%").t()}),this.options.label=e("Stack Mode").t(),this.options.controlType="SyntheticRadio",this.options.controlOptions={modelAttribute:"display.visualizations.charting.chart.stackMode",model:this.model,items:t},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/NullValueModeControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Null Values").t(),this.options.controlType="SyntheticRadio",this.options.controlOptions={modelAttribute:"display.visualizations.charting.chart.nullValueMode",model:this.model,items:[{value:"gaps",icon:"missing-value-skipped",tooltip:e("Gaps").t()},{value:"zero",icon:"missing-value-zero",tooltip:e("Zero").t()},{value:"connect",icon:"missing-value-join",tooltip:e("Connect").t()}]},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/GaugeStyleControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Style").t(),this.options.controlType="SyntheticRadio",this.options.controlOptions={modelAttribute:"display.visualizations.charting.chart.style",model:this.model,items:[{label:e("Minimal").t(),value:"minimal"},{label:e("Shiny").t(),value:"shiny"}]},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/SingleValueBeforeLabelControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Before Label").t(),this.options.controlType="Text",this.options.controlOptions={modelAttribute:"display.visualizations.singlevalue.beforeLabel",model:this.model,placeholder:e("optional").t(),inputClassName:"input-medium"},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/SingleValueAfterLabelControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("After Label").t(),this.options.controlType="Text",this.options.controlOptions={modelAttribute:"display.visualizations.singlevalue.afterLabel",model:this.model,placeholder:e("optional").t(),inputClassName:"input-medium"},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/SingleValueUnderLabelControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Under Label").t(),this.options.controlType="Text",this.options.controlOptions={modelAttribute:"display.visualizations.singlevalue.underLabel",model:this.model,placeholder:e("optional").t(),inputClassName:"input-medium"},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/components/Statistics",["underscore","module","views/Base","views/shared/controls/ControlGroup","views/shared/controls/SyntheticSelectControl"],function(e,t,n,r,i){return n.extend({moduleId:t.id,initialize:function(){n.prototype.initialize.apply(this,arguments),this.children.drillDown=new r({label:e("Drilldown").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-3",items:[{value:"row",label:e("Row").t()},{value:"cell",label:e("Cell").t()},{value:"off",label:e("Off").t()}],model:this.model,modelAttribute:"display.statistics.drilldown"}}),this.children.rowNumbers=new r({label:e("Row Numbers").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-2",items:[{value:"1",label:e("Yes").t()},{value:"0",label:e("No").t()}],model:this.model,modelAttribute:"display.statistics.rowNumbers"}}),this.children.wrapResults=new r({label:e("Wrap Results").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-2",items:[{value:"1",label:e("Yes").t()},{value:"0",label:e("No").t()}],model:this.model,modelAttribute:"display.statistics.wrap"}}),this.children.dataOverlay=new r({label:e("Data Overlay").t(),controlType:"SyntheticSelect",controlOptions:{model:this.model,menuWidth:"narrow",items:[{value:"none",label:e("None").t()},{value:"heatmap",label:e("Heat map").t()},{value:"highlow",label:e("High and low values").t()}],modelAttribute:"display.statistics.overlay",toggleClassName:"btn"}})},render:function(){return this.$el.html(""),this.$el.append(this.children.wrapResults.render().el),this.$el.append(this.children.rowNumbers.render().el),this.$el.append(this.children.drillDown.render().el),this.$el.append(this.children.dataOverlay.render().el),this}})}),define("views/shared/vizcontrols/components/Events",["underscore","module","views/Base","views/shared/controls/ControlGroup"],function(e,t,n,r){return n.extend({moduleId:t.id,initialize:function(){n.prototype.initialize.apply(this,arguments),this.showEventType=this.options.showEventType===!1?!1:!0,this.showEventType&&(this.children.eventType=new r({label:e("Display").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-2",items:[{label:e("Raw").t(),value:"raw"},{label:e("List").t(),value:"list"},{label:e("Table").t(),value:"table"}],model:this.model,modelAttribute:"display.events.type"}})),this.children.rowNumbers=new r({label:e("Row Numbers").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-2",items:[{value:"1",label:e("Yes").t()},{value:"0",label:e("No").t()}],model:this.model,modelAttribute:"display.events.rowNumbers"}}),this.children.wrapResultsList=new r({label:e("Wrap Results").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-2",items:[{value:"1",label:e("Yes").t()},{value:"0",label:e("No").t()}],model:this.model,modelAttribute:"display.events.list.wrap"}}),this.children.wrapResultsTable=new r({label:e("Wrap Results").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-2",items:[{value:"1",label:e("Yes").t()},{value:"0",label:e("No").t()}],model:this.model,modelAttribute:"display.events.table.wrap"}}),this.children.maxlines=new r({label:e("Max Lines").t(),controlType:"SyntheticSelect",controlOptions:{model:this.model,menuWidth:"narrow",items:[{value:"5",label:e("5 lines").t()},{value:"10",label:e("10 lines").t()},{value:"20",label:e("20 lines").t()},{value:"50",label:e("50 lines").t()},{value:"100",label:e("100 lines").t()},{value:"200",label:e("200 lines").t()},{value:"0",label:e("All lines").t()}],modelAttribute:"display.events.maxLines",toggleClassName:"btn"}}),this.children.drilldownRaw=new r({label:e("Drilldown").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-3",items:[{value:"inner",label:e("Inner").t()},{value:"outer",label:e("Outer").t()},{value:"full",label:e("Full").t()}],model:this.model,modelAttribute:"display.events.raw.drilldown"}}),this.children.drilldownList=new r({label:e("Drilldown").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-3",items:[{value:"inner",label:e("Inner").t()},{value:"outer",label:e("Outer").t()},{value:"full",label:e("Full").t()}],model:this.model,modelAttribute:"display.events.list.drilldown"}}),this.children.drilldownTable=new r({label:e("Drilldown").t(),controlType:"SyntheticRadio",controlOptions:{className:"btn-group btn-group-2",items:[{value:"1",label:e("On").t()},{value:"0",label:e("Off").t()}],model:this.model,modelAttribute:"display.events.table.drilldown"}}),this.model.on("change:display.events.type",this.visibility,this),this.model.on("change:display.events.list.drilldown change:display.events.raw.drilldown",this.mediateDrilldown,this),this.model.on("change:display.events.list.wrap change:display.events.table.wrap",this.mediateWrap,this)},mediateDrilldown:function(){this.model.get("display.events.type")==="list"?this.model.set("display.events.raw.drilldown",this.model.get("display.events.list.drilldown")):this.model.set("display.events.list.drilldown",this.model.get("display.events.raw.drilldown"))},mediateWrap:function(){this.model.get("display.events.type")==="list"?this.model.set("display.events.table.wrap",this.model.get("display.events.list.wrap")):this.model.set("display.events.list.wrap",this.model.get("display.events.table.wrap"))},visibility:function(){switch(this.model.get("display.events.type")){case"list":this.children.wrapResultsList.$el.show(),this.children.wrapResultsTable.$el.hide(),this.children.rowNumbers.$el.show(),this.children.drilldownList.$el.show(),this.children.drilldownRaw.$el.hide(),this.children.drilldownTable.$el.hide();break;case"raw":this.children.wrapResultsList.$el.hide(),this.children.wrapResultsTable.$el.hide(),this.children.rowNumbers.$el.hide(),this.children.drilldownList.$el.hide(),this.children.drilldownRaw.$el.show(),this.children.drilldownTable.$el.hide();break;case"table":this.children.wrapResultsList.$el.hide(),this.children.wrapResultsTable.$el.show(),this.children.rowNumbers.$el.show(),this.children.drilldownList.$el.hide(),this.children.drilldownRaw.$el.hide(),this.children.drilldownTable.$el.show();break;default:}},render:function(){return this.showEventType&&this.$el.append(this.children.eventType.render().el),this.$el.append(this.children.rowNumbers.render().el),this.$el.append(this.children.wrapResultsList.render().el),this.$el.append(this.children.wrapResultsTable.render().el),this.$el.append(this.children.maxlines.render().el),this.$el.append(this.children.drilldownList.render().el),this.$el.append(this.children.drilldownRaw.render().el),this.$el.append(this.children.drilldownTable.render().el),this.visibility(),this}})}),define("views/shared/vizcontrols/components/General",["underscore","jquery","module","views/Base","views/shared/controls/ControlGroup","views/shared/vizcontrols/custom_controls/DrilldownRadioGroup","views/shared/vizcontrols/custom_controls/StackModeControlGroup","views/shared/vizcontrols/custom_controls/NullValueModeControlGroup","views/shared/vizcontrols/custom_controls/GaugeStyleControlGroup","views/shared/vizcontrols/custom_controls/SingleValueBeforeLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueAfterLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueUnderLabelControlGroup","views/shared/vizcontrols/components/Statistics","views/shared/vizcontrols/components/Events"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return r.extend({moduleId:n.id,className:"form-horizontal",vizToGeneralComponents:{line:["nullValue","drilldown"],area:["stack","nullValue","drilldown"],column:["stack","drilldown"],bar:["stack","drilldown"],pie:["drilldown"],scatter:["drilldown"],radialGauge:["style"],fillerGauge:["style"],markerGauge:["style"],single:["drilldown","before","after","under"],events:["eventGroup"],statistics:["statisticsGroup"]},initialize:function(t){r.prototype.initialize.apply(this,arguments);var n=this.vizToGeneralComponents[this.model.get("viz_type")];e.indexOf(n,"stack")>-1&&(this.children.stackMode=new o({model:this.model})),e.indexOf(n,"nullValue")>-1&&(this.children.nullValueMode=new u({model:this.model})),e.indexOf(n,"drilldown")>-1&&(this.children.drilldown=new s({model:this.model})),e.indexOf(n,"style")>-1&&(this.children.gaugeStyle=new a({model:this.model})),e.indexOf(n,"before")>-1&&(this.children.beforeLabel=new f({model:this.model})),e.indexOf(n,"after")>-1&&(this.children.afterLabel=new l({model:this.model})),e.indexOf(n,"under")>-1&&(this.children.underLabel=new c({model:this.model})),e.indexOf(n,"eventGroup")>-1&&(this.children.events=new p({model:this.model})),e.indexOf(n,"statisticsGroup")>-1&&(this.children.statistics=new h({model:this.model}))},render:function(){return this.children.stackMode&&this.$el.append(this.children.stackMode.render().el),this.children.nullValueMode&&this.$el.append(this.children.nullValueMode.render().el),this.children.drilldown&&this.$el.append(this.children.drilldown.render().el),this.children.gaugeStyle&&this.$el.append(this.children.gaugeStyle.render().el),this.children.beforeLabel&&this.$el.append(this.children.beforeLabel.render().el),this.children.afterLabel&&this.$el.append(this.children.afterLabel.render().el),this.children.underLabel&&this.$el.append(this.children.underLabel.render().el),this.children.events&&this.$el.append(this.children.events.render().el),this.children.statistics&&this.$el.append(this.children.statistics.render().el),this}})}),define("views/shared/vizcontrols/custom_controls/AxisTitleControlGroup",["underscore","module","views/shared/controls/ControlGroup","views/shared/controls/Control"],function(e,t,n,r){return n.extend({moduleId:t.id,initialize:function(){this.axisTitleVisibilityAttr=this.options.xAxis?"display.visualizations.charting.axisTitleX.visibility":"display.visualizations.charting.axisTitleY.visibility",this.axisTitleTextAttr=this.options.xAxis?"display.visualizations.charting.axisTitleX.text":"display.visualizations.charting.axisTitleY.text",this.options.label=e("Title").t(),this.options.controls=[{type:"SyntheticSelect",options:{className:r.prototype.className+" input-prepend",model:this.model,modelAttribute:this.axisTitleVisibilityAttr,toggleClassName:"btn",menuWidth:"narrow",items:[{value:"visible",label:e("show").t()},{value:"collapsed",label:e("hide").t()}]}},{type:"Text",options:{className:r.prototype.className+" input-prepend",model:this.model,modelAttribute:this.axisTitleTextAttr,placeholder:e("optional").t(),inputClassName:this.options.inputClassName}}],n.prototype.initialize.call(this,this.options),this.showHideControl=this.childList[0],this.labelControl=this.childList[1],this.model.on("change:"+this.axisTitleVisibilityAttr,this.handleTitleVisibility,this)},render:function(){return n.prototype.render.apply(this,arguments),this.handleTitleVisibility(),this},handleTitleVisibility:function(){this.model.get(this.axisTitleVisibilityAttr)==="collapsed"?(this.labelControl.detach(),this.showHideControl.$el.removeClass("input-prepend")):(this.labelControl.insertAfter(this.showHideControl.$el),this.showHideControl.$el.addClass("input-prepend"))}})}),define("views/shared/vizcontrols/custom_controls/AxisScaleControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Scale").t(),this.options.controlType="SyntheticRadio",this.options.controlOptions={modelAttribute:this.options.xAxis?"display.visualizations.charting.axisX.scale":"display.visualizations.charting.axisY.scale",model:this.model,items:[{label:e("Linear").t(),value:"linear"},{label:e("Log").t(),value:"log"}]},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Interval").t(),this.options.controlType="Text",this.options.controlOptions={modelAttribute:this.options.xAxis?"display.visualizations.charting.axisLabelsX.majorUnit":"display.visualizations.charting.axisLabelsY.majorUnit",model:this.model,placeholder:e("optional").t(),inputClassName:"input-medium"},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Min Value").t(),this.options.controlType="Text",this.options.controlOptions={modelAttribute:this.options.xAxis?"display.visualizations.charting.axisX.minimumNumber":"display.visualizations.charting.axisY.minimumNumber",model:this.model,placeholder:e("optional").t(),inputClassName:"input-medium"},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Max Value").t(),this.options.controlType="Text",this.options.controlOptions={modelAttribute:this.options.xAxis?"display.visualizations.charting.axisX.maximumNumber":"display.visualizations.charting.axisY.maximumNumber",model:this.model,placeholder:e("optional").t(),inputClassName:"input-medium"},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/LegendPlacementControlGroup",["jquery","underscore","module","views/shared/controls/ControlGroup"],function(e,t,n,r){return r.extend({moduleId:n.id,initialize:function(){this.options.label=t("Legend Position").t(),this.options.controlType="SyntheticSelect",this.options.controlOptions={modelAttribute:"display.visualizations.charting.legend.placement",model:this.model,popdownOptions:this.options.popdownOptions,items:[{label:t("Right").t(),value:"right"},{label:t("Bottom").t(),value:"bottom"},{label:t("Left").t(),value:"left"},{label:t("Top").t(),value:"top"},{label:t("None").t(),value:"none"}],toggleClassName:"btn"},r.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/LegendTruncationControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.label=e("Legend Truncation").t(),this.options.controlType="SyntheticRadio",this.options.controlOptions={modelAttribute:"display.visualizations.charting.legend.labelStyle.overflowMode",model:this.model,items:[{label:e("A...").t(),value:"ellipsisEnd",tooltip:e("Truncate End").t()},{label:e("A...Z").t(),value:"ellipsisMiddle",tooltip:e("Truncate Middle").t()},{label:e("...Z").t(),value:"ellipsisStart",tooltip:e("Truncate Start").t()}]},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/custom_controls/GaugeAutoRangesControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(e,t,n){return n.extend({moduleId:t.id,initialize:function(){this.options.controlType="SyntheticRadio",this.options.controlOptions={modelAttribute:"display.visualizations.charting.gaugeAutoRanges",model:this.model,items:[{label:e("Automatic").t(),value:"1"},{label:e("Manual").t(),value:"0"}]},n.prototype.initialize.call(this,this.options)}})}),define("views/shared/vizcontrols/components/XAxis",["underscore","jquery","module","views/Base","views/shared/vizcontrols/custom_controls/AxisTitleControlGroup","views/shared/vizcontrols/custom_controls/DrilldownRadioGroup","views/shared/vizcontrols/custom_controls/AxisScaleControlGroup","views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup","views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup","views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup","views/shared/vizcontrols/custom_controls/LegendPlacementControlGroup","views/shared/vizcontrols/custom_controls/LegendTruncationControlGroup","views/shared/vizcontrols/custom_controls/StackModeControlGroup","views/shared/vizcontrols/custom_controls/NullValueModeControlGroup","views/shared/vizcontrols/custom_controls/GaugeStyleControlGroup","views/shared/vizcontrols/custom_controls/GaugeAutoRangesControlGroup","views/shared/vizcontrols/custom_controls/SingleValueBeforeLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueAfterLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueUnderLabelControlGroup"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return r.extend({moduleId:n.id,vizToGeneralComponents:{line:["title"],area:["title"],column:["title"],bar:["title"],pie:[],scatter:["title","scale","interval","min","max"],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],events:[],statistics:[]},initialize:function(t){r.prototype.initialize.apply(this,arguments);var n=this.vizToGeneralComponents[this.model.get("viz_type")];e.indexOf(n,"title")>-1&&(this.children.title=new i({className:"form-horizontal",model:this.model,xAxis:!0}))},render:function(){return this.children.title&&this.$el.append(this.children.title.render().el),this}})}),define("views/shared/vizcontrols/components/YAxis",["underscore","jquery","module","views/Base","views/shared/vizcontrols/custom_controls/AxisTitleControlGroup","views/shared/vizcontrols/custom_controls/AxisScaleControlGroup","views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup","views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup","views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup"],function(e,t,n,r,i,s,o,u,a){return r.extend({moduleId:n.id,className:"form-horizontal",vizToYAxisComponents:{line:["title","scale","interval","min","max"],bar:["title","scale","interval","min","max"],area:["title","scale","interval","min","max"],column:["title","scale","interval","min","max"],scatter:["title","scale","interval","min","max"],pie:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],events:[],statistics:[]},initialize:function(t){r.prototype.initialize.apply(this,arguments);var n=this.vizToYAxisComponents[this.model.get("viz_type")];e.indexOf(n,"title")>-1&&(this.children.title=new i({className:"y-axis-title form-horizontal",model:this.model,xAxis:!1})),e.indexOf(n,"scale")>-1&&(this.children.scale=new s({model:this.model,className:"scale"})),e.indexOf(n,"interval")>-1&&(this.children.interval=new o({model:this.model})),e.indexOf(n,"min")>-1&&(this.children.min=new u({model:this.model})),e.indexOf(n,"max")>-1&&(this.children.max=new a({model:this.model})),this.model.get("display.visualizations.charting.axisY.scale")=="log"&&this.children.interval.$el.hide()},events:{"click .scale button":function(e){this.intervalVal=this.intervalVal||this.model.get("display.visualizations.charting.axisLabelsY.majorUnit"),t(e.currentTarget).data("value")=="log"?(this.children.interval.$el.hide(),this.model.set("display.visualizations.charting.axisLabelsY.majorUnit","")):(this.children.interval.$el.show(),this.model.set("display.visualizations.charting.axisLabelsY.majorUnit",this.intervalVal))}},render:function(){return this.children.title&&this.$el.append(this.children.title.render().el),this.children.scale&&this.$el.append(this.children.scale.render().el),this.children.interval&&this.$el.append(this.children.interval.render().el),this.children.min&&this.$el.append(this.children.min.render().el),this.children.max&&this.$el.append(this.children.max.render().el),this}})}),define("views/shared/vizcontrols/components/Legend",["underscore","jquery","module","views/Base","views/shared/controls/ControlGroup","views/shared/vizcontrols/custom_controls/DrilldownRadioGroup","views/shared/vizcontrols/custom_controls/AxisScaleControlGroup","views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup","views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup","views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup","views/shared/vizcontrols/custom_controls/LegendPlacementControlGroup","views/shared/vizcontrols/custom_controls/LegendTruncationControlGroup","views/shared/vizcontrols/custom_controls/StackModeControlGroup","views/shared/vizcontrols/custom_controls/NullValueModeControlGroup","views/shared/vizcontrols/custom_controls/GaugeStyleControlGroup","views/shared/vizcontrols/custom_controls/GaugeAutoRangesControlGroup","views/shared/vizcontrols/custom_controls/SingleValueBeforeLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueAfterLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueUnderLabelControlGroup"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return r.extend({moduleId:n.id,className:"form-horizontal",vizToLegendComponents:{line:["placement","truncation"],bar:["placement","truncation"],area:["placement","truncation"],column:["placement","truncation"],scatter:["placement","truncation"],pie:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],events:[],statistics:[]},initialize:function(t){r.prototype.initialize.apply(this,arguments);var n=this.vizToLegendComponents[this.model.get("viz_type")];e.indexOf(n,"placement")>-1&&(this.children.placement=new l({model:this.model})),e.indexOf(n,"truncation")>-1&&(this.children.truncation=new c({model:this.model}))},render:function(){return this.children.placement&&this.$el.append(this.children.placement.render().el),this.children.truncation&&this.$el.append(this.children.truncation.render().el),this}})}),define("views/shared/vizcontrols/components/color/ColorPicker",["underscore","jquery","module","views/shared/PopTart"],function(e,t,n,r){return r.extend({moduleId:n.id,className:"popdown-dialog color-picker-container",initialize:function(){r.prototype.initialize.apply(this,arguments),this.clone=this.model.clone()},events:{"click .swatch":function(e){var n=t(e.currentTarget);this.clone.set({color:n.data().color}),this.$(".swatch-hex input").val(this.clone.get("color")),this.$(".big-swatch").css("background-color","#"+this.clone.get("color")),e.preventDefault()},"click .color-picker-apply":function(e){this.model.set({color:this.clone.get("color"),shadedcolor:this.options.shadeColor("#"+this.clone.get("color"),-40)}),this.model.trigger("color-picker-apply",this.options.index),this.hide(),e.stopPropagation()},"click .color-picker-cancel":function(e){this.hide(),e.stopPropagation()},"keyup .hex-input":function(e){this.clone.set("color",t(e.currentTarget).val()),this.$(".big-swatch").css("background-color","#"+this.clone.get("color")),e.preventDefault()}},render:function(){this.$el.html(r.prototype.template),this.$el.append(this._buttonTemplate),this.$(".popdown-dialog-body").addClass("color-picker-content");var e=t('<div class="clearfix"></div>').appendTo(this.$(".popdown-dialog-body"));e.append(this.compiledTemplate({model:this.clone}))},template:'                <div class="swatches">                    <ul class="swatch-holder unstyled">                        <li class="swatch" data-color="7e9f44" style="background-color: #7e9f44"></li>                        <li class="swatch" data-color="ebe42d" style="background-color: #ebe42d"></li>                        <li class="swatch" data-color="d13b3b" style="background-color: #d13b3b"></li>                        <li class="swatch" data-color="6cb8ca" style="background-color: #6cb8ca"></li>                        <li class="swatch" data-color="f7912c" style="background-color: #f7912c"></li>                        <li class="swatch" data-color="956e96" style="background-color: #956e96"></li>                        <li class="swatch" data-color="c2da8a" style="background-color: #c2da8a"></li>                        <li class="swatch" data-color="fac61d" style="background-color: #fac61d"></li>                        <li class="swatch" data-color="ebb7d0" style="background-color: #ebb7d0"></li>                        <li class="swatch" data-color="324969" style="background-color: #324969"></li>                        <li class="swatch" data-color="d85e3d" style="background-color: #d85e3d"></li>                        <li class="swatch" data-color="a04558" style="background-color: #a04558"></li>                    </ul>                </div>                <div class="big-swatch" data-color="<%- model.get("color") %>" style="background-color: #<%- model.get("color")%>;"></div>                <div class="swatch-hex">                    <div class="input-prepend views-shared-controls-textcontrol">                        <span class="add-on">#</span>                        <input type="text" class="hex-input" value="<%-model.get("color")%>">                    </div>                </div>            ',_buttonTemplate:'                <div class="color-picker-buttons clearfix">                    <a class="color-picker-cancel btn pull-left">'+e("Cancel").t()+'</a>                    <a class="color-picker-apply btn btn-primary pull-right"> '+e("Apply").t()+"</a>                </div>            "})}),define("views/shared/vizcontrols/components/color/Ranges",["underscore","jquery","module","views/Base","views/shared/vizcontrols/components/color/ColorPicker","collections/Base"],function(e,t,n,r,i,s){return r.extend({className:"tab-pane clearfix",moduleId:n.id,palette:["7e9f44","ebe42d","d13b3b","6cb8ca","f7912c","956e96","c2da8a","fac61d","ebb7d0","324969","d85e3d","a04558"],initialize:function(){r.prototype.initialize.apply(this,arguments),this.collection={},this.collection.rows=new s,this.initRowsFromModel(),this.collection.rows.on("add remove",this.render,this),this.collection.rows.on("color-picker-apply",this.render,this),this.collection.rows.on("change",this.syncModel,this)},initRowsFromModel:function(){var t=this.model.rangesValuesToArray(),n=this.model.gaugeColorsToArray();e(t).each(function(e,r){this.collection.rows.push({value:e,nextValue:t[r+1],color:r!=0?n[r-1]:void 0,shadedcolor:r!=0?this.shadeColor("#"+n[r-1],-40):void 0})},this)},syncModel:function(){this.model.set({"display.visualizations.charting.chart.rangeValues":JSON.stringify(this.collection.rows.pluck("value")),"display.visualizations.charting.gaugeColors":JSON.stringify(e(this.collection.rows.pluck("color")).filter(function(t){return!e.isUndefined(t)}))})},events:{"click .add-color-range":function(e){var t=this.palette[Math.floor(Math.random()*12)];this.collection.rows.push({value:this.options.prepopulateNewRanges?parseInt(this.collection.rows.last().get("value"),10)*2:"",nextValue:"",color:t,shadedcolor:this.shadeColor("#"+t,-40)}),e.stopPropagation()},"keyup .range-value":function(e){var n=t(e.currentTarget),r=n.data().index;this.collection.rows.at(r).set("value",n.val()),e.preventDefault()},"click .color-square":function(e){var n=t(e.currentTarget),r=n.css("background-color");this.children.colorPicker=new i({model:this.collection.rows.at(n.parent().siblings("input").data().index),shadeColor:this.shadeColor,onHiddenRemove:!0}),t("body").append(this.children.colorPicker.render().el),this.children.colorPicker.show(n),e.preventDefault()},"click .remove-range":function(e){var n=t(e.currentTarget).siblings("input").data().index;this.collection.rows.remove(this.collection.rows.at(n)),e.stopPropagation()}},shadeColor:function(e,t){var n=parseInt(e.substring(1),16),r=(n&16711680)>>16,i=(n&65280)>>8,s=(n&255)>>0;r+=Math.floor(t/255*r),i+=Math.floor(t/255*i),s+=Math.floor(t/255*s);var o=(r<<16)+(i<<8)+s,u=o.toString(16);return u},render:function(){return this.syncModel(),this.$el.html(this.compiledTemplate({_:e,collection:this.collection.rows})),this},template:'                <div class="color-rows">                    <form class="form-horizontal from-color-group">                        <div class="control-group">                            <label class="lower-range-label control-label"><%- _("from").t() %></label>                            <div class="controls">                                <input class="first-row-lower range-value" value="<%- collection.at(0).get("value") %>" data-index=0 type="text">                            </div>                        </div>                    </form>                    <form class="form-horizontal">                        <div class="control-group">                            <label class="control-label upper-range-label to-label"><%- _("to").t() %></label>                            <div class="controls right-input">                                <div class="input-append">                                    <input  class="first-row-upper range-value" value="<%- collection.at(1).get("value") %>" data-index=1 type="text">                                    <div class="add-on color-picker-add-on">                                        <div class="color-square" style="border-color: #<%- collection.at(1).get("shadedcolor")%>; background-color: #<%- collection.at(1).get("color") %>;"></div>                                    </div>                                </div>                            </div>                        </div>                    </form>                    <% collection.each(function(model, i) { %>                        <% if(!(i==0 || i==1)) {%>                            <form class="form-horizontal">                                <div class="control-group">                                    <label class="upper-range-label control-label"><%- _("to").t() %></label>                                    <div class="controls input-append">                                        <input  class="range-value" value="<%- model.get("value") %>" data-index=<%-i%> type="text">                                        <div class="add-on color-picker-add-on">                                            <div class="color-square" style="border-color: #<%- model.get("shadedcolor")%>; background-color: #<%- model.get("color") %>;"></div>                                        </div>                                        <a class="remove-range btn-link"><i class="icon-x-circle"></i></a>                                    </div>                                </div>                            </form>                        <% } %>                    <% }); %>                </div>                <a class="add-color-range btn pull-right"> + <%- _("Add Range").t() %></a>            '})}),define("views/shared/vizcontrols/components/color/Master",["underscore","jquery","module","splunk.util","views/Base","views/shared/controls/ControlGroup","views/shared/vizcontrols/custom_controls/GaugeAutoRangesControlGroup","views/shared/vizcontrols/components/color/Ranges"],function(e,t,n,r,i,s,o,u){return i.extend({moduleId:n.id,className:"form-horizontal",vizToColorRangeComponents:{line:[],area:[],column:[],bar:[],pie:[],scatter:[],radialGauge:["range"],fillerGauge:["range"],markerGauge:["range"],single:[],events:[],statistics:[]},initialize:function(t){i.prototype.initialize.apply(this,arguments);var n=this.vizToColorRangeComponents[this.model.get("viz_type")];e.indexOf(n,"range")>-1&&(this.children.toggle=new o({model:this.model})),this.children.colorRanges=new u({model:this.model}),this.model.on("change:display.visualizations.charting.gaugeAutoRanges",function(){this.children.colorRanges.$el.toggle()},this)},render:function(){return this.children.toggle&&this.$el.append(this.children.toggle.render().el),this.$el.append(this.children.colorRanges.render().el),r.normalizeBoolean(this.model.get("display.visualizations.charting.gaugeAutoRanges"))&&this.children.colorRanges.$el.hide(),this}})}),define("views/shared/vizcontrols/components/Master",["underscore","jquery","module","views/Base","views/shared/vizcontrols/components/General","views/shared/vizcontrols/components/XAxis","views/shared/vizcontrols/components/YAxis","views/shared/vizcontrols/components/Legend","views/shared/vizcontrols/components/color/Master"],function(e,t,n,r,i,s,o,u,a){return r.extend({moduleId:n.id,className:"tabbable tabs-left",initialize:function(t){r.prototype.initialize.apply(this,arguments),this.type=this.model.get("viz_type"),e.indexOf(this.model.components[this.type],"gen")>-1&&(this.children.general=new i({model:this.model})),e.indexOf(this.model.components[this.type],"x")>-1&&(this.children.xaxis=new s({model:this.model})),e.indexOf(this.model.components[this.type],"y")>-1&&(this.children.yaxis=new o({model:this.model})),e.indexOf(this.model.components[this.type],"leg")>-1&&(this.children.legend=new u({model:this.model})),e.indexOf(this.model.components[this.type],"ranges")>-1&&(this.children.ranges=new a({model:this.model}))},events:{"click a[data-toggle]":function(n){var r=t(n.currentTarget),i=r.data().type;e(this.children).each(function(e){e.$el.hide()},this),this.children[i].$el.show(),this.$el.find(".nav > li").removeClass("active"),r.parent().addClass("active"),n.preventDefault()}},render:function(){return this.$el.html(e(this.template).template({_:e,tabs:this.model.components[this.type]})),e(this.children).each(function(e){this.$(".tab-content").append(e.render().el),e.$el.hide()},this),this.children.general.$el.show(),this},template:'                <ul class="nav nav-tabs">                    <% if (_.indexOf(tabs, "gen")>-1) { %>                        <li class="active">                            <a href="#" data-toggle="tab" data-type="general"><%- _("General").t() %></a>                        </li>                    <% } %>                    <% if (_.indexOf(tabs, "x")>-1) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="xaxis"><%- _("X-Axis").t() %></a>                        </li>                    <% } %>                    <% if (_.indexOf(tabs, "y")>-1) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="yaxis"><%- _("Y-Axis").t() %></a>                        </li>                    <% } %>                    <% if (_.indexOf(tabs, "leg")>-1) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="legend"><%- _("Legend").t() %></a>                        </li>                    <% } %>                    <% if (_.indexOf(tabs, "ranges")>-1) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="ranges"><%- _("Color Ranges").t() %></a>                        </li>                    <% } %>                </ul>                <div class="tab-content"></div>            '})}),define("views/shared/vizcontrols/Format",["underscore","jquery","module","views/shared/FlashMessages","views/shared/PopTart","views/shared/vizcontrols/components/Master"],function(e,t,n,r,i,s){return i.extend({moduleId:n.id,options:{saveOnApply:!1},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.children.flashMessages=new r({model:this.model.visualization}),this.children.visualizationControls&&this.children.visualizationControls.remove(),this.children.visualizationControls=new s({model:this.model.visualization})},events:{"click .viz-editor-apply":function(e){this.model.visualization.validate(),this.model.visualization.isValid()&&(this.model.report.entry.content.set(t.extend({},this.model.visualization.toJSON())),this.options.saveOnApply&&this.model.report.save(),this.hide()),e.preventDefault()},"click .viz-editor-cancel":function(e){this.hide(),e.preventDefault()}},render:function(){return this.$el.html(i.prototype.template),this.$el.append(this.template),this.$(".popdown-dialog-body").prepend(this.children.flashMessages.render().el),this.$(".popdown-dialog-body").append(this.children.visualizationControls.render().el),this.$(".popdown-dialog-body").removeClass("popdown-dialog-padded"),this},template:'                    <a class="viz-editor-cancel btn pull-left">'+e("Cancel").t()+'</a>                    <a class="viz-editor-apply btn btn-primary pull-right"> '+e("Apply").t()+"</a>            "})}),define("models/Visualization",["jquery","underscore","models/Base"],function(e,t,n){return n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments)},components:{single:["gen"],line:["gen","x","y","leg"],area:["gen","x","y","leg"],column:["gen","x","y","leg"],bar:["gen","x","y","leg"],pie:["gen"],scatter:["gen","x","y","leg"],radialGauge:["gen","ranges"],fillerGauge:["gen","ranges"],markerGauge:["gen","ranges"],statistics:["gen"],events:["gen"]},defaults:{"display.visualizations.charting.axisY.scale":"linear","display.visualizations.charting.axisX.scale":"linear","display.visualizations.charting.axisX.minimumNumber":"","display.visualizations.charting.axisX.maximumNumber":"","display.visualizations.charting.axisY.minimumNumber":"","display.visualizations.charting.axisY.maximumNumber":"","display.visualizations.charting.axisTitleX.text":"","display.visualizations.charting.axisTitleY.text":"","display.visualizations.charting.axisLabelsX.majorUnit":"","display.visualizations.charting.axisLabelsY.majorUnit":"","display.visualizations.charting.legend.placement":"right","display.visualizations.charting.legend.labelStyle.overflowMode":"ellipsisMiddle","display.visualizations.charting.chart.stackMode":"default","display.visualizations.charting.chart.nullValueMode":"zero","display.visualizations.charting.chart.sliceCollapsingThreshold":.01,"display.visualizations.charting.chart.rangeValues":'["0","30","70","100"]',"display.visualizations.charting.chart.style":"shiny","display.visualizations.charting.gaugeColors":'["84E900", "FFE800", "BF3030"]'},validation:{"display.visualizations.charting.axisX.minimumNumber":[{pattern:"number",msg:t("X-Axis Min Value must be a number.").t(),required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisX.maximumNumber":[{pattern:"number",msg:t("X-Axis Max Value must be a number.").t(),required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisY.minimumNumber":[{pattern:"number",msg:t("Y-Axis Min Value must be a number.").t(),required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisY.maximumNumber":[{pattern:"number",msg:t("Y-Axis Max Value must be a number.").t(),required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisLabelsX.majorUnit":{pattern:"number",min:Number.MIN_VALUE,msg:t("X-Axis Interval must be a positive number.").t(),required:!1},"display.visualizations.charting.axisLabelsY.majorUnit":{pattern:"number",min:Number.MIN_VALUE,msg:t("Y-Axis Interval must be a positive number.").t(),required:!1},"display.visualizations.charting.axisY.scale":{fn:"validateYScaleAndStacking",required:!1},"display.visualizations.charting.chart.stackMode":{fn:"validateYScaleAndStacking",required:!1},"display.visualizations.charting.chart.sliceCollapsingThreshold":{pattern:"number",min:0,msg:t("Minimum Size must be a non-negative number.").t()},"display.visualizations.charting.chart.rangeValues":{fn:"validateRangeValues",required:!1}},validateXAxisExtremes:function(e,n,r){var i=parseFloat(r["display.visualizations.charting.axisX.minimumNumber"]),s=parseFloat(r["display.visualizations.charting.axisX.maximumNumber"]);if(!t.isNaN(i)&&!t.isNaN(s)&&s<=i)return t("The X-Axis Min Value must be less than the Max Value.").t()},validateYAxisExtremes:function(e,n,r){var i=parseFloat(r["display.visualizations.charting.axisY.minimumNumber"]),s=parseFloat(r["display.visualizations.charting.axisY.maximumNumber"]);if(!t.isNaN(i)&&!t.isNaN(s)&&s<=i)return t("The Y-Axis Min Value must be less than the Max Value.").t()},validateYScaleAndStacking:function(e,n,r){var i=r["display.visualizations.charting.axisY.scale"],s=r["display.visualizations.charting.chart.stackMode"];if(i==="log"&&s!=="default")return t("Log scale and stacking cannot be enabled at the same time.").t()},validateRangeValues:function(n){var r=t(n?JSON.parse(n):[]).map(parseFloat);if(t(r).any(t.isNaN))return t("All color ranges must be valid numbers.").t();var i=t.uniq(r),s=e.extend([],r).sort(function(e,t){return e-t});if(!t.isEqual(r,i)||!t.isEqual(r,s))return t("Color ranges must be entered from lowest to highest.").t()},attrToArray:function(e){var n=this.get(e);return n?t.values(JSON.parse(n)):[]},rangesValuesToArray:function(){return this.attrToArray("display.visualizations.charting.chart.rangeValues")},gaugeColorsToArray:function(){return this.attrToArray("display.visualizations.charting.gaugeColors")}},{CHARTING_ATTRS_FILTER:["^display.visualizations.charting...*"],SINGLE_VALUE_ATTRS_FILTER:["^singlevalue..*"]})}),define("views/shared/vizcontrols/Master",["underscore","backbone","module","views/Base","views/shared/controls/SyntheticSelectControl","views/shared/vizcontrols/Format","models/Visualization"],function(e,t,n,r,i,s,o){return r.extend({moduleId:n.id,options:{saveOnApply:!1},vizToAttrs:{line:{"display.visualizations.charting.chart":"line","display.visualizations.type":"charting","display.general.type":"visualizations"},area:{"display.visualizations.charting.chart":"area","display.visualizations.type":"charting","display.general.type":"visualizations"},column:{"display.visualizations.charting.chart":"column","display.visualizations.type":"charting","display.general.type":"visualizations"},bar:{"display.visualizations.charting.chart":"bar","display.visualizations.type":"charting","display.general.type":"visualizations"},pie:{"display.visualizations.charting.chart":"pie","display.visualizations.type":"charting","display.general.type":"visualizations"},scatter:{"display.visualizations.charting.chart":"scatter","display.visualizations.type":"charting","display.general.type":"visualizations"},radialGauge:{"display.visualizations.charting.chart":"radialGauge","display.visualizations.type":"charting","display.general.type":"visualizations"},fillerGauge:{"display.visualizations.charting.chart":"fillerGauge","display.visualizations.type":"charting","display.general.type":"visualizations"},markerGauge:{"display.visualizations.charting.chart":"markerGauge","display.visualizations.type":"charting","display.general.type":"visualizations"},single:{"display.visualizations.type":"singleValue","display.general.type":"visualizations"},events:{"display.general.type":"events"},statistics:{"display.general.type":"statistics"}},visualizationGroupings:{events:{label:"g1",items:[{value:"events",label:e("Events").t(),icon:"list"}]},statistics:{label:"g2",items:[{value:"statistics",label:e("Table").t(),icon:"table"}]},visualizations:{label:"g3",items:[{value:"line",label:e("Line").t(),icon:"chart-line"},{value:"area",label:e("Area").t(),icon:"chart-area"},{value:"column",label:e("Column").t(),icon:"chart-column"},{value:"bar",label:e("Bar").t(),icon:"chart-bar"},{value:"pie",label:e("Pie").t(),icon:"chart-pie"},{value:"scatter",label:e("Scatter").t(),icon:"chart-scatter"},{value:"single",label:e("Single Value").t(),icon:"single-value"},{value:"radialGauge",label:e("Radial").t(),icon:"gauge-radial"},{value:"fillerGauge",label:e("Filler").t(),icon:"gauge-filler"},{value:"markerGauge",label:e("Marker").t(),icon:"gauge-marker"}]}},reportTree:{match:{"display.general.type":{visualizations:{match:{"display.visualizations.type":{singleValue:{view:"single"},charting:{match:{"display.visualizations.charting.chart":{line:{view:"line"},area:{view:"area"},column:{view:"column"},bar:{view:"bar"},pie:{view:"pie"},scatter:{view:"scatter"},radialGauge:{view:"radialGauge"},fillerGauge:{view:"fillerGauge"},markerGauge:{view:"markerGauge"}}}}}}},statistics:{view:"statistics"},events:{view:"events"}}}},initialize:function(){r.prototype.initialize.apply(this,arguments),this.model.visualization=new o,this.setVisualizationFromReport(),this.setSyntheticSelectGroups(),this.model.report.entry.content.on("change:display.general.type",function(t,n,r){e.indexOf(this.options.vizTypes,n)>-1&&(this.setVisualizationFromReport(),this.setSyntheticSelectGroups(),this.render())},this),this.model.visualization.on("change:viz_type",function(){this.model.report.entry.content.set(this.vizToAttrs[this.model.visualization.get("viz_type")]),this.model.visualization.set(this.vizToAttrs[this.model.visualization.get("viz_type")]),this.options.saveOnApply&&this.model.report.save()},this)},setVisualizationFromReport:function(){this.model.report.entry.content.unset("viz_type"),this.model.visualization.set($.extend({},this.model.report.entry.content.toJSON()));var e=this.setVizType(this.reportTree),t;t=e&&e.view?e.view:"column",this.model.visualization.set("viz_type",t)},setSyntheticSelectGroups:function(){var t=[],n=this.model.report.entry.content;this.children.visualizationType&&this.children.visualizationType.remove(),this.options.vizTypes&&e(this.options.vizTypes).each(function(e,n){t.push(this.visualizationGroupings[e])},this),t.length&&(this.children.visualizationType=new i({model:this.model.visualization,groupedItems:t,className:"btn-combo pull-left",toggleClassName:"btn-pill",modelAttribute:"viz_type",popdownOptions:{attachDialogTo:"body"}}))},setVizType:function(t){if(t&&t.view)return t;if(t&&t.match){var n;e(t.match).each(function(e,t){n=e[this.model.report.entry.content.get(t)]},this);if(n)return this.setVizType(n)}},events:{"click .format":function(e){var t=$(e.currentTarget);this.children.format=new s({model:{report:this.model.report,visualization:this.model.visualization},onHiddenRemove:!0,saveOnApply:this.options.saveOnApply}),$("body").append(this.children.format.render().el),this.children.format.show(t),e.preventDefault()}},render:function(){return this.$el.empty(),this.children.visualizationType&&this.$el.append(this.children.visualizationType.render().el),this.$el.append(this.template),this},template:'                <div class="btn-group pull-left">                    <a class="btn-pill popdown-toggle format" href="#">                        <i class="icon-paintbrush"/><span class="link-label">'+e("Format").t()+'</span><span class="caret"></span>                    </a>                </div>            '})}),define("views/ValidatingView",["jquery","backbone","underscore","views/Base","util/general_utils"],function(e,t,n,r,i){return r.extend({modelToControlGroupMap:{},dispose:function(){var e=r.prototype.dispose.call(this,arguments);return this.tearDownValidation(),e},setupValidation:function(e,r){if(n.isUndefined(e))throw"The model or collection you passed into views/Base.setupValidation is undefined";e instanceof t.Model?this._setupModelValidationListener(e):e instanceof t.Collection&&(e.each(function(e){this._setupModelValidationListener(e)}),e.on("add",function(e){this._setupModelValidationListener(e)},this),e.on("remove",function(e){e.off("validated",this._modelValidatedHandler,this)},this)),this.__flashMessagesHelper__=r,this.__flashMessagesHelper__.register(this)},tearDownValidation:function(){this.__flashMessagesHelper__&&this.__flashMessagesHelper__.unregister(this)},_setupModelValidationListener:function(e){e.on("validated",this._modelValidatedHandler,this)},_modelValidatedHandler:function(e,t,r){var s=[];if(this.modelToControlGroupMap){var o=i.invert(this.modelToControlGroupMap);o=n.reduce(n.keys(o||{}),function(e,t){return e[t]=void 0,e},{}),n(r).each(function(e,t){r[t]={message:e,label:""}}),n(r).each(function(e,t){var r=this.modelToControlGroupMap[t],i=e.message,s,u="";n.isUndefined(r)?s=i.replace(/\{(label)\}/g,t):(this.children[r].options.label&&(u=this.children[r].options.label),s=i.replace(/\{(label)\}/g,u||t),o[r]=s),e.message=s,e.label=u},this),n(o).each(function(e,t){n.isUndefined(e)?this.children[t].error(!1,""):this.children[t].error(!0,e)},this)}else n(r).each(function(e,t){e.message=e.message.replace(/\{(label)\}/g,t)});this.trigger("validated",e,t,r,this)}})}),define("views/shared/dialogs/DialogBase",["jquery","underscore","backbone","views/ValidatingView","module","bootstrap.modal"],function(e,t,n,r,i){var s=13,o='input[type="text"], input[type="password"], textarea';return r.extend({moduleId:i.id,className:"modal",attributes:{tabIndex:-1},settings:undefined,bodyClassName:"",initialize:function(e){r.prototype.initialize.call(this,e),e=e||{},this.$el.modal({show:!1,keyboard:!0}),this.bodyClassName=e.bodyClassName,this.settings=new n.Model,this.settings.set("footerTemplate",this._footerTemplate),this.settings.set("headerTemplate",this._headerTemplate),this.settings.on("change:primaryButtonLabel change:cancelButtonLabel change:titleLabel",this.debouncedRender,this),this.$el.on("click.dialog",".btn-dialog-primary",t.bind(function(e){e.preventDefault(),this.primaryButtonClicked()},this)),this.$el.on("click.dialog",".btn-dialog-cancel",t.bind(function(e){e.preventDefault(),this.cancelButtonClicked()},this)),this.$el.on("click.dialog",".btn-dialog-close",t.bind(function(e){e.preventDefault(),this.closeButtonClicked()},this)),this.$el.on("keypress",t.bind(function(e){e.which===s&&this.submitKeyPressed(e)},this)),this.$el.on("shown",t.bind(function(e){if(e.target!==e.currentTarget)return;this.dialogShown()},this)),this.$el.on("hide",t.bind(function(e){if(e.target!==e.currentTarget)return;this.cleanup()},this))},render:function(){this.$(".modal-header").detach(),this.$(".modal-body").detach(),this.$(".modal-footer").detach();var e=this.compiledTemplate({bodyClassName:this.bodyClassName});return this.$el.html(e),this.renderHeader(this.$(".modal-header")),this.renderBody(this.$(".modal-body")),this.renderFooter(this.$(".modal-footer")),this},hide:function(){this.$el.modal("hide")},show:function(){this.$el.modal("show")},primaryButtonClicked:function(){this.trigger("click:primaryButton",this)},cancelButtonClicked:function(){this.trigger("click:cancelButton",this)},closeButtonClicked:function(){this.trigger("click:closeButton",this)},submitKeyPressed:function(t){var n=e(t.target);n.is(o)&&n.blur(),this.primaryButtonClicked()},dialogShown:function(){this.trigger("show"),t.debounce(function(){this.$("input:text:enabled:visible:first").focus()}.bind(this),0)();return},cleanup:function(){this.trigger("hide");return},renderBody:function(e){},renderHeader:function(e){e.html(this.settings.get("headerTemplate")),e.find(".text-dialog-title").html(this.settings.get("titleLabel"))},renderFooter:function(e){e.html(this.settings.get("footerTemplate"));var t=e.find(".btn-dialog-primary.label_from_data");this.settings.has("primaryButtonLabel")?(t.html(this.settings.get("primaryButtonLabel")),t.show()):(t.html(""),t.hide());var n=e.find(".btn-dialog-cancel.label_from_data");this.settings.has("cancelButtonLabel")?(n.html(this.settings.get("cancelButtonLabel")),n.show()):(n.html(""),n.hide())},template:'                <div class="modal-header"></div>                <div class="modal-body <%- bodyClassName %>"></div>                <div class="modal-footer"></div>            ',_footerTemplate:'                <a href="#" class="btn btn-dialog-cancel label_from_data pull-left" data-dismiss="modal"></a>                <a href="#" class="btn btn-primary btn-dialog-primary label_from_data pull-right"></a>            ',_headerTemplate:'                <button type="button" class="close btn-dialog-close" data-dismiss="modal">x</button>                <h3 class="text-dialog-title"></h3>            '})}),define("views/shared/dialogs/TextDialog",["jquery","underscore","views/shared/dialogs/DialogBase","module"],function(e,t,n,r){return n.extend({moduleId:r.id,className:"modal",_text:"",initialize:function(e){n.prototype.initialize.call(this,e),this.settings.set("primaryButtonLabel",t("Ok").t()),this.settings.set("cancelButtonLabel",t("Cancel").t())},primaryButtonClicked:function(){n.prototype.primaryButtonClicked.call(this),this.hide()},setText:function(e){this._text=e,this.debouncedRender()},renderBody:function(e){e.html(this.bodyTemplate),e.find(".text-dialog-placeholder").html(this._text)},bodyTemplate:'                <span class="text-dialog-placeholder"></span>            '})}),define("views/shared/reportcontrols/details/History",["module","views/Base"],function(e,t){return t.extend({moduleId:e.id,tagName:"span",initialize:function(){t.prototype.initialize.apply(this,arguments),this.model.entry.on("change:updated",this.render,this)},render:function(){return this.$el.html(this.compiledTemplate({model:this.model})),this},template:'                Created June 18, 2010. Modified <%- model.entry.get("updated") %>.            '})}),define("views/shared/reportcontrols/details/Creator",["underscore","module","views/Base","uri/route","splunk.util"],function(e,t,n,r,i){return n.extend({moduleId:t.id,tagName:"span",initialize:function(){n.prototype.initialize.apply(this,arguments),this.model.report.entry.content.on("change:display.page.pivot.dataModel",this.render,this)},render:function(){var t,n,s=this.model.application.get("root"),o=this.model.application.get("locale"),u=this.model.application.get("app");return this.model.report.openInView()==="pivot"?(t=r.pivot(s,o,u,{data:{s:this.model.report.id}}),n='<a href="'+t+'" >'+e("Pivot").t()+"</a>"):(t=r.search(s,o,u,{data:{s:this.model.report.id}}),n='<a href="'+t+'" >'+e("Search").t()+"</a>"),this.$el.html(this.compiledTemplate({_:e,splunkUtil:i,createdByAnchor:n})),this},template:'                <%= splunkUtil.sprintf(_("Created by %s.").t(), createdByAnchor) %>            '})}),define("views/shared/documentcontrols/details/App",["module","views/Base"],function(e,t){return t.extend({moduleId:e.id,tagName:"span",initialize:function(){t.prototype.initialize.apply(this,arguments),this.model.entry.acl.on("change:app",this.render,this)},render:function(){return this.$el.html(this.compiledTemplate({model:this.model})),this},template:'                <%- model.entry.acl.get("app") %>            '})}),define("models/Cron",["jquery","underscore","models/Base","splunk.util"],function(e,t,n,r){var i=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments)},defaults:{minute:"0",hour:"6",dayOfMonth:"*",month:"*",dayOfWeek:"1",cronType:"weekly",cron_schedule:"0 6 * * 1"},validation:{cron_schedule:function(n,i,s){var o=s["ui.type"]||"scheduled";if(o==="scheduled"&&s.cronType==="custom"){if(t.isUndefined(n)||e.trim(n).length===0)return t("Custom cron is required").t();if(!r.validateCronString(n))return t("Invalid cron").t()}}},setCronType:function(e){var t=this.get("minute"),n=this.get("hour"),r=this.get("dayOfMonth"),s=this.get("month"),o=this.get("dayOfWeek");if(s!=="*"){this.set("cronType",i.CRON_TYPES.CUSTOM,e);return}if(/^[0-6]$/.test(o)){if(t==="0"&&/^([0-9]|1[0-9]|2[0-3])$/.test(n)&&r==="*"){this.set("cronType",i.CRON_TYPES.WEEKLY,e);return}}else if(o==="*")if(/^([0-9]|[1-2][0-9]|3[0-1])$/.test(r)){if(/^([0-9]|1[0-9]|2[0-3])$/.test(n)&&t==="0"){this.set("cronType",i.CRON_TYPES.MONTHLY,e);return}}else if(r==="*"){if(/^([0-9]|1[0-9]|2[0-3])$/.test(n)&&t==="0"){this.set("cronType",i.CRON_TYPES.DAILY,e);return}if(n==="*"&&/^(0|15|30|45)$/.test(t)){this.set("cronType",i.CRON_TYPES.HOURLY,e);return}}this.set("cronType",i.CRON_TYPES.CUSTOM,e)},setDefaults:function(){switch(this.get("cronType")){case i.CRON_TYPES.HOURLY:this.set("minute","0");break;case i.CRON_TYPES.DAILY:this.set("hour","0");break;case i.CRON_TYPES.WEEKLY:this.set({dayOfWeek:"1",hour:"0"});break;case i.CRON_TYPES.MONTHLY:this.set({dayOfMonth:"1",hour:"0"})}},getCronString:function(){var e=this.get("minute"),t=this.get("hour"),n=this.get("dayOfMonth"),r=this.get("month"),s=this.get("dayOfWeek"),o=this.get("cron_schedule"),u=this.get("cronType");switch(u){case i.CRON_TYPES.HOURLY:return e+" * * * *";case i.CRON_TYPES.DAILY:return"0 "+t+" * * *";case i.CRON_TYPES.WEEKLY:return"0 "+t+" * * "+s;case i.CRON_TYPES.MONTHLY:return"0 "+t+" "+n+" * *";case i.CRON_TYPES.CUSTOM:return o}},getDayOfWeekName:function(){return i.getDayOfWeekNameFromNum(parseInt(this.get("dayOfWeek"),10))},getScheduleString:function(){switch(this.get("cronType")){case"hourly":return r.sprintf(t("Hourly, at %s minutes past the hour.").t(),this.get("minute"));case"daily":return r.sprintf(t("Daily, at %s:00.").t(),this.get("hour"));case"weekly":return r.sprintf(t("Weekly, %(dayOfWeek)s at %(hour)s:00.").t(),{dayOfWeek:this.getDayOfWeekName(),hour:this.get("hour")});case"monthly":return r.sprintf(t("Monthly, on day %(dayOfMonth)s at %(hour)s:00.").t(),{dayOfMonth:this.get("dayOfMonth"),hour:this.get("hour")});case"custom":return t("Cron Schedule.").t()}}},{createFromCronString:function(e){var n=e.split(/\s+/);if(!n||n.length!==5)throw r.sprintf(t("Invalid cron string: %s").t(),e);var s=new i({minute:n[0],hour:n[1],dayOfMonth:n[2],month:n[3],dayOfWeek:n[4],cron_schedule:n.join(" ")});return s.setCronType(),s},getDayOfWeekNameFromNum:function(e){switch(e){case 0:return t("Sunday").t();case 1:return t("Monday").t();case 2:return t("Tuesday").t();case 3:return t("Wednesday").t();case 4:return t("Thursday").t();case 5:return t("Friday").t();case 6:return t("Saturday").t();case 7:return t("Sunday").t()}},CRON_TYPES:{HOURLY:"hourly",DAILY:"daily",WEEKLY:"weekly",MONTHLY:"monthly",CUSTOM:"custom"}});return i}),define("views/shared/reportcontrols/details/Schedule",["underscore","module","views/Base","models/Cron","util/time_utils","splunk.util"],function(e,t,n,r,i,s){return n.extend({moduleId:t.id,tagName:"span",initialize:function(){n.prototype.initialize.apply(this,arguments);var t=e.debounce(this.render,0);this.model.entry.content.on("change:is_scheduled change:cron_schedule change:action.email change:action.script",t,this)},render:function(){var t=e("Not Applicable for Real-time Reports.").t();this.model.isRealTime()||(this.model.entry.content.get("is_scheduled")?(this.cronModel=r.createFromCronString(this.model.entry.content.get("cron_schedule")),t=this.cronModel.getScheduleString(),this.model.entry.content.get("action.email")||this.model.entry.content.get("action.script")?t+=s.sprintf(e(" Actions: %s.").t(),this.model.getStringOfActions()):t+=e(" No actions.").t()):t=e("Not scheduled.").t()),this.$el.html(t)}})}),define("views/shared/ScheduleSentence",["jquery","module","underscore","views/Base","views/shared/controls/ControlGroup","views/shared/controls/SyntheticSelectControl"],function(e,t,n,r,i,s){return r.extend({moduleId:t.id,initialize:function(){r.prototype.initialize.apply(this,arguments);var t={lineOneLabel:"",lineTwoLabel:""};n.defaults(this.options,t);var o=n.map(n.range(0,46,15),function(e){return{label:e,value:e.toString()}}),u=n.map(n.range(24),function(e){return{label:e+":00",value:e.toString()}}),a=n.map(n.range(1,32),function(e){return{label:e,value:e.toString()}});this.children.timeRange=new i({className:"control-group",controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{modelAttribute:"cronType",model:this.model.cron,items:[{label:n("Run every hour").t(),value:"hourly"},{label:n("Run every day").t(),value:"daily"},{label:n("Run every week").t(),value:"weekly"},{label:n("Run every month").t(),value:"monthly"},{label:n("Run on Cron Schedule").t(),value:"custom"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:e.extend(!0,{},this.options.popdownOptions)},label:this.options.lineOneLabel}),this.children.hourly=new s({additionalClassNames:"schedule_hourly",modelAttribute:"minute",model:this.model.cron,items:o,save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:e.extend(!0,{},this.options.popdownOptions)}),this.children.weekly=new s({additionalClassNames:"schedule_weekly",modelAttribute:"dayOfWeek",model:this.model.cron,items:[{label:n("Monday").t(),value:"1"},{label:n("Tuesday").t(),value:"2"},{label:n("Wednesday").t(),value:"3"},{label:n("Thursday").t(),value:"4"},{label:n("Friday").t(),value:"5"},{label:n("Saturday").t(),value:"6"},{label:n("Sunday").t(),value:"0"}],save:!1,toggleClassName:"btn",labelPosition:"outside",popdownOptions:e.extend(!0,{},this.options.popdownOptions)}),this.children.monthly=new s({menuClassName:"dropdown-menu-short",additionalClassNames:"schedule_monthly",modelAttribute:"dayOfMonth",model:this.model.cron,items:a,save:!1,toggleClassName:"btn",labelPosition:"outside",popdownOptions:e.extend(!0,{},this.options.popdownOptions)}),this.children.daily=new s({menuClassName:"dropdown-menu-short",additionalClassNames:"schedule_daily",modelAttribute:"hour",model:this.model.cron,items:u,save:!1,toggleClassName:"btn",labelPosition:"outside",popdownOptions:e.extend(!0,{},this.options.popdownOptions)}),this.children.scheduleOptions=new i({controls:[this.children.hourly,this.children.weekly,this.children.monthly,this.children.daily],label:this.options.lineTwoLabel}),this.children.cronSchedule=new i({controlType:"Text",controlClass:"controls-block",controlOptions:{modelAttribute:"cron_schedule",model:this.model.cron},label:n("Cron Expression").t(),help:n("e.g. 00 18 *** (every day at 6PM).").t()}),this.model.cron.on("change:cronType",this.timeRangeToggle,this),this.model.cron.on("change:cronType",function(){this.model.cron.setDefaults()},this)},timeRangeToggle:function(){var e=this.children.scheduleOptions.$el.find(".pre_label"),t=this.children.scheduleOptions.$el.find(".hour_post_label"),n=this.children.scheduleOptions.$el.find(".weekly_pre_label"),r=this.children.scheduleOptions.$el.find(".monthly_pre_label"),i=this.children.scheduleOptions.$el.find(".daily_pre_label"),s=this.$el.find(".custom_time");this.children.hourly.$el.hide(),this.children.daily.$el.hide(),this.children.weekly.$el.hide(),this.children.monthly.$el.hide(),e.hide(),t.hide(),n.hide(),r.hide(),i.hide(),s.css("display","none");switch(this.model.cron.get("cronType")){case"hourly":this.children.scheduleOptions.$el.show(),this.children.hourly.$el.css("display",""),e.css("display",""),t.css("display","");break;case"daily":this.children.scheduleOptions.$el.show(),this.children.daily.$el.css("display",""),e.css("display","");break;case"weekly":this.children.scheduleOptions.$el.show(),this.children.weekly.$el.css("display",""),this.children.daily.$el.css("display",""),n.css("display",""),i.css("display","");break;case"monthly":this.children.scheduleOptions.$el.show(),this.children.monthly.$el.css("display",""),this.children.daily.$el.css("display",""),r.css("display",""),i.css("display","");break;case"custom":s.css("display",""),this.children.scheduleOptions.$el.hide()}},render:function(){return this.$el.append(this.children.timeRange.render().el),this.$el.append(this.children.scheduleOptions.render().el),this.children.scheduleOptions.$el.find(".schedule_hourly").before('<span class="pre_label">'+n("At ").t()+"</span>"),this.children.scheduleOptions.$el.find(".schedule_hourly").after('<span class="hour_post_label">'+n(" minutes past the hour").t()+"</span>"),this.children.scheduleOptions.$el.find(".schedule_weekly").before('<span class="weekly_pre_label">'+n("On ").t()+"</span>"),this.children.scheduleOptions.$el.find(".schedule_weekly .btn").width("80px"),this.children.scheduleOptions.$el.find(".schedule_monthly").before('<span class="monthly_pre_label">'+n("On day ").t()+"</span>"),this.children.scheduleOptions.$el.find(".schedule_monthly .btn").width("55px"),this.children.scheduleOptions.$el.find(".schedule_daily").before('<span class="daily_pre_label">'+n(" at ").t()+"</span>"),this.children.scheduleOptions.$el.find(".schedule_daily .btn").width("60px"),this.$el.append('<div class="custom_time"></div>'),this.$el.find(".custom_time").append(this.children.cronSchedule.render().el),this.timeRangeToggle(),this}})}),define("views/shared/reportcontrols/dialogs/schedule_dialog/step1/Schedule",["underscore","module","views/Base","views/shared/Modal","views/shared/ScheduleSentence","views/shared/controls/ControlGroup"],function(e,t,n,r,i,s){return n.extend({moduleId:t.id,className:"form form-horizontal",initialize:function(){n.prototype.initialize.apply(this,arguments);var t=this.model.inmem.entry.content.get("disabled")?e("Enable and Schedule Report").t():e("Schedule Report").t();this.children.name=new s({controlType:"Label",controlOptions:{modelAttribute:"name",model:this.model.inmem.entry},label:e("Report").t()}),this.children.scheduleCheck=new s({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"scheduled_and_enabled",model:this.model.inmem},label:t}),this.children.scheduleSentence=new i({model:{cron:this.model.cron},lineOneLabel:e("Schedule").t()}),this.model.inmem.on("change:scheduled_and_enabled",this.isScheduledToggle,this),this.model.timeRange.on("applied",function(){this.model.inmem.entry.content.set({"dispatch.earliest_time":this.model.timeRange.get("earliest"),"dispatch.latest_time":this.model.timeRange.get("latest")}),this.setLabel()},this),this.model.timeRange.on("change:earliest_epoch change:latest_epoch change:earliest change:latest",e.debounce(this.setLabel,0),this)},isScheduledToggle:function(){this.model.inmem.get("scheduled_and_enabled")?(this.$(".modal-btn-primary").html(e("Next").t()),this.children.scheduleSentence.$el.show(),this.$("div.timerange").show()):(this.children.scheduleSentence.$el.hide(),this.$("div.timerange").hide(),this.$(".modal-btn-primary").html(e("Save").t())),this.model.inmem.trigger("togglePrimaryButton")},setLabel:function(){var e=this.model.timeRange.generateLabel(this.collection);this.$el.find("span.time-label").text(e)},render:function(){return this.$el.append(this.children.name.render().el),this.model.inmem.entry.content.get("disabled")&&this.$el.append("<div>"+e("This report is currently disabled.").t()+"</div>"),this.$el.append(this.children.scheduleCheck.render().el),this.$el.append(this.children.scheduleSentence.render().el),this.$el.append('<div class="timerange" style="display: block;"><label class="control-label">'+e("Time Range").t()+"</label></div>"),this.$("div.timerange").append('<a href="#" class="btn timerange-control"><span class="time-label"></span><span class="icon-triangle-right-small"></span></a>'),this.setLabel(),this.isScheduledToggle(),this}})}),define("views/shared/reportcontrols/dialogs/schedule_dialog/step1/Master",["underscore","module","views/Base","views/shared/Modal","views/shared/reportcontrols/dialogs/schedule_dialog/step1/Schedule","views/shared/timerangepicker/dialog/Master","views/shared/FlashMessages"],function(e,t,n,r,i,s,o){return n.extend({SLIDE_ANIMATION_DISTANCE:450,SLIDE_ANIMATION_DURATION:500,moduleId:t.id,initialize:function(){n.prototype.initialize.apply(this,arguments),this.children.flashMessage=new o({model:this.model.cron}),this.children.scheduleView=new i({model:{application:this.model.application,inmem:this.model.inmem,cron:this.model.cron,timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal},collection:this.collection}),this.children.timeRangePickerView=new s({model:{timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal,application:this.model.application},collection:this.collection,showPresetsRealTime:!1,showCustomRealTime:!1,showCustomDate:!1,showCustomDateTime:!1,showPresetsAllTime:!0,enableCustomAdvancedRealTime:!1}),this.model.timeRange.on("applied",function(){this.closeTimeRangePicker()},this),this.model.inmem.on("togglePrimaryButton",this.togglePrimaryButton,this)},events:{"click .modal-btn-primary":function(e){this.model.inmem.get("scheduled_and_enabled")?this.model.inmem.trigger("next"):this.model.inmem.save({},{success:function(e,t){this.model.inmem.trigger("saveSuccessNotScheduled")}.bind(this)}),e.preventDefault()},"click a.btn.back":function(e){this.closeTimeRangePicker(),e.preventDefault()},"click a.timerange-control":function(e){this.showTimeRangePicker(),e.preventDefault()}},togglePrimaryButton:function(){this.model.inmem.get("scheduled_and_enabled")?this.$(".modal-btn-primary").html(e("Next").t()):this.$(".modal-btn-primary").html(e("Save").t())},showTimeRangePicker:function(){var t=this.$scheduleWrapper,n=this.$timeRangePickerWrapper;this.onBeforePaneAnimation(t,n),this.$visArea.animate({height:this.$timeRangePickerWrapper.height()},{duration:this.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation(t,n)}.bind(this)},this),this.$slideArea.animate({marginLeft:-this.SLIDE_ANIMATION_DISTANCE},{duration:this.SLIDE_ANIMATION_DURATION}),this.$el.animate({width:this.$timeRangePickerWrapper.width()},{duration:this.SLIDE_ANIMATION_DURATION}),this.$modalParent.animate({width:this.$timeRangePickerWrapper.width(),marginLeft:-(2*this.SLIDE_ANIMATION_DISTANCE/3)},{duration:this.SLIDE_ANIMATION_DURATION}),this.$(r.HEADER_TITLE_SELECTOR).html(e("Select Time Range").t()),this.$(".btn.back").show(),this.$(".btn-primary").hide(),this.$(".btn.cancel").hide()},closeTimeRangePicker:function(){var t=this.$timeRangePickerWrapper,n=this.$scheduleWrapper;this.onBeforePaneAnimation(t,n),this.$visArea.animate({height:this.$scheduleWrapper.height()},{duration:this.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation(t,n)}.bind(this)},this),this.$slideArea.animate({marginLeft:0},{duration:this.SLIDE_ANIMATION_DURATION}),this.$el.animate({width:this.$scheduleWrapper.width()},{duration:this.SLIDE_ANIMATION_DURATION}),this.$modalParent.animate({width:this.$scheduleWrapper.width(),marginLeft:-(this.SLIDE_ANIMATION_DISTANCE/2)},{duration:this.SLIDE_ANIMATION_DURATION}),this.$(r.HEADER_TITLE_SELECTOR).html(e("Edit Schedule").t()),this.$(".btn.back").hide(),this.$(".btn-primary").show(),this.$(".btn.cancel").show()},onBeforePaneAnimation:function(e,t){this.$visArea.css("overflow","hidden"),this.$visArea.css({height:e.height()+"px"}),t===this.$timeRangePickerWrapper&&this.children.timeRangePickerView.$el.show(),t.css({height:"",visibility:""})},onAfterPaneAnimation:function(e,t){e===this.$timeRangePickerWrapper&&this.children.timeRangePickerView.$el.hide(),this.$visArea.css("overflow",""),this.$visArea.css({height:""}),e.css({height:"2px",visibility:"hidden"})},render:function(){return this.$el.html(r.TEMPLATE),this.$(r.HEADER_TITLE_SELECTOR).html(e("Edit Schedule").t()),this.$(r.BODY_SELECTOR).remove(),this.$(r.FOOTER_SELECTOR).before('<div class="vis-area"><div class="slide-area"><div class="schedule-wrapper"><div class="'+r.BODY_CLASS+'" >'+"</div>"+"</div>"+'<div class="timerange-picker-wrapper">'+"</div>"+"</div>"+"</div>"),this.$visArea=this.$(".vis-area").eq(0),this.$slideArea=this.$(".slide-area").eq(0),this.$scheduleWrapper=this.$(".schedule-wrapper").eq(0),this.$timeRangePickerWrapper=this.$(".timerange-picker-wrapper").eq(0),this.$modalParent=$(".schedule-modal").eq(0),this.$(r.BODY_SELECTOR).prepend(this.children.flashMessage.render().el),this.$(r.BODY_SELECTOR).append(this.children.scheduleView.render().el),this.$timeRangePickerWrapper.append(this.children.timeRangePickerView.render().el),this.children.timeRangePickerView.$el.hide(),this.$(r.FOOTER_SELECTOR).append(r.BUTTON_CANCEL),this.$(r.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+e("Save").t()+"</a>"),this.$(r.FOOTER_SELECTOR).append('<a href="#" class="btn back modal-btn-back pull-left">'+e("Back").t()+"</a>"),this.$(".btn.back").hide(),this.togglePrimaryButton(),this}})}),define("views/shared/reportcontrols/dialogs/schedule_dialog/Step2",["underscore","module","views/Base","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages","splunk.util","uri/route","util/console"],function(e,t,n,r,i,s,o,u,a){return n.extend({moduleId:t.id,initialize:function(){n.prototype.initialize.apply(this,arguments),this.children.flashMessage=new s({model:this.model.inmem});var t="http://docs.splunk.com/";this.model.appLocal&&this.model.application?t=u.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.alert.email",this.model.application.get("app"),this.model.appLocal.entry.content.get("version"),this.model.appLocal.appAllowsDisable()):a.warn("The schedule dialog step 2 view needs the AppLocal and Application model passed to it"),this.children.sendEmailBox=new i({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"action.email",model:this.model.inmem.entry.content},label:e("Send Email").t(),help:o.sprintf(e("To send emails you must configure the settings in System Settings > Alert Email Settings. %s").t(),' <a href="'+t+'" target="_blank">'+e("Learn More").t()+"</a>")}),this.children.emailSubject=new i({controlType:"Text",controlOptions:{modelAttribute:"action.email.subject",model:this.model.inmem.entry.content,placeholder:e("Splunk Alert: $name$").t()},label:e("Subject").t()}),this.children.emailAddresses=new i({controlType:"Textarea",controlOptions:{modelAttribute:"action.email.to",model:this.model.inmem.entry.content},label:e("Email Addresses").t(),help:e("Semi-colon separated list. Email alert settings must be configured in Manger.").t()}),this.children.emailResultsFormat=new i({controlType:"SyntheticRadio",controlOptions:{modelAttribute:"ui_include_results",model:this.model.inmem,items:[{label:e("None").t(),value:"none"},{label:e("Text").t(),value:"html"},{label:e("CSV").t(),value:"csv"},{label:e("PDF").t(),value:"pdf"}],elastic:!0},label:e("Include results").t()}),this.children.runScriptBox=new i({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"action.script",model:this.model.inmem.entry.content},label:e("Run a Script").t()}),this.children.scriptFilename=new i({controlType:"Text",controlOptions:{modelAttribute:"action.script.filename",model:this.model.inmem.entry.content},label:e("Filename").t(),help:e("Located in $SPLUNK_HOME/bin/scripts").t()}),this.model.inmem.entry.content.on("change:action.email",this.toggleEmail,this),this.model.inmem.entry.content.on("change:action.script",this.toggleScript,this)},events:{"click .btn-primary":function(e){var t=[];this.model.inmem.entry.content.get("action.email")&&t.push("email"),this.model.inmem.entry.content.get("action.script")&&t.push("script"),this.model.inmem.entry.content.set("actions",t.join(", ")),this.model.inmem.trigger("saveSchedule"),e.preventDefault()},"click .back":function(e){this.model.inmem.entry.content.trigger("back"),e.preventDefault()}},toggleEmail:function(){this.model.inmem.entry.content.get("action.email")?(this.children.emailSubject.$el.show(),this.children.emailAddresses.$el.show(),this.children.emailResultsFormat.$el.show()):(this.children.emailSubject.$el.hide(),this.children.emailAddresses.$el.hide(),this.children.emailResultsFormat.$el.hide())},toggleScript:function(){this.model.inmem.entry.content.get("action.script")?this.children.scriptFilename.$el.show():this.children.scriptFilename.$el.hide()},render:function(){this.$el.html(r.TEMPLATE),this.$(r.HEADER_TITLE_SELECTOR).html(e("Edit Schedule").t()),this.$(r.BODY_SELECTOR).prepend(this.children.flashMessage.render().el),this.$(r.BODY_SELECTOR).append(r.FORM_HORIZONTAL_JUSTIFIED),this.$(r.BODY_FORM_SELECTOR).prepend('<p class="control-heading">'+e("Enable Actions").t()+"</p>"),this.$(r.BODY_FORM_SELECTOR).append(this.children.sendEmailBox.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.emailSubject.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.emailAddresses.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.emailResultsFormat.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.runScriptBox.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.scriptFilename.render().el),this.$(r.FOOTER_SELECTOR).append('<a href="#" class="btn back pull-left">'+e("Back").t()+"</a>"),this.$(r.FOOTER_SELECTOR).append(r.BUTTON_SAVE),this.toggleEmail(),this.toggleScript()}})}),define("views/shared/reportcontrols/dialogs/schedule_dialog/Master",["underscore","backbone","models/Cron","models/TimeRange","collections/services/data/ui/Times","views/shared/Modal","module","views/shared/reportcontrols/dialogs/schedule_dialog/step1/Master","views/shared/reportcontrols/dialogs/schedule_dialog/Step2"],function(e,t,n,r,i,s,o,u,a){return s.extend({moduleId:o.id,initialize:function(){s.prototype.initialize.apply(this,arguments),this.model={application:this.model.application,report:this.model.report,user:this.model.user,appLocal:this.model.appLocal,timeRange:new r,inmem:this.model.report.clone(),cron:n.createFromCronString(this.model.report.entry.content.get("cron_schedule")||"0 6 * * 1")},this.collection=new i,this.collectionDeferred=this.collection.fetch({data:{app:this.model.application.get("app"),owner:this.model.application.get("owner")}}),this.model.inmem.set({ui_include_results:"none",scheduled_and_enabled:!this.model.inmem.entry.content.get("disabled")&&this.model.inmem.entry.content.get("is_scheduled")}),this.transposeToUI(),this.children.step1=new u({model:{state:this.model.inmem.entry.content,application:this.model.application,inmem:this.model.inmem,cron:this.model.cron,timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal},collection:this.collection}),this.children.step2=new a({model:{inmem:this.model.inmem,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal}}),this.model.inmem.on("next",function(){this.model.cron.validate()},this),this.model.inmem.entry.content.on("back",function(){this.children.step2.$el.hide(),this.children.step1.$el.show()},this),this.model.cron.on("validated",function(e,t,n){e&&(this.children.step1.$el.hide(),this.children.step2.$el.show())},this),this.model.inmem.on("saveSuccessNotScheduled",function(){this.model.report.entry.content.set("is_scheduled",!1),this.hide()},this),this.model.inmem.on("saveSchedule",function(){this.trasposeFromUI(),this.model.inmem.entry.content.set("cron_schedule",this.model.cron.getCronString()),this.model.inmem.save({},{success:function(e,t){this.model.report.fetch(),this.hide()}.bind(this)})},this)},transposeToUI:function(){var e="none";this.model.inmem.entry.content.get("action.email.sendresults")&&(e=this.model.inmem.entry.content.get("action.email.format")),this.model.inmem.set("ui_include_results",e)},trasposeFromUI:function(){var e=this.model.inmem.get("ui_include_results");e==="none"?this.model.inmem.entry.content.set("action.email.sendresults",!1):this.model.inmem.entry.content.set({"action.email.sendresults":!0,"action.email.format":e,"action.email.sendpdf":e==="pdf","action.email.inline":e==="html"}),this.model.inmem.get("scheduled_and_enabled")&&this.model.inmem.entry.content.set({is_scheduled:!0,disabled:!1})},render:function(){this.$el.addClass("schedule-modal");var e=this.model.timeRange.save({earliest:this.model.inmem.entry.content.get("dispatch.earliest_time"),latest:this.model.inmem.entry.content.get("dispatch.latest_time")});$.when(e,this.collectionDeferred).then(function(){this.$el.append(this.children.step1.render().el),this.$el.append(this.children.step2.render().el),this.children.step2.$el.hide()}.bind(this))}})}),define("views/shared/reportcontrols/details/EditSchedule",["underscore","backbone","module","views/Base","views/shared/reportcontrols/dialogs/schedule_dialog/Master"],function(e,t,n,r,i){return r.extend({moduleId:n.id,tagName:"span",initialize:function(){r.prototype.initialize.apply(this,arguments)},events:{"click a.edit-schedule":function(e){this.children.scheduleDialog=new i({model:{report:this.model.report,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal},onHiddenRemove:!0}),$("body").append(this.children.scheduleDialog.render().el),this.children.scheduleDialog.show(),e.preventDefault()}},render:function(){return this.$el.html(this.compiledTemplate({_:e})),this},template:'                <a class="edit-schedule" href="#"><%- _("Edit").t() %></a>            '})}),define("views/shared/reportcontrols/details/Acceleration",["underscore","module","views/Base","splunk.util"],function(e,t,n,r){return n.extend({moduleId:t.id,tagName:"span",initialize:function(){n.prototype.initialize.apply(this,arguments);var t=e.debounce(this.render,0);this.model.entry.content.on("change:auto_summarize change:auto_summarize.dispatch.earliest_time",t,this)},render:function(){return this.$el.html(this.compiledTemplate({model:this.model,_:e,splunkUtil:r})),this},convertSummarizeTime:function(t){switch(t){case"-1d@h":return e("1 Day").t();case"-7d@d":return e("1 Week").t();case"-1mon@d":return e("1 Month").t();case"-3mon@d":return e("3 Months").t();case"-1y@d":return e("1 Year").t();case"0":return e("All Time").t();default:return e("Custom").t()}},template:'                <% if (model.entry.content.get("auto_summarize")) { %>                    <%- splunkUtil.sprintf(_("Enabled. Summary Range: %s.").t(), this.convertSummarizeTime(model.entry.content.get("auto_summarize.dispatch.earliest_time"))) %>                <% } else { %>                    <%- _("Disabled.").t() %>                <% } %>            '})}),define("views/shared/reportcontrols/dialogs/AccelerationDialog",["underscore","backbone","module","models/services/search/IntentionsParser","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages","splunk.util"],function(e,t,n,r,i,s,o,u){return i.extend({moduleId:n.id,initialize:function(t){i.prototype.initialize.apply(this,arguments),this.model={searchJob:this.model.searchJob,report:this.model.report,inmem:this.model.report.clone()},this.model.searchJob||(this.model.intentionsParser=new r,this.intentionsParserDeferred=this.model.intentionsParser.fetch({data:{q:this.model.report.entry.content.get("search"),timeline:!1}})),this.children.flashMessage=new o({model:this.model.inmem}),this.children.name=new s({controlType:"Label",controlOptions:{modelAttribute:"name",model:this.model.inmem.entry},label:e("Report").t()}),this.children.acceleration=new s({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"auto_summarize",model:this.model.inmem.entry.content},label:u.sprintf(e("Accelerate %s").t(),this.model.report.isAlert()?e("Alert").t():e("Report").t()),help:e("Acceleration may increase storage and processing costs.").t()}),this.children.summary_range=new s({controlType:"SyntheticSelect",controlOptions:{modelAttribute:"auto_summarize.dispatch.earliest_time",model:this.model.inmem.entry.content,items:[{label:e("1 Day").t(),value:"-1d@h"},{label:e("7 Days").t(),value:"-7d@d"},{label:e("1 Month").t(),value:"-1mon@d"},{label:e("3 Months").t(),value:"-3mon@d"},{label:e("1 Year").t(),value:"-1y@d"},{label:e("All Time").t(),value:"0"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0},label:e("Summary Range").t()}),this.model.inmem.entry.content.on("change:auto_summarize",function(){this.model.inmem.entry.content.get("auto_summarize")?(this.children.summary_range.$el.show(),this.model.inmem.entry.content.get("auto_summarize.dispatch.earliest_time")===""&&this.model.inmem.entry.content.set("auto_summarize.dispatch.earliest_time","-1d@h")):this.children.summary_range.$el.hide()},this),this.on("hidden",function(){this.model.inmem.get("updated")>this.model.report.get("updated")&&this.model.report.entry.content.set({auto_summarize:this.model.inmem.entry.content.get("auto_summarize"),"auto_summarize.dispatch.earliest_time":this.model.inmem.entry.content.get("auto_summarize.dispatch.earliest_time")})},this)},events:$.extend({},i.prototype.events,{"click .save.modal-btn-primary":function(e){this.model.inmem.save({},{success:function(e,t){this.model.report.fetch(),this.remove()}.bind(this)}),e.preventDefault()}}),render:function(){return this.$el.html(i.TEMPLATE),this.$(i.HEADER_TITLE_SELECTOR).html(e("Edit Acceleration").t()),this.$(i.BODY_SELECTOR).prepend(this.children.flashMessage.render().el),this.$(i.BODY_SELECTOR).append(i.FORM_HORIZONTAL),$.when(this.intentionsParserDeferred).then(function(){this.model.searchJob&&this.model.searchJob.canSummarize()||this.model.intentionsParser&&this.model.intentionsParser.get("canSummarize")?(this.$(i.BODY_FORM_SELECTOR).append(this.children.name.render().el),this.$(i.BODY_FORM_SELECTOR).append(this.children.acceleration.render().el),this.$(i.BODY_FORM_SELECTOR).append(this.children.summary_range.render().el),this.model.inmem.entry.content.get("auto_summarize")?this.children.summary_range.$el.show():this.children.summary_range.$el.hide(),this.$(i.FOOTER_SELECTOR).append(i.BUTTON_CANCEL),this.$(i.FOOTER_SELECTOR).append('<a href="#" class="save btn btn-primary modal-btn-primary pull-right">'+e("Save").t()+"</a>")):(this.$(i.BODY_FORM_SELECTOR).append("<div>"+e("This report can not be accelerated").t()+"</div>"),this.$(i.FOOTER_SELECTOR).append(i.BUTTON_DONE))}.bind(this)),this}})}),define("views/shared/reportcontrols/details/EditAcceleration",["underscore","backbone","module","views/Base","views/shared/reportcontrols/dialogs/AccelerationDialog"],function(e,t,n,r,i){return r.extend({moduleId:n.id,tagName:"span",initialize:function(){r.prototype.initialize.apply(this,arguments)},events:{"click a.edit-acceleration":function(e){this.children.accelerationDialog=new i({model:{report:this.model.report},onHiddenRemove:!0}),$("body").append(this.children.accelerationDialog.render().el),this.children.accelerationDialog.show(),e.preventDefault()}},render:function(){return this.$el.html(this.compiledTemplate({_:e})),this},template:'                <a class="edit-acceleration" href="#"><%- _("Edit").t() %></a>            '})}),define("views/shared/documentcontrols/details/Permissions",["underscore","module","views/Base","util/splunkd_utils","splunk.util"],function(e,t,n,r,i){return n.extend({moduleId:t.id,tagName:"span",initialize:function(){n.prototype.initialize.apply(this,arguments);var t=e.debounce(this.render,0);this.model.entry.acl.on("change:sharing change:owner",t,this)},render:function(){var e=this.model.entry.acl.get("sharing"),t=this.model.entry.acl.get("owner"),n=r.getPermissionLabel(e,t);return this.$el.html(this.compiledTemplate({permissionString:n})),this},template:"               <%- permissionString %>            "})}),define("views/shared/reportcontrols/details/EditPermissions",["underscore","backbone","module","views/Base","views/shared/documentcontrols/dialogs/permissions_dialog/Master"],function(e,t,n,r,i){return r.extend({moduleId:n.id,tagName:"span",initialize:function(){r.prototype.initialize.apply(this,arguments)},events:{"click a.edit-permissions":function(t){this.children.permissionsDialog=new i({model:this.model,collection:this.collection,onHiddenRemove:!0,nameLabel:e("Report").t()}),$("body").append(this.children.permissionsDialog.render().el),this.children.permissionsDialog.show(),t.preventDefault()}},render:function(){return this.$el.html(this.compiledTemplate({_:e})),this},template:'                <a class="edit-permissions" href="#"><%- _("Edit").t() %></a>            '})}),define("views/shared/reportcontrols/details/Master",["underscore","jquery","views/Base","module","views/shared/reportcontrols/details/History","views/shared/reportcontrols/details/Creator","views/shared/documentcontrols/details/App","views/shared/reportcontrols/details/Schedule","views/shared/reportcontrols/details/EditSchedule","views/shared/reportcontrols/details/Acceleration","views/shared/reportcontrols/details/EditAcceleration","views/shared/documentcontrols/details/Permissions","views/shared/reportcontrols/details/EditPermissions","bootstrap.modal"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return n.extend({moduleId:r.id,initialize:function(){n.prototype.initialize.apply(this,arguments),this.children.creatorView=new s({model:{report:this.model.report,application:this.model.application}}),this.children.appView=new o({model:this.model.report}),this.children.scheduleView=new u({model:this.model.report}),this.children.editScheduleView=new a({model:{report:this.model.report,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal}}),this.children.accelerationView=new f({model:this.model.report}),this.children.editAccelerationView=new l({model:{report:this.model.report,searchJob:this.model.searchJob}}),this.children.permissionsView=new c({model:this.model.report}),this.children.editPermissionsView=new h({model:this.model.report,collection:this.collection}),this.model.searchJob&&this.model.searchJob.on("prepared",function(){this.$("a.edit-acceleration").css("display","")},this)},render:function(){var t=this.model.report.entry.acl.get("can_write")&&(!this.model.report.entry.content.get("is_scheduled")||!!this.model.user.canScheduleSearch());return this.$el.html(this.compiledTemplate({_:e})),this.$("dd.creator").append(this.children.creatorView.render().el),this.$("dd.app").append(this.children.appView.render().el),this.$("dd.schedule").append(this.children.scheduleView.render().el),this.$("dd.acceleration").append(this.children.accelerationView.render().el),this.$("dd.permissions").append(this.children.permissionsView.render().el),t&&(this.model.user.canScheduleSearch()&&(this.model.report.isRealTime()||this.$("dd.schedule").append(this.children.editScheduleView.render().el),this.$("dd.acceleration").append(this.children.editAccelerationView.render().el)),this.model.report.entry.acl.get("can_change_perms")&&this.$("dd.permissions").append(this.children.editPermissionsView.render().el)),this.model.searchJob&&this.model.searchJob.isPreparing()&&this.$("a.edit-acceleration").css("display","none"),this.model.report.isPivotReport()&&(this.$("dt.acceleration").remove(),this.$("dd.acceleration").remove()),this},template:'            <dl class="list-dotted">                <!--TODO when these attributes exist-->                <!--<dt class="history"><%- _("History").t() %></dt>                    <dd class="history"></dd>-->                <dt class="creator"><%- _("Creator").t() %></dt>                    <dd class="creator"></dd>                <dt class="app"><%- _("App").t() %></dt>                    <dd class="app"></dd>                <dt class="schedule"><%- _("Schedule").t() %></dt>                    <dd class="schedule"></dd>                <dt class="acceleration"><%- _("Acceleration").t() %></dt>                    <dd class="acceleration"></dd>                <dt class="permissions"><%- _("Permissions").t() %></dt>                    <dd class="permissions"></dd>            </dl>        '})}),define("views/dashboards/panelcontrols/titledialog/Modal",["underscore","jquery","backbone","module","views/shared/controls/ControlGroup","views/shared/Modal"],function(e,t,n,r,i,s){return s.extend({moduleId:r.id,initialize:function(){s.prototype.initialize.apply(this,arguments);var t="display.general.title";this.model.workingReport=new n.Model,this.model.workingReport.set(t,this.model.report.entry.content.get(t,{tokens:!0})),this.children.panelTitleControlGroup=new i({label:e("Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:t}})},events:t.extend({},s.prototype.events,{"click .modal-btn-primary":"onSave"}),onSave:function(e){e.preventDefault(),this.model.report.entry.content.set(this.model.workingReport.toJSON(),{tokens:!0}),this.model.report.save(),this.hide()},render:function(){this.$el.html(s.TEMPLATE),this.$(s.HEADER_TITLE_SELECTOR).html(e("Edit Title").t()),this.$(s.BODY_SELECTOR).append(s.FORM_HORIZONTAL),this.$(s.BODY_FORM_SELECTOR).append(this.children.panelTitleControlGroup.render().el),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_CANCEL),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_SAVE)}})}),define("views/dashboards/panelcontrols/querydialog/Modal",["underscore","jquery","backbone","module","views/shared/controls/ControlGroup","views/shared/timerangepicker/dialog/Master","views/shared/Modal","models/TimeRange","collections/services/data/ui/Times","splunk.util","splunkjs/mvc/utils","views/Base","uri/route","splunkjs/mvc/simplexml/controller","util/time_utils","bootstrap.tooltip","util/console","splunkjs/mvc/tokenawaremodel","splunkjs/mvc/tokenutils"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return o.extend({SLIDE_ANIMATION_DISTANCE:450,SLIDE_ANIMATION_DURATION:500,moduleId:r.id,className:"modal edit-search-string",initialize:function(){o.prototype.initialize.apply(this,arguments),this.model.workingReport=new n.Model(e.pick(this.model.report.entry.content.toJSON({tokens:!0}),["search","dispatch.earliest_time","dispatch.latest_time"]),{applyTokensByDefault:!0,retrieveTokensByDefault:!0}),this.children.title=new i({label:e("Title").t(),controlType:"Label",controlClass:"controls-block",controlOptions:{model:this.model.report.entry.content,modelAttribute:"display.general.title"}}),this.children.searchStringInput=new i({label:e("Search String").t(),controlType:"Textarea",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"search"}}),this.model.report.isPivotReport()?this.children.searchStringInput.options.help='<a href="#" class="run-pivot">'+e("Run Pivot").t()+' <i class="icon-external"></i></a>':this.children.searchStringInput.options.help='<a href="#" class="run-search">'+e("Run Search").t()+' <i class="icon-external"></i></a>',this.collection=this.collection||{},this.collection.times=new a,this.collection.times.fetch({data:{app:this.model.application.get("app"),owner:this.model.application.get("owner")}}),this.model.timeRange=new u({earliest:this.model.workingReport.get("dispatch.earliest_time"),latest:this.model.workingReport.get("dispatch.latest_time")}),this.children.timeRangePickerView=new s({model:{state:this.model.workingReport,timeRange:this.model.timeRange,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal},collection:this.collection.times}),this.model.timeRange.on("applied",function(){this.closeTimeRangePicker(),this.model.workingReport.set({"dispatch.earliest_time":this.model.timeRange.get("earliest"),"dispatch.latest_time":this.model.timeRange.get("latest")}),this.setLabel()},this)},events:{"click .modal-btn-primary":function(e){e.preventDefault();var t=this.model.workingReport.toJSON();m.log("Applying attributes to report model: %o",t),this.model.report.entry.content.set(t),this.model.report.trigger("updateSearchString"),this.hide()},"click a.run-search":function(e){e.preventDefault();var t=this.model.workingReport.get("search",{tokens:!1}),n={q:t};if(!t)return;this.model.workingReport.has("dispatch.earliest_time")&&(n.earliest=this.model.workingReport.get("dispatch.earliest_time",{tokens:!1}),n.latest=this.model.workingReport.get("dispatch.latest_time",{tokens:!1}));var r=l.getPageInfo(),i=h.search(r.root,r.locale,r.app,{data:n});l.redirect(i,!0)},"click a.run-pivot":function(e){e.preventDefault();var t=this.model.workingReport.get("search",{tokens:!1}),n={q:t};if(!t)return;this.model.workingReport.has("dispatch.earliest_time")&&(n.earliest=this.model.workingReport.get("dispatch.earliest_time",{tokens:!1}),n.latest=this.model.workingReport.get("dispatch.latest_time",{tokens:!1}));var r=l.getPageInfo(),i=h.pivot(r.root,r.locale,r.app,{data:n});l.redirect(i,!0)},"click a.btn.back":function(e){e.preventDefault(),this.closeTimeRangePicker()},"click a.timerange-control":function(e){e.preventDefault(),this.showTimeRangePicker()}},handleSubmitButtonState:function(e){this.$(o.FOOTER_SELECTOR).find(".btn-primary")[e.get("elementCreateType")==="pivot"?"addClass":"removeClass"]("disabled")},setLabel:function(){var e=this.model.timeRange.generateLabel(this.collection);this.$el.find("span.time-label").text(e)},showTimeRangePicker:function(){var t=this.$addpanelContent,n=this.$timeRangePickerWrapper;this.onBeforePaneAnimation(t,n),this.$visArea.animate({height:this.$timeRangePickerWrapper.height()},{duration:this.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation(t,n)}.bind(this)},this),this.$slideArea.animate({marginLeft:-this.SLIDE_ANIMATION_DISTANCE},{duration:this.SLIDE_ANIMATION_DURATION}),this.$el.animate({width:this.$timeRangePickerWrapper.width()},{duration:this.SLIDE_ANIMATION_DURATION}),this.$(o.HEADER_TITLE_SELECTOR).html(e("Select Time Range").t()),this.$(".btn.back").show(),this.$(".btn-primary").hide(),this.$(".btn.cancel").hide()},closeTimeRangePicker:function(){var t=this.$timeRangePickerWrapper,n=this.$addpanelContent;this.onBeforePaneAnimation(t,n),this.$visArea.animate({height:this.$addpanelContent.height()},{duration:this.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation(t,n)}.bind(this)},this),this.$slideArea.animate({marginLeft:0},{duration:this.SLIDE_ANIMATION_DURATION}),this.$el.animate({width:this.$addpanelContent.width()},{duration:this.SLIDE_ANIMATION_DURATION}),this.$modalParent.animate({width:this.$addpanelContent.width(),marginLeft:-(this.SLIDE_ANIMATION_DISTANCE/2)},{duration:this.SLIDE_ANIMATION_DURATION}),this.$(o.HEADER_TITLE_SELECTOR).html(e("Edit Schedule").t()),this.$(".btn.back").hide(),this.$(".btn-primary").show(),this.$(".btn.cancel").show()},onBeforePaneAnimation:function(e,t){this.$visArea.css("overflow","hidden"),this.$visArea.css({height:e.height()+"px"}),t===this.$timeRangePickerWrapper&&this.children.timeRangePickerView.$el.show(),t.css({height:"",visibility:""})},onAfterPaneAnimation:function(e,t){e===this.$timeRangePickerWrapper&&this.children.timeRangePickerView.$el.hide(),this.$visArea.css("overflow",""),this.$visArea.css({height:""}),e.css({height:"2px",visibility:"hidden"})},setLabel:function(){var t=e("All Time").t();y.hasToken(this.model.timeRange.get("earliest"))?t=e("Inherit").t():t=this.model.timeRange.generateLabel(this.collection),this.$el.find("span.time-label").text(t)},render:function(){return this.$el.html(o.TEMPLATE),this.$(o.HEADER_TITLE_SELECTOR).html(e("Edit Search").t()),this.$(o.BODY_SELECTOR).remove(),this.$(o.FOOTER_SELECTOR).before('<div class="vis-area"><div class="slide-area"><div class="schedule-wrapper"><div class="'+o.BODY_CLASS+'" >'+"</div>"+"</div>"+'<div class="timerange-picker-wrapper">'+"</div>"+"</div>"+"</div>"),this.$visArea=this.$(".vis-area").eq(0),this.$slideArea=this.$(".slide-area").eq(0),this.$addpanelContent=this.$(".schedule-wrapper").eq(0),this.$timeRangePickerWrapper=this.$(".timerange-picker-wrapper").eq(0),this.$modalParent=this.$el,this.children.timeRangePickerView.$el.hide(),this.$(o.BODY_SELECTOR).append(o.FORM_HORIZONTAL),this.children.title.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.children.searchStringInput.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.$(o.BODY_FORM_SELECTOR).append(t('<div class="timerange" style="display: block;"><label class="control-label">'+e("Time Range").t()+"</label></div>")),this.$("div.timerange").append('<div class="controls"><a href="#" class="btn timerange-control"><span class="time-label"></span><span class="icon-triangle-right-small"></span></a></div>'),this.setLabel(),this.$timeRangePickerWrapper.append(this.children.timeRangePickerView.render().el),this.$(o.FOOTER_SELECTOR).append(o.BUTTON_CANCEL),this.$(o.FOOTER_SELECTOR).append(o.BUTTON_SAVE),this.$(o.FOOTER_SELECTOR).append('<a href="#" class="btn back modal-btn-back pull-left">'+e("Back").t()+"</a>"),this.$(".btn.back").hide(),this}})}),define("collections/Reports",["models/Report","collections/services/SavedSearches"],function(e,t){return t.extend({model:e,initialize:function(){t.prototype.initialize.apply(this,arguments)}},{ALERT_SEARCH_STRING:'(is_scheduled=1 AND (alert_type!=always OR alert.track=1 OR (dispatch.earliest_time="rt*" AND dispatch.latest_time="rt*" AND actions="*" )))'})}),define("views/dashboards/panelcontrols/ReportDialog",["jquery","underscore","backbone","module","views/shared/controls/ControlGroup","views/shared/Modal","splunkjs/mvc/utils","splunk.config","collections/Reports"],function(e,t,n,r,i,s,o,u,a){return s.extend({moduleId:r.id,initialize:function(){s.prototype.initialize.apply(this,arguments),this.model.workingReport=new n.Model,this.model.workingReport.set({title:""}),this.collection=new a;var e=o.getPageInfo();this.dfd=this.collection.fetch({data:{owner:u.USERNAME,app:e.app}}),this.dfd.done(t.bind(function(){this.ready=!0;var e=this.collection.map(function(e){return{label:e.entry.get("name"),value:e.get("id")}});this.children.reportsControlGroup=new i({label:t("Select Report").t(),controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"id",items:e,toggleClassName:"btn"}}),this.children.panelTitleControlGroup=new i({label:t("Panel Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"title"}})},this))},events:e.extend({},s.prototype.events,{"click .modal-btn-primary":"onSave"}),onSave:function(e){e.preventDefault(),this.hide(),this.model.report.trigger("updateReportID",this.model.workingReport.get("id"),this.model.workingReport.get("title"))},render:function(){this.dfd.done(t.bind(function(){this.$el.html(s.TEMPLATE),this.$(s.HEADER_TITLE_SELECTOR).html(t("Select a New Report").t()),this.$(s.BODY_SELECTOR).append(s.FORM_HORIZONTAL),this.$(s.BODY_FORM_SELECTOR).append(this.children.reportsControlGroup.render().el),this.$(s.BODY_FORM_SELECTOR).append(this.children.panelTitleControlGroup.render().el),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_CANCEL),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_SAVE)},this))}})}),define("views/dashboards/panelcontrols/CreateReportDialog",["jquery","underscore","backbone","module","views/shared/controls/ControlGroup","views/shared/Modal","views/shared/FlashMessages"],function(e,t,n,r,i,s,o){return s.extend({moduleId:r.id,initialize:function(){s.prototype.initialize.apply(this,arguments),this.model.workingReport=new n.Model({name:this.model.report.entry.content.get("display.general.title")}),this.children.flashMessages=new o({model:this.model.report}),this.children.reportNameControlGroup=new i({label:t("Report Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"name"}}),this.children.reportDescriptionControlGroup=new i({label:t("Description").t(),controlType:"Textarea",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"description"}}),this.listenTo(this.model.report,"successfulReportSave",this.closeDialog,this)},events:e.extend({},s.prototype.events,{"click .modal-btn-primary":"onSave"}),onSave:function(e){e.preventDefault(),this.model.report.trigger("saveAsReport",this.model.workingReport.get("name"),this.model.workingReport.get("description"))},closeDialog:function(){this.hide()},render:function(){this.$el.html(s.TEMPLATE),this.$(s.HEADER_TITLE_SELECTOR).html(t("Save panel as report.").t()),this.$(s.BODY_SELECTOR).prepend(this.children.flashMessages.render().el),this.$(s.BODY_SELECTOR).append(s.FORM_HORIZONTAL),this.$(s.BODY_FORM_SELECTOR).append(this.children.reportNameControlGroup.render().el),this.$(s.BODY_FORM_SELECTOR).append(this.children.reportDescriptionControlGroup.render().el),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_CANCEL),this.$(s.FOOTER_SELECTOR).append(s.BUTTON_SAVE)}})}),define("views/dashboards/panelcontrols/Master",["underscore","views/Base","models/Base","jquery","module","views/shared/controls/SyntheticSelectControl","views/shared/dialogs/TextDialog","views/shared/delegates/Popdown","views/shared/reportcontrols/details/Master","collections/services/authorization/Roles","models/Application","splunkjs/mvc/utils","splunk.config","views/dashboards/panelcontrols/titledialog/Modal","views/dashboards/panelcontrols/querydialog/Modal","views/dashboards/panelcontrols/ReportDialog","views/dashboards/panelcontrols/CreateReportDialog","uri/route","util/console","splunk.util"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){var w=t.extend({moduleId:i.id,initialize:function(e){t.prototype.initialize.apply(this,arguments),this.model.report.on("change:id",this.updateReportView,this),this.model.report.entry.content.on("change",this.updateReportView,this),this.collection=this.collection||{},this.collection.roles=new f({}),this.collection.roles.fetch()},onChangeElementTitle:function(e){e.preventDefault(),this.children.titleDialogModal=new p({model:{report:this.model.working},onHiddenRemove:!0}),r("body").append(this.children.titleDialogModal.render().el),this.children.titleDialogModal.show(),this.children.popdown.hide()},onChangeSearchString:function(e){e.preventDefault(),this.children.queryDialogModal=new d({model:{report:this.model.report,appLocal:this.model.appLocal,application:this.model.application,user:this.model.user},onHiddenRemove:!0}),r("body").append(this.children.queryDialogModal.render().el),this.children.queryDialogModal.show(),this.children.popdown.hide()},updateReportView:function(){this.debouncedRender()},render:function(){var e,t={};return this.model.report.get("id")?e=this.model.report.isPivotReport()?"icon-report-pivot":"icon-report-search":e=this.model.report.isPivotReport()?"icon-pivot":"icon-search-thin",t.panelClass=e,this.$el.html(this.compiledTemplate(t)),this.children.popdown=new u({el:this.el,mode:"dialog"}),this._renderPanelControls(),this},_renderPanelControls:function(){this.$(".dropdown-menu").html(e.template(this._panelControlsTemplate,{_:e}));var t;this.model.report.get("id")?t=this.model.report.isPivotReport()?e("PIVOT REPORT").t():e("SEARCH REPORT").t():t=this.model.report.isPivotReport()?e("INLINE PIVOT").t():e("INLINE SEARCH").t();var n=e.template('<li class="panelType"><%- panelType %></li>',{panelType:t});if(this.model.report.get("id")){var i=e.template('<ul class="report_actions"><%= panelTypeLI %><li><a class="viewPanelReport" href="#"><%- reportName %><span class="icon-triangle-right-small"></span></a></li></ul>',{panelTypeLI:n,reportName:this.model.report.entry.get("name")});this.$(".panel_actions").before(i),this.$(".panel_actions").prepend('<li><a href="#" class="changeElementTitle">'+e("Edit Title").t()+"</a></li>")}else this.$(".panel_actions").prepend(r('<li><a class="convertToReport" href="#">'+e("Convert to Report").t()+"</a></li>")),this.$(".panel_actions").prepend('<li><a href="#" class="changeSearchString">'+e("Edit Search String").t()+"</a></li>"),this.$(".panel_actions").prepend('<li><a href="#" class="changeElementTitle">'+e("Edit Title").t()+"</a></li>"),this.$(".panel_actions").prepend(n)},_panelControlsTemplate:'                <div class="arrow"></div>                <ul class="panel_actions">                    <li><a class="deletePanel" href="#"><%- _("Delete").t() %></a></li>                </ul>        ',template:'            <a class="dropdown-toggle btn-pill" href="#">                    <span class="<%- panelClass %>"></span><span class="caret"></span>            </a>            <div class="dropdown-menu">            </div>        ',onDelete:function(t){t.preventDefault(),this.children.dialog=new o({id:"modal_delete"}),this.children.dialog.settings.set("primaryButtonLabel",e("Delete").t()),this.children.dialog.settings.set("cancelButtonLabel",e("Cancel").t()),this.children.dialog.on("click:primaryButton",this.dialogDeleteHandler,this),this.children.dialog.settings.set("titleLabel",e("Delete").t()),this.children.dialog.setText(b.sprintf(e("Are you sure you want to delete %s?").t(),this.model.report.entry.content.get("display.general.title"))),r("body").append(this.children.dialog.render().el),this.children.dialog.show(),this.children.popdown.hide()},dialogDeleteHandler:function(){this.children.dialog.hide(),this.children.dialog.remove(),this.model.report.deleteXML()},onViewPanelReport:function(t){t.preventDefault(),t.stopPropagation();var n="",i,s,o=this.model.application.get("root"),u=this.model.application.get("locale"),f=this.model.application.get("app");i=g.report(o,u,f,{data:{s:this.model.report.get("id")}}),this.model.report.isPivotReport()?(n=this.pivotReportDetailsTemplate,s=g.pivot(o,u,f,{data:{s:this.model.report.get("id")}})):(n=this.searchReportDetailsTemplate,s=g.search(o,u,f,{data:{s:this.model.report.get("id")}})),this.$(".dropdown-menu").html(e.template(n,{viewReportLink:i,editReportLink:s,_:e})),this.children.reportDetails&&this.children.reportDetails.remove(),this.children.reportDetails=new a({model:{report:this.model.report,application:this.model.application,appLocal:this.model.appLocal,user:this.model.user},collection:this.collection.roles}),this.$(".reportDetails").prepend(r("<li/>").append(this.children.reportDetails.render().el));var l=this.model.report.entry.content.get("description");l&&this.$(".reportDetails").prepend(r("<li/>").addClass("report-description").text(l)),this.$(".reportDetails").prepend(r("<li/>").addClass("report-name").text(this.model.report.entry.get("name"))),this.$(".dropdown-menu").addClass("show-details"),r(window).trigger("resize")},searchReportDetailsTemplate:'            <div class="arrow"></div>            <a class="dialogBack btn" href="#"><span class="icon-triangle-left-small"/> <%- _("Back").t() %></a>            <ul class="reportDetails">                <li><a href="<%- viewReportLink %>" class="viewSearchReport"><%- _("View").t() %></a></li>                <li><a href="<%- editReportLink %>" class="openSearchReport"><%- _("Open in Search").t() %></a></li>                <li><a href="#" class="cloneSearchReport"><%- _("Clone to an Inline Search").t() %></a></li>            </ul>            <ul class="reportActions">                <li><a href="#" class="selectNewReport"><%- _("Select New Report").t() %></a></li>                <li><a href="#" class="useReportFormatting"><%- _("Use Report Formatting On Visualization").t() %></a></li>            </ul>        ',pivotReportDetailsTemplate:'            <div class="arrow"></div>            <a class="dialogBack btn" href="#"><span class="icon-triangle-left-small"/> <%- _("Back").t() %></a>            <ul class="reportDetails">                <li><a href="<%- viewReportLink %>" class="viewPivotReport"><%- _("View").t() %></a></li>                <li><a href="<%- editReportLink %>" class="openPivotReport"><%- _("Open in Pivot").t() %></a></li>                <li><a href="#" class="clonePivotReport"><%- _("Clone to an Inline Pivot").t() %></a></li>            </ul>            <ul class="reportActions">                <li><a class="selectNewReport"><%- _("Select New Report").t() %></a></li>                <li><a class="useReportFormatting"><%- _("Use Report Formatting On Visualization").t() %></a></li>            </ul>        ',onDialogBack:function(e){e.preventDefault(),e.stopPropagation(),this._renderPanelControls(),this.$(".dropdown-menu").removeClass("show-details"),r(window).trigger("resize")},tbd:function(e){e.preventDefault(),alert("Coming soon to a Splunk near you!")},convertToInlineSearch:function(t){t.preventDefault(),this.children.dialog=new o({id:"modal_inline"}),this.children.dialog.settings.set("primaryButtonLabel",e("Clone to Inline Search").t()),this.children.dialog.settings.set("cancelButtonLabel",e("Cancel").t()),this.children.dialog.on("click:primaryButton",this._convertToInlineSearch,this),this.children.dialog.settings.set("titleLabel",e("Clone to Inline Search").t()),this.children.dialog.setText("<div>                <p>"+e("The report will be cloned to an inline search.").t()+"</p>                <p>"+e("The inline search:").t()+"                </p><ul>                <li>"+e("Cannot be scheduled.").t()+"</li>                <li>"+e("Will run every time the dashboard is loaded.").t()+"</li>                <li>"+e("Will use the permissions of the dashboard.").t()+"</li>                </ul>                </div>"),r("body").append(this.children.dialog.render().el),this.children.dialog.show(),this.children.popdown.hide()},convertToInlinePivot:function(t){t.preventDefault(),this.children.dialog=new o({id:"modal_inline"}),this.children.dialog.settings.set("primaryButtonLabel",e("Clone to Inline Pivot").t()),this.children.dialog.settings.set("cancelButtonLabel",e("Cancel").t()),this.children.dialog.on("click:primaryButton",this._convertToInlineSearch,this),this.children.dialog.settings.set("titleLabel",e("Clone to Inline Pivot").t()),this.children.dialog.setText("<div>                <p>"+e("The report will be cloned to an inline pivot.").t()+"</p>                <p>"+e("The inline pivot:").t()+"                </p><ul>                <li>"+e("Cannot be scheduled.").t()+"</li>                <li>"+e("Will run every time the dashboard is loaded.").t()+"</li>                <li>"+e("Will use the permissions of the dashboard.").t()+"</li>                </ul>                </div>"),r("body").append(this.children.dialog.render().el),this.children.dialog.show(),this.children.popdown.hide()},_convertToInlineSearch:function(){this.children.dialog.hide(),this.children.dialog.remove(),this.model.report.trigger("makeInline")},useReportFormatting:function(t){t.preventDefault(),this.children.dialog=new o({id:"modal_use_report_formatting"}),this.children.dialog.settings.set("primaryButtonLabel",e("Use Report Formatting on Visualization").t()),this.children.dialog.settings.set("cancelButtonLabel",e("Cancel").t()),this.children.dialog.on("click:primaryButton",this._useReportFormatting,this),this.children.dialog.settings.set("titleLabel",e("Use Report Formatting").t()),this.children.dialog.setText(e("Use only the report formatting?").t()),r("body").append(this.children.dialog.render().el),this.children.dialog.show(),this.children.popdown.hide()},_useReportFormatting:function(){this.children.dialog.hide(),this.children.dialog.remove(),this.model.report.trigger("useReportFormatting")},selectNewReport:function(e){e.preventDefault(),this.children.newReportDialog=new v({model:{report:this.model.report},onHiddenRemove:!0}),r("body").append(this.children.newReportDialog.render().el),this.children.newReportDialog.show(),this.children.popdown.hide()},convertToReport:function(e){e.preventDefault(),this.children.createReportDialog=new m({model:{report:this.model.report},onHiddenRemove:!0}),r("body").append(this.children.createReportDialog.render().el),this.children.createReportDialog.show(),this.children.popdown.hide()},events:{"click a.deletePanel":"onDelete","click a.viewPanelReport":"onViewPanelReport","click a.changeElementTitle":"onChangeElementTitle","click a.changeSearchString":"onChangeSearchString","click a.dialogBack":"onDialogBack","click a.cloneSearchReport":"convertToInlineSearch","click a.clonePivotReport":"convertToInlinePivot","click a.selectNewReport":"selectNewReport","click a.convertToReport":"convertToReport","click a.useReportFormatting":"useReportFormatting"}});return w}),define("splunkjs/mvc/simplexml/paneleditor",["require","exports","module","../mvc","../basesplunkview","models/Report","views/shared/vizcontrols/Master","views/dashboards/panelcontrols/Master","../savedsearchmanager","../searchmanager","splunkjs/mvc/utils","underscore","splunk.config","models/Base","util/console","./controller","../tokenawaremodel"],function(e,t,n){var r=e("../mvc"),i=e("../basesplunkview"),s=e("models/Report"),o=e("views/shared/vizcontrols/Master"),u=e("views/dashboards/panelcontrols/Master"),a=e("../savedsearchmanager"),f=e("../searchmanager"),l=e("splunkjs/mvc/utils"),c=e("underscore"),h=e("splunk.config"),p=e("models/Base"),d=e("util/console"),v=e("./controller"),m=e("../tokenawaremodel"),g=p.extend({initialize:function(e,t){this._report=t.report,this.entry=new p,this.entry.content=new m({},{applyTokensByDefault:!0,retrieveTokensByDefault:!0}),this.entry.set(this._report.entry.toJSON({tokens:!0})),this.contentSyncer=l.syncModels({source:this._report.entry.content,dest:this.entry.content,auto:"push"}),p.prototype.initialize.call(this,e)},save:function(e,t){e&&this.set(e,t),this._report.entry.set(this.entry.toJSON()),this._report.entry.content.set(this.entry.content.toJSON({tokens:!0})),this._report.saveXML()},syncOff:function(){this.contentSyncer.destroy(),this.off()}}),y=i.extend({className:"panel-editor",initialize:function(){this.children=this.children||{},i.prototype.initialize.call(this),this.model=this.model||{},this.model.report=this.model.report||new s,this.model.working=new g({},{report:this.model.report}),this.manager=this.options.manager,this._instantiateChildren(),this.bindToComponent(this.manager,this.onManagerChange,this),this.listenTo(this.model.report,"makeInline",this._makePanelInline,this),this.listenTo(this.model.report,"useReportFormatting",this._useReportFormatting,this),this.listenTo(this.model.report,"updateReportID",this._updateReportID,this),this.listenTo(this.model.report,"updateSearchString",this._updateSearchManager,this),this.listenTo(this.model.report,"saveAsReport",this._saveAsReport,this),this.model.application=v.model.app,this.model.user=v.model.user,this.model.appLocal=v.model.appLocal},_instantiateChildren:function(){this.children.vizControl=new o({model:{report:this.model.working},vizTypes:["events","statistics","visualizations"],saveOnApply:!0}),this.children.panelControl=new u({model:{report:this.model.report,working:this.model.working,application:this.model.application,appLocal:this.model.appLocal,user:this.model.user}})},remove:function(){this.model.working.syncOff(),this._removeChildren(),i.prototype.remove.apply(this,arguments)},_removeChildren:function(){this.children.vizControl.remove(),this.children.panelControl.remove()},_updateSearchManager:function(){var e=r.Components.get(this.manager);e.query&&e.query.set("search",this.model.report.entry.content.get("search",{tokens:!0}),{tokens:!0}),e.search&&e.search.set({earliest_time:this.model.report.entry.content.get("dispatch.earliest_time",{tokens:!0}),latest_time:this.model.report.entry.content.get("dispatch.latest_time",{tokens:!0})}),this.model.report.saveXML()},onManagerChange:function(e,t){this._seenManager?this.model.report.saveXML():this._seenManager=!0,this._removeChildren(),this._instantiateChildren(),this.render()},render:function(){return this.$el.append(this.children.panelControl.render().el),this.$el.append(this.children.vizControl.render().el),this},_makePanelInline:function(){r.Components.revokeInstance(this.manager,{silent:!0}),delete this.model.report.id,this.model.report.unset("id",{silent:!0}),new f({id:this.manager,latest_time:this.model.report.entry.content.get("dispatch.latest_time"),earliest_time:this.model.report.entry.content.get("dispatch.earliest_time"),search:this.model.report.entry.content.get("search"),app:l.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0})},_useReportFormatting:function(){var e=this.model.report.fetch();e.done(c.bind(function(){this.model.report.saveXML({clearOptions:!0})},this))},_updateReportID:function(e,t){this.model.report.unset("id",{silent:!0}),this.model.report.id=e,this.model.report.set("id",e);var n=this.model.report.fetch();n.done(c.bind(function(){this.model.report.entry.content.set("display.general.manager",this.manager),this.model.report.entry.content.set({"display.general.title":t}),r.Components.revokeInstance(this.manager,{silent:!0}),new a({id:this.manager,searchname:this.model.report.entry.get("name"),app:l.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0})},this))},_saveAsReport:function(e,t){d.log("Saving Panel as Report"),this.model.report.entry.content.set({name:e}),this.model.report.entry.content.set({description:t});var n=this.model.report.save({},{data:{app:l.getCurrentApp(),owner:h.USERNAME}});n.done(c.bind(function(){d.log("Report saved successfully"),this.model.report.trigger("successfulReportSave"),r.Components.revokeInstance(this.manager,{silent:!0}),new a({id:this.manager,searchname:e,app:l.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0})},this))}});return y}),define("splunkjs/mvc/simplexml/element/base",["require","underscore","jquery","backbone","splunk.util","../../basesplunkview","../../../mvc","../../utils","../controller","models/DashboardReport","util/console","../../progressbarview","../../refreshtimeindicatorview","../../resultslinkview","../paneleditor","../../savedsearchmanager","../../messages","../../settings"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("splunk.util"),s=e("../../basesplunkview"),o=e("../../../mvc"),u=e("../../utils"),a=e("../controller"),f=e("models/DashboardReport"),l=e("util/console"),c=e("../../progressbarview"),h=e("../../refreshtimeindicatorview"),p=e("../../resultslinkview"),d=e("../paneleditor"),v=e("../../savedsearchmanager"),m=e("../../messages"),g=e("../../settings"),y={},b=(new f).fetch(),w=s.extend({initialVisualization:"#abstract",configure:function(){this.options.settingsOptions=t.extend({retainUnmatchedTokens:!0,tokens:!0},this.options.settingsOptions||{}),this.options=t.extend(this.options,{id:this.id,manager:this.options.managerid,title:this.$("h3").text()}),s.prototype.configure.apply(this,arguments)},initialize:function(){this.configure(),this.visualization=null,this.model=new f,this.managerid=this.options.managerid,o.enableDynamicTokens(this.settings),this.settings._sync=u.syncModels(this.settings,this.model.entry.content,{auto:!0,prefix:"display.general."}),this.bindToComponent(this.managerid,this.onManagerChange,this);var e=this.typeModel=new r.Model({type:this.initialVisualization});this.reportReady=n.Deferred(),this.listenTo(this.typeModel,"change",this.createVisualization,this),this.listenTo(a.getStateModel(),"change:edit",this.onEditModeChange,this),this.reportReady.done(t.bind(function(){this.listenTo(this.model.entry.content,"change:display.general.type change:display.visualizations.type change:display.events.type",function(t){var n=t.get("display.general.type"),r=["display",n,"type"].join("."),i=t.get(r),s=i?[n,i].join(":"):n;e.set("type",y.hasOwnProperty(s)?s:n)},this),this.listenTo(this.settings,"change:title",this.updateTitle,this),this.listenTo(this.model,"removedPanel",this.remove,this)},this))},remove:function(){this._removeVisualization(),t([this.refreshTime,this.panelEditor]).chain().filter(t.identity).invoke("remove"),this.settings&&this.settings._sync&&this.settings._sync.destroy(),o.Components.get("dashboard").removeElement(this.id),s.prototype.remove.call(this)},onManagerChange:function(e,n){var r=this;if(n instanceof v){var i=n.get("searchname"),s=a.getStateModel().app;this.model.id=["","servicesNS",s.get("owner"),s.get("app"),"saved","searches",i].join("/"),this.model.fetch().done(function(){r.initialVisualization!=="#abstract"&&r.model.entry.content.set(r._initialVisualizationToAttributes()),r.reportReady.resolve(r.model)}).fail(function(e){l.error("Failed to load saved search",arguments),e.status===404&&r.handleSavedSearchError(t("Warning: saved search not found: ").t()+JSON.stringify(i))})}else n?b.done(function(e){r.model.entry.content.set(e.entry[0].content),r.initialVisualization!=="#abstract"&&r.model.entry.content.set(r._initialVisualizationToAttributes()),r.model.entry.content.set({search:n.get("search"),"dispatch.earliest_time":n.get("earliest_time"),"dispatch.latest_time":n.get("latest_time")}),r.reportReady.resolve(r.model)}):b.done(function(e){r.model.entry.content.set(e.entry[0].content),r.initialVisualization!=="#abstract"&&r.model.entry.content.set(r._initialVisualizationToAttributes()),r.reportReady.resolve(r.model)})},handleSavedSearchError:function(e){var t=this.$(".panel-body>.msg");t.length||(t=n('<div class="msg"></div>').appendTo(this.$(".panel-body"))),m.render({level:"warning",icon:"warning-sign",message:e},t)},_initialVisualizationToAttributes:function(){var e=this.initialVisualization.split(":"),t={"display.general.type":e[0]};return e.length>1&&(t[["display",e[0],"type"].join(".")]=e[1]),t},onEditModeChange:function(e){var n=this._debouncedOnEditModeChange;n||(n=this._debouncedOnEditModeChange=t.debounce(t.bind(this._onEditModeChange,this),0)),this.reportReady.done(function(){n(e)})},_onEditModeChange:function(e){e.get("edit")?(this.refreshTime&&(this.refreshTime.remove(),this.refreshTime=null),this.updateTitle(),this.createPanelElementEditor()):(this.panelEditor&&(this.panelEditor.remove(),this.panelEditor=null),this.createRefreshTimeIndicator(),this.updateTitle())},createPanelElementEditor:function(){this.panelEditor&&(this.panelEditor.remove(),this.panelEditor=null),this.panelEditor=new d({manager:this.managerid,model:{report:this.model}}),this.$el.prepend(this.panelEditor.render().el)},createRefreshTimeIndicator:function(){this.refreshTime||(this.refreshTime=(new h({id:t.uniqueId(this.id+"-refreshtime"),el:n('<div class="refresh-time-indicator pull-right"></div>').prependTo(this.$(".panel-head")),manager:this.managerid})).render())},handleDrilldown:function(e){this.trigger("drilldown",e)},createVisualization:function(e){var r=this._debouncedCreateViz;r||(r=this._debouncedCreateViz=t.debounce(t.bind(this._createVisualization,this),0)),n.when(this.reportReady).then(function(){r(e===!0)})},_removeVisualization:function(){this.visualization&&(this.visualization.off(),this.visualization.remove(),o.Components.revokeInstance(this.visualization.id,{silent:!0}),this.visualization=null),this.resultsLink&&(this.resultsLink.remove(),this.resultsLink=null)},_createVisualization:function(e){var r=!this.visualization;this.$(".panel-body>.msg").remove(),this._removeVisualization();var i=this.typeModel.get("type"),s=y[i];if(!s)throw new Error('Unsupported visualization type "'+i+'"');var u={el:n("<div></div>").appendTo(this.$(".panel-body")),reportModel:this.model.entry.content,managerid:this.settings.get("manager"),id:t.uniqueId(this.id+"-viz-")};if(r||e)u=t.extend({},this.options,u);this.visualization=(new s(u,{tokens:!0})).render();if(i==="events"){var a=o.Components.getInstance(this.settings.get("manager"));a.search.set("status_buckets",300)}this.trigger("create:visualization",this.visualization),r&&this.model.entry.content.set(t.defaults(this.model.entry.content.toJSON({tokens:!0}),this.visualization.reportDefaults));if(typeof this.visualization.getResultsLinkOptions=="function"){var f=this.visualization.getResultsLinkOptions(this.options)||{};this.resultsLink=(new p(t.extend({},f,this.options,{id:t.uniqueId(this.id+"-resultslink"),el:n('<div class="view-results pull-left"></div>').appendTo(this.$(".panel-footer")),manager:this.managerid,model:this.model}))).render()}this.visualization.on("drilldown",this.handleDrilldown,this)},getVisualization:function(e){var t=n.Deferred();return e&&t.done(e),this.visualization?t.resolve(this.visualization):this.once("create:visualization",t.resolve,t),t.promise()},render:function(){return this.createPanelStructure(),this.progressBar||(this.progressBar=(new c({id:t.uniqueId(this.id+"-progressbar"),manager:this.managerid,el:n('<div class="progress-container pull-right"></div>').prependTo(this.$(".panel-footer"))})).render()),this.createRefreshTimeIndicator(),this.createVisualization(),this.onEditModeChange(a.getStateModel()),this},createPanelStructure:function(){this.$(".panel-head").length||n('<div class="panel-head"></div>').prependTo(this.$el);var e=this.$(".panel-head>h3");e.length||n("<h3></h3>").prependTo(this.$(".panel-head")),this.updateTitle(),this.$(".panel-body").length||n('<div class="panel-body"></div>').appendTo(this.$el),this.$("panel-footer").length||n('<div class="panel-footer"></div>').appendTo(this.$el),this.$(".panel-footer").addClass("clearfix")},updateTitle:function(){var e=this.settings.get("title")||"";a.getStateModel().get("edit")&&!e?this.$(".panel-head>h3").empty().append(n('<span class="untitled">'+t("Untitled panel").t()+"</span>")):this.$(".panel-head>h3").text(e)},getExportParams:function(e){var t=o.Components.get(this.managerid),n={};return t&&t.job&&t.job.sid&&(n[e]=t.job.sid),n}},{registerVisualization:function(e,t){y[e]=t},getVisualization:function(e){var t=y[e];return t||(t=y[e.split(":")[0]]),t}});return w}),define("splunkjs/mvc/simplexml/dialog/addpanel/inline",["require","underscore","jquery","views/Base","views/shared/controls/ControlGroup","util/console","../../../utils","uri/route","util/time_utils","../../../tokenutils","bootstrap.tooltip"],function(e){var t=e("underscore"),n=e("jquery"),r=e("views/Base"),i=e("views/shared/controls/ControlGroup"),s=e("util/console"),o=e("../../../utils"),u=e("uri/route"),a=e("util/time_utils"),f=e("../../../tokenutils");e("bootstrap.tooltip");var l=r.extend({render:function(){this.el.innerHTML||this.$el.html(t.template(this.template,{label:this.options.label,controlClass:this.options.controlClass||""}));var e=this.$(".controls");return t.each(this.options.children,function(t){t.render().appendTo(e)}),this},template:'<label class="control-label"><%- label %></label><div class="controls <%- controlClass %>"></div>'});return r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments),this.children.searchField=new i({controlType:"Textarea",controlOptions:{modelAttribute:"search",model:this.model.report},label:t("Search String").t(),help:'<a href="#" class="run-search">'+t("Run Search").t()+' <i class="icon-external"></i></a>'}),this.listenTo(this.model.report,"change:elementCreateType",this.onModeChange,this),this.model.timeRange.on("applied",function(){this.model.report.set({"dispatch.earliest_time":this.model.timeRange.get("earliest"),"dispatch.latest_time":this.model.timeRange.get("latest")}),this.setLabel()},this)},events:{"click a.run-search":function(e){e.preventDefault();var t=this.model.report.get("search"),n={q:t},r=o.getPageInfo();if(!t)return;this.model.report.has("dispatch.earliest_time")&&(n.earliest=this.model.report.get("dispatch.earliest_time"),n.latest=this.model.report.get("dispatch.latest_time")),o.redirect(u.search(r.root,r.locale,r.app,{data:n}),!0)}},onModeChange:function(){var e=this.model.report.get("elementCreateType")==="inline"?"show":"hide";this.$el[e]()},setLabel:function(){var e=t("All Time").t();f.hasToken(this.model.timeRange.get("earliest"))?e=t("Inherit").t():e=this.model.timeRange.generateLabel(this.collection),this.$el.find("span.time-label").text(e)},render:function(){return this.children.searchField.render().appendTo(this.el),this.$el.append('<div class="timerange" style="display: block;"><label class="control-label">'+t("Time Range").t()+"</label></div>"),this.$("div.timerange").append('<div class="controls"><a href="#" class="btn timerange-control"><span class="time-label"></span><span class="icon-triangle-right-small"></span></a></div>'),this.setLabel(),this.onModeChange(),this}})}),define("splunkjs/mvc/simplexml/dialog/addpanel/report",["require","underscore","jquery","views/Base","views/shared/controls/ControlGroup","collections/services/SavedSearches","splunkjs/mvc/simplexml/controller","../../../utils","util/time_utils","models/Cron","splunk.util","uri/route"],function(e){var t=e("underscore"),n=e("jquery"),r=e("views/Base"),i=e("views/shared/controls/ControlGroup"),s=e("collections/services/SavedSearches"),o=e("splunkjs/mvc/simplexml/controller"),u=e("../../../utils"),a=e("util/time_utils"),f=e("models/Cron"),l=e("splunk.util"),c=e("uri/route");return r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments),this.children.reportPlaceholder=new r;var e=this.collection.reports,s=o.model.app,u=this.reportsLoaded=n.Deferred();e.fetch({data:{app:s.get("app"),owner:s.get("owner")}}).done(t.bind(function(){var t=e.map(function(e){return{label:e.entry.get("name"),value:e.id}});this.children.report=new i({label:"",controlType:"SyntheticSelect",controlOptions:{className:"btn-group add-panel-report",menuWidth:"narrow",toggleClassName:"btn",model:this.model,modelAttribute:"savedSearch",items:t}}),u.resolve(),this.model.set("savedSearch",t[0].value)},this)),this.children.searchField=new i({controlType:"Textarea",controlOptions:{modelAttribute:"savedSearchString",model:this.model},label:t("Search String").t(),help:'<a href="#" class="run-search">'+t("Run Search").t()+' <i class="icon-external"></i></a>'}),this.children.timerangeField=new i({controlType:"Label",controlOptions:{modelAttribute:"savedSearchTimerange",model:this.model},label:t("Time Range").t()}),this.children.schedule=new i({controlType:"Label",controlOptions:{modelAttribute:"savedSearchSchedule",model:this.model},label:t("Schedule").t()}),this.children.permissions=new i({controlType:"Label",controlOptions:{modelAttribute:"savedSearchPermissions",model:this.model},label:t("Permissions").t()}),this.model.set("savedSearchString","..."),this.listenTo(this.model,"change:elementCreateType",this.onModeChange,this),this.listenTo(this.model,"change:savedSearch",this.searchSelected,this)},events:{"click a.run-search":function(e){e.preventDefault();var t=this.model.get("savedSearch");if(!t)return;var n=u.getPageInfo(),r=c.search(n.root,n.locale,n.app,{data:{s:t}});u.redirect(r,!0)}},searchSelected:function(){var e=this.model.get("savedSearch"),n=this.collection.reports.get(e);this.model.set("savedSearchName",n.entry.get("name")),this.model.set("savedSearchString",n.entry.content.get("search"));var r=n.entry.content.get("dispatch.earliest_time"),i=n.entry.content.get("dispatch.latest_time"),s="statistics",o;n.entry.content.has("display.general.type")&&(s=n.entry.content.get("display.general.type"),s=="events"?s="statistics":(o=["display",s,"type"].join("."),n.entry.content.has(o)&&(s=[s,n.entry.content.get(o)].join(":")))),this.model.set("savedSearchVisualization",s),this.model.set("savedSearchTimerange",a.generateLabel(this.collection.timeRanges,r,null,i,null));var u=t("Never").t();if(n.entry.content.get("is_scheduled")){var c=f.createFromCronString(n.entry.content.get("cron_schedule"));u=c.getScheduleString()}this.model.set("savedSearchSchedule",u),this.model.set("savedSearchPermissions",l.sprintf(t("%s. Owned by %s.").t(),n.entry.acl.get("perms")?t("Shared").t():t("Not Shared").t(),n.entry.acl.get("owner")))},onModeChange:function(){this.$el[this.model.get("elementCreateType")==="saved"?"show":"hide"]()},render:function(){return this.children.reportPlaceholder.render().appendTo(this.el),n.when(this.reportsLoaded).then(t.bind(function(){this.children.report.render().appendTo(this.children.reportPlaceholder.el)},this)),this.children.searchField.render().appendTo(this.el),this.children.searchField.$("textarea").attr("readonly","readonly"),this.children.timerangeField.render().appendTo(this.el),this.children.schedule.render().appendTo(this.el),this.children.permissions.render().appendTo(this.el),this.onModeChange(),this}})}),define("splunkjs/mvc/simplexml/dialog/addpanel/pivot",["require","underscore","views/Base","../../../utils","uri/route"],function(e){var t=e("underscore"),n=e("views/Base"),r=e("../../../utils"),i=e("uri/route");return n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:elementCreateType",this.onModeChange,this)},render:function(){if(!this.el.innerHTML){var e=r.getPageInfo();this.$el.html(t.template(this.template,{pivotLink:i.data_models(e.root,e.locale,e.app)}))}return this.onModeChange(),this},onModeChange:function(){var e=this.model.get("elementCreateType")==="pivot"?"show":"hide";this.$el[e]()},template:'<label class="control-label"></label><div class="controls">'+t("Create a pivot panel in").t()+' <a href="<%= pivotLink %>">'+t("Pivot").t()+"</a>"+"</div>"})}),define("splunkjs/mvc/simplexml/dialog/addpanel/master",["require","exports","module","underscore","jquery","splunkjs/mvc","views/Base","views/shared/controls/ControlGroup","collections/services/SavedSearches","../../controller","./inline","./report","./pivot","util/console"],function(e,t,n){var r=e("underscore"),i=e("jquery"),s=e("splunkjs/mvc"),o=e("views/Base"),u=e("views/shared/controls/ControlGroup"),a=e("collections/services/SavedSearches"),f=e("../../controller"),l=e("./inline"),c=e("./report"),h=e("./pivot"),p=e("util/console");return o.extend({moduleId:t.id,className:"add-panel",initialize:function(){o.prototype.initialize.call(this,arguments),this.children.panelTitleControlGroup=new u({label:r("Content Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.report,modelAttribute:"title"}}),this.children.elementCreateType=new u({label:r("Content Type").t(),controlType:"SyntheticRadio",controlClass:"controls-thirdblock",controlOptions:{className:"btn-group btn-group-3 add-panel-select",items:[{value:"inline",label:'<i class="icon-search-thin"></i>',tooltip:r("Inline Search").t()},{value:"pivot",label:'<i class="icon-pivot"></i>',tooltip:r("Inline Pivot").t()},{value:"saved",label:'<i class="icon-report"></i>',tooltip:r("Report").t()}],model:this.model.report,modelAttribute:"elementCreateType"}});var e=f.collection.times,t=new a;this.children.inline=new l({model:this.model,collection:{timeRanges:e}}),this.children.report=new c({model:this.model.report,collection:{timeRanges:e,reports:t}}),this.children.pivot=new h({model:this.model.report})},render:function(){return this.$el.append(this.children.panelTitleControlGroup.render().el),this.$el.append(this.children.elementCreateType.render().el),this.$el.append(this.children.inline.render().el),this.$el.append(this.children.pivot.render().el),this.$el.append(this.children.report.render().el),this}})}),define("splunkjs/mvc/searchtemplate",["require","exports","module","underscore","./mvc","./utils","util/console","./searchmanager","./tokenawaremodel","./tokensafestring","backbone","splunk.util","./simplexml/controller"],function(e,t,n){var r=e("underscore"),i=e("./mvc"),s=e("./utils"),o=e("util/console"),u=e("./searchmanager"),a=e("./tokenawaremodel"),f=e("./tokensafestring"),l=e("backbone"),c=e("splunk.util"),h=e("./simplexml/controller"),p=l.Model.extend({initialize:function(e,t){this.tokenModel=t&&t.tokenModel||i.Global,this.on("change:search",this.detectTokens,this),this.has("search")&&this.detectTokens()},set:function(e,t,n){var r;return null===e?this:(typeof e=="object"?(r=e,n=t):(r={})[e]=t,n&&n.qualified&&r.search&&(r.search instanceof f?r.search=new f(c.stripLeadingSearchCommand(r.search.value)):r.search=c.stripLeadingSearchCommand(r.search)),l.Model.prototype.set.call(this,r,n))},get:function(e,t){var n=l.Model.prototype.get.apply(this,arguments);return e==="search"&&t&&t.qualified&&n&&(n=c.addLeadingSearchCommand(n)),n},detectTokens:function(){var e=this.tokens=r(s.discoverReplacementTokens(this.get("search"))).unique(),t=this.tokenModel;t.off(null,null,this),e.length&&r(e).each(function(e){t.on("change:"+e,this.triggerChange,this)},this)},triggerChange:function(){this.trigger("change")},resolve:function(e){var t=s.replaceTokens(this.get("search"),this.tokenModel.toJSON());return e&&e.qualified&&(t=c.addLeadingSearchCommand(t)),t},isSatisfied:function(){if(this.tokens.length){var e=this.tokenModel;return r(this.tokens).all(function(t){return e.has(t)})}return!0}}),d=u.extend({constructor:function(e){e=e||{};var t=e.id;t===undefined&&e.name&&(t=e.name,o.log("Use of 'name' to specify the ID of a Splunk model is deprecated.")),t===undefined&&(t=r.uniqueId("manager_")),this.id=this.name=e.name=e.id=t,e.queryModel||(e.queryModel=new p({search:e.search},{tokenModel:e.tokenModel||i.Global})),e.searchModel||(e.searchModel=new a({label:e.id}),i.enableDynamicTokens(e.searchModel)),this.search=e.searchModel,this.runOnSubmit=e.runOnSubmit!==!1,delete e.runOnSubmit,this.createSearch=r.debounce(this.createSearch);var n=e.formManager||"fieldset";i.Components.bind("change:"+n,this.onFormManagerChange,this);var s;i.Components.has(n)&&(s=e.hasOwnProperty("autostart")?e.autostart:!0,e.autostart=!1),u.prototype.constructor.apply(this,arguments),i.enableDynamicTokens(this.search),this._start=u.prototype._start,this._start(),i.Components.has(n)&&(this.onFormManagerChange(null,i.Components.get(n)),this.set("autostart",s),this._start()),e.formManager||this._enableTimeRangePicker()},_start:function(){},onFormManagerChange:function(e,t){if(this.formManager){if(this.formManager===t)return;this.formManager.off(null,null,this)}this.formManager=t,h.getStateModel().has("default_timerange")?this._enableTimeRangePicker():t.once("change:earliest change:latest",this._enableTimeRangePicker,this),this.runOnSubmit&&t.on("submit",this.startSearch,this)},_enableTimeRangePicker:function(){var e=s.isToken(this.search.get("earliest_time")),t=s.isToken(this.search.get("latest_time"));!e&&!t&&this.search.set({earliest_time:"$earliest$",latest_time:"$latest$"},{tokens:!0})},startSearch:function(){if(!this.query.isSatisfied()||!this.search.isSatisfied())return;u.prototype.startSearch.apply(this,arguments)},createSearch:function(){if(!this.query.isSatisfied()||!this.search.isSatisfied())return;u.prototype.createSearch.apply(this,arguments)}});return d}),define("splunkjs/mvc/simplexml/dialog/addpanel",["require","exports","module","underscore","jquery","splunkjs/mvc","views/shared/Modal","models/Base","../../utils","../controller","../element/base","../mapper","./addpanel/master","../../savedsearchmanager","../../searchtemplate","util/console","views/shared/timerangepicker/dialog/Master","models/TimeRange"],function(e,t,n){var r=e("underscore"),i=e("jquery"),s=e("splunkjs/mvc"),o=e("views/shared/Modal"),u=e("models/Base"),a=e("../../utils"),f=e("../controller"),l=e("../element/base"),c=e("../mapper"),h=e("./addpanel/master"),p=e("../../savedsearchmanager"),d=e("../../searchtemplate"),v=e("util/console"),m=e("views/shared/timerangepicker/dialog/Master"),g=e("models/TimeRange"),y=u.extend({defaults:{elementCreateType:"inline"},validation:{search:{fn:"validateSearchQuery"}},validateSearchQuery:function(e,t,n){if(n.elementCreateType==="inline"&&!e)return"Search query is required"},sync:function(e,t,n){v.log("NewPanelModel.sync(%o, %o, %o)",e,t,n);if(e!=="create")throw new Error("Unsupported sync method: "+e);if(!t.isValid())return!1;var o=i.Deferred(),u=this.get("elementCreateType"),h,m=1;do h="element"+m++;while(s.Components.has(h));var g=u==="saved"?this.get("savedSearchVisualization")||"statistics":"statistics",y=c.get(g);return f.getStateModel().view.addElement(h,{type:y.tagName,title:this.get("title"),search:{type:u,search:this.get("search"),earliest_time:this.get("dispatch.earliest_time"),latest_time:this.get("dispatch.latest_time"),name:this.get("savedSearchName")}}).done(r.bind(function(){var e=s.Components.get("dashboard").createNewElement({title:this.get("title"),id:h}),t=r.uniqueId("new-search");switch(u){case"inline":new d({id:t,search:this.get("search"),earliest_time:this.get("dispatch.earliest_time")||0,latest_time:this.get("dispatch.latest_time")||"now",app:a.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0,runOnSubmit:!0});break;case"saved":new p({id:t,searchname:this.get("savedSearchName"),app:a.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0})}var n=l.extend({initialVisualization:g}),i=new n({id:h,managerid:t,el:e});i.render(),o.resolve()},this)),o.promise()}});return o.extend({SLIDE_ANIMATION_DISTANCE:450,SLIDE_ANIMATION_DURATION:500,moduleId:t.id,className:"modal add-panel",initialize:function(){o.prototype.initialize.apply(this,arguments),this.model=new y;var e=new g({earliest:"$earliest$",latest:"$latest$"}),t=f.model.app,n=f.model.user,r=f.model.appLocal,i=f.collection.times,s=n.dfd,u=r.dfd,a=i.dfd;this.children.addPanel=new h({model:{report:this.model,timeRange:e},collection:i}),this.children.timeRangePickerView=new m({model:{timeRange:e,user:n,appLocal:r,application:t},collection:i}),e.on("applied",function(){this.closeTimeRangePicker()},this),this.listenTo(this.model,"change:elementCreateType",this.handleSubmitButtonState,this)},events:{"click a.modal-btn-primary":function(e){e.preventDefault();if(this.model.get("elementCreateType")==="pivot")return;f.getStateModel().set("edit",!1);var t=this,n=this.model.save();n?n.done(function(){setTimeout(function(){f.getStateModel().set("edit",!0)},250),t.hide()}):f.getStateModel().set("edit",!0)},"click a.btn.back":function(e){e.preventDefault(),this.closeTimeRangePicker()},"click a.timerange-control":function(e){e.preventDefault(),this.showTimeRangePicker()}},handleSubmitButtonState:function(e){this.$(o.FOOTER_SELECTOR).find(".btn-primary")[e.get("elementCreateType")==="pivot"?"addClass":"removeClass"]("disabled")},setLabel:function(){var e=this.model.timeRange.generateLabel(this.collection);this.$el.find("span.time-label").text(e)},showTimeRangePicker:function(){var e=this.$addpanelContent,t=this.$timeRangePickerWrapper;this.onBeforePaneAnimation(e,t),this.$visArea.animate({height:this.$timeRangePickerWrapper.height()},{duration:this.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation(e,t)}.bind(this)},this),this.$slideArea.animate({marginLeft:-this.SLIDE_ANIMATION_DISTANCE},{duration:this.SLIDE_ANIMATION_DURATION}),this.$el.animate({width:this.$timeRangePickerWrapper.width()},{duration:this.SLIDE_ANIMATION_DURATION}),this.$(o.HEADER_TITLE_SELECTOR).html(r("Select Time Range").t()),this.$(".btn.back").show(),this.$(".btn-primary").hide(),this.$(".btn.cancel").hide()},closeTimeRangePicker:function(){var e=this.$timeRangePickerWrapper,t=this.$addpanelContent;this.onBeforePaneAnimation(e,t),this.$visArea.animate({height:this.$addpanelContent.height()},{duration:this.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation(e,t)}.bind(this)},this),this.$slideArea.animate({marginLeft:0},{duration:this.SLIDE_ANIMATION_DURATION}),this.$el.animate({width:this.$addpanelContent.width()},{duration:this.SLIDE_ANIMATION_DURATION}),this.$modalParent.animate({width:this.$addpanelContent.width(),marginLeft:-(this.SLIDE_ANIMATION_DISTANCE/2)},{duration:this.SLIDE_ANIMATION_DURATION}),this.$(o.HEADER_TITLE_SELECTOR).html(r("Edit Schedule").t()),this.$(".btn.back").hide(),this.$(".btn-primary").show(),this.$(".btn.cancel").show()},onBeforePaneAnimation:function(e,t){this.$visArea.css("overflow","hidden"),this.$visArea.css({height:e.height()+"px"}),t===this.$timeRangePickerWrapper&&this.children.timeRangePickerView.$el.show(),t.css({height:"",visibility:""})},onAfterPaneAnimation:function(e,t){e===this.$timeRangePickerWrapper&&this.children.timeRangePickerView.$el.hide(),this.$visArea.css("overflow",""),this.$visArea.css({height:""}),e.css({height:"2px",visibility:"hidden"})},render:function(){return this.$el.html(o.TEMPLATE),this.$(o.HEADER_TITLE_SELECTOR).html(r("Add Panel").t()),this.$(o.BODY_SELECTOR).remove(),this.$(o.FOOTER_SELECTOR).before('<div class="vis-area"><div class="slide-area"><div class="schedule-wrapper"><div class="'+o.BODY_CLASS+'" >'+"</div>"+"</div>"+'<div class="timerange-picker-wrapper">'+"</div>"+"</div>"+"</div>"),this.$(o.BODY_SELECTOR).append(o.FORM_HORIZONTAL),this.$visArea=this.$(".vis-area").eq(0),this.$slideArea=this.$(".slide-area").eq(0),this.$addpanelContent=this.$(".schedule-wrapper").eq(0),this.$timeRangePickerWrapper=this.$(".timerange-picker-wrapper").eq(0),this.$(o.BODY_FORM_SELECTOR).append(this.children.addPanel.render().el),this.$timeRangePickerWrapper.append(this.children.timeRangePickerView.render().el),this.$modalParent=this.$el,this.children.timeRangePickerView.$el.hide(),this.$(o.FOOTER_SELECTOR).append(o.BUTTON_CANCEL),this.$(o.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+r("Save").t()+"</a>"),this.$(o.FOOTER_SELECTOR).append('<a href="#" class="btn back modal-btn-back pull-left">'+r("Back").t()+"</a>"),this.$(".btn.back").hide(),this}})}),define("models/services/ScheduledView",["jquery","underscore","backbone","models/SplunkDBase","models/Base","backbone_validation"],function(e,t,n,r,i,s){var o=r.extend({defaults:{is_scheduled:!1,"action.email.subject":"Splunk Alert: $name$","action.email.reportPaperSize":"letter","action.email.reportPaperOrientation":"portrait",cron_schedule:"0 6 * * 1"},initialize:function(){r.prototype.initialize.apply(this,arguments)},url:function(){return"scheduled/views/"+this.viewName},findByName:function(e,n,r){this.viewName=e,this.id="scheduled/views/"+e;var i=this.fetch({data:{app:n,owner:r}});return i.done(t.bind(this.applyDefaultsIfNotScheduled,this)),i},applyDefaultsIfNotScheduled:function(){this.entry.content.get("is_scheduled")||this.entry.content.set(this.defaults)}});return o.Entry=o.Entry.extend({}),o.Entry.Content=o.Entry.Content.extend({validation:{"action.email.to":[{fn:"validateEmailList"}],"action.email.subject":{required:!0,msg:t("Subject is empty").t()}},validateEmailList:function(e,n,r){if(r.is_scheduled){if(!e)return t("Email Address list is empty").t();if(t(e.split(/\s*,\s*/)).any(function(e){return!s.patterns.email.test(e)}))return t("Email Address list is invalid").t()}}}),o}),define("views/dashboards/table/controls/SchedulePDF",["module","jquery","underscore","backbone","util/console","util/pdf_utils","models/services/ScheduledView","models/Cron","views/Base","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/ScheduleSentence","views/shared/FlashMessages"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=a.extend({render:function(){this.el.innerHTML||this.$el.html(n.template(this.template,{label:this.options.label||"",controlClass:this.options.controlClass||"",body:n.template(this.options.body||"")(this.model?this.model.toJSON?this.model.toJSON():this.model:{})}));var e=this.$(".controls");return n.each(this.options.children,function(t){t.render().appendTo(e)}),this},template:'<label class="control-label"><%- label %></label><div class="controls <%- controlClass %>"><%= body %></div>'});return f.extend({moduleId:e.id,className:"modal schedule-pdf",initialize:function(){f.prototype.initialize.apply(this,arguments),this.model.inmem=new o.Entry.Content(this.model.scheduledView.entry.content.toJSON());var e=this.model.cron=u.createFromCronString(this.model.inmem.get("cron_schedule")||"0 6 * * 1");this.listenTo(e,"change",function(){this.model.inmem.set("cron_schedule",e.getCronString())},this),this.children.flashMessages=new h({model:{scheduledView:this.model.scheduledView,content:this.model.inmem}}),this.children.name=new l({controlType:"Label",controlOptions:{modelAttribute:"label",model:this.model.dashboard.entry.content},label:n("Dashboard").t()}),this.children.schedule=new l({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"is_scheduled",model:this.model.inmem,save:!1},label:n("Schedule PDF").t()}),this.conditionalControls=[this.children.scheduleSentence=new c({model:{cron:this.model.cron},lineOneLabel:n("Schedule").t()}),this.children.emailAddresses=new l({controlType:"Textarea",controlOptions:{modelAttribute:"action.email.to",model:this.model.inmem,save:!1},label:n("Email Addresses").t(),help:n("Semi-colon separated list.").t()+"<br/>"+n("To send emails you must configure the settings in System Settings &gt; Alert Email Settings.").t()+'<br/><a href="#">'+n("Learn More").t()+"</a>"}),this.children.emailSubject=new l({controlType:"Text",controlOptions:{modelAttribute:"action.email.subject",model:this.model.inmem,save:!1},label:n("Email Subject Line").t()}),this.children.paperSize=new l({className:"control-group",controlType:"SyntheticSelect",controlOptions:{modelAttribute:"action.email.reportPaperSize",model:this.model.inmem,items:[{label:n("A2").t(),value:"a2"},{label:n("A3").t(),value:"a3"},{label:n("A4").t(),value:"a4"},{label:n("A5").t(),value:"a5"},{label:n("Letter").t(),value:"letter"},{label:n("Legal").t(),value:"legal"}],save:!1,toggleClassName:"btn"},label:n("Paper Size").t()}),this.children.paperLayout=new l({controlType:"SyntheticRadio",controlOptions:{modelAttribute:"action.email.reportPaperOrientation",model:this.model.inmem,items:[{label:n("Portrait").t(),value:"portrait"},{label:n("Landscape").t(),value:"landscape"}],save:!1},label:n("Paper Layout").t()}),this.children.previewLinks=new p({body:'<div class="preview-actions"><div class="test-email"><a href="#" class="action-send-test">'+n("Send Test Email").t()+"</a></div> "+'<a href="#" class="action-preview">'+n("Preview PDF").t()+"</a>"+"</div>"})],this.model.inmem.on("change:is_scheduled",this._toggle,this)},events:{"click .action-send-test":function(e){e.preventDefault(),this.model.inmem.validate();if(this.model.inmem.isValid()){var t=this.$(".test-email"),r=this.children.flashMessages.flashMsgCollection;t.html(n("Sending...").t()),s.sendTestEmail(this.model.dashboard.entry.get("name"),this.model.dashboard.entry.acl.get("app"),this.model.inmem.get("action.email.to"),{paperSize:this.model.inmem.get("action.email.reportPaperSize"),paperOrientation:this.model.inmem.get("action.email.reportPaperOrientation")}).done(function(){t.html('<i class="icon-check"></i> '+n("Email sent.").t())}).fail(function(e){t.html('<span class="error"><i class="icon-warning-sign"></i> '+n("Failed!").t()+"</span>"),e&&r.add({type:"warning",html:n("Sending the test email failed: ").t()+n.escape(e)})}).always(function(){setTimeout(function(){t.html('<a href="#" class="action-send-test">'+n("Send Test Email").t()+"</a>")},5e3)})}},"click .action-preview":function(e){e.preventDefault();var t="",n=this.model.inmem.get("action.email.reportPaperOrientation"),r=this.model.inmem.get("action.email.reportPaperSize")||"a2";n==="landscape"&&(t="-landscape"),s.getRenderURL(this.model.dashboard.entry.get("name"),this.model.dashboard.entry.acl.get("app"),{"paper-size":r+t}).done(function(e){window.open(e)})},"click .modal-btn-primary":function(e){e.preventDefault(),this.model.inmem.validate();if(this.model.inmem.isValid())if(this.model.inmem.get("is_scheduled")===!1&&this.model.scheduledView.entry.content.get("is_scheduled")===!1)this.hide();else{this.model.scheduledView.entry.content.set(this.model.inmem.toJSON());var t=this;this.model.scheduledView.save({},{success:function(){t.hide()}})}}},_toggle:function(){n.chain(this.conditionalControls).pluck("$el").invoke(this.model.inmem.get("is_scheduled")?"show":"hide")},render:function(){return this.$el.html(f.TEMPLATE),this.$(f.HEADER_TITLE_SELECTOR).html(n("Edit PDF Schedule").t()),this.$(f.BODY_SELECTOR).prepend(this.children.flashMessages.render().el),this.$(f.BODY_SELECTOR).append(f.FORM_HORIZONTAL),this.$(f.BODY_FORM_SELECTOR).append(this.children.name.render().el),this.$(f.BODY_FORM_SELECTOR).append(this.children.schedule.render().el),n.each(this.conditionalControls,function(e){this.$(f.BODY_FORM_SELECTOR).append(e.render().el)},this),this.$(f.FOOTER_SELECTOR).append(f.BUTTON_CANCEL),this.$(f.FOOTER_SELECTOR).append(f.BUTTON_SAVE),this._toggle(),this}})}),define("views/dashboards/table/controls/CloneSuccess",["underscore","module","views/shared/Modal","uri/route","views/shared/documentcontrols/dialogs/permissions_dialog/Master","views/dashboards/table/controls/SchedulePDF","models/services/ScheduledView"],function(e,t,n,r,i,s,o){return n.extend({moduleId:t.id,events:{"click .edit-perms":function(t){t.preventDefault();var n=this.model,r=this.collection.roles;e.defer(function(){var e=new i({model:n.dashboard,collection:r,onHiddenRemove:!0});$("body").append(e.render().el),e.show()}),this.hide(),this.remove()},"click .schedule-pdf":function(t){t.preventDefault();var n=this.model,r=function(){var e=new s({model:n,onHiddenRemove:!0});$("body").append(e.render().el),e.show()};if(!this.model.scheduledView){var i=n.scheduledView=new o,u=i.findByName(this.model.dashboard.entry.get("name"),this.model.application.get("app"),this.model.application.get("owner"));u.done(r)}else e.defer(r);this.hide(),this.remove()}},render:function(){this.$el.html(n.TEMPLATE),this.$(n.HEADER_TITLE_SELECTOR).html(e("Dashboard has been cloned.").t()),this.$(n.BODY_SELECTOR).append(n.FORM_HORIZONTAL);var t=r.page(this.model.application.get("root"),this.model.application.get("locale"),this.model.dashboard.entry.acl.get("app"),this.model.dashboard.entry.get("name"));return this.$(n.BODY_FORM_SELECTOR).append(e.template(this.messageTemplate,{dashboardLink:t,_:e})),this.$(n.FOOTER_SELECTOR).append(e.template(this.buttonTemplate,{dashboardLink:t,_:e})),this.$(n.FOOTER_SELECTOR).append(""),this},buttonTemplate:'<a href="<%= dashboardLink %>/edit" class="btn edit-panels"><%- _("Edit Panels").t() %></a><a href="<%= dashboardLink %>" class="btn btn-primary modal-btn-primary"><%- _("View").t() %></a>',messageTemplate:'<p><%- _("You may now view your dashboard, change additional settings, or edit the panels.").t() %></p><p><%- _("Additional Settings").t() %>:<ul><li><a href="#" class="edit-perms"><%- _("Permissions").t() %></a></li><li><a href="#" class="schedule-pdf"><%- _("Schedule PDF Delivery").t() %></a></li></ul></p>'})}),define("views/shared/delegates/PairedTextControls",["jquery","underscore","backbone","views/shared/controls/TextControl","views/shared/delegates/Base"],function(e,t,n,r,i){return i.extend({transformFunction:undefined,initialize:function(e){e=e||{},this.sourceDelegate=e.sourceDelegate,this.destDelegate=e.destDelegate,this.transformFunction=e.transformFunction;if(!(this.sourceDelegate instanceof r&&this.destDelegate instanceof r))throw new Error("SourceDelegate and destDelegate must be TextControls");this.enablePairing()},enablePairing:function(){this.sourceDelegate.on("keyup",this.sourceChangeHandler,this),this.destDelegate.on("keyup",this.destChangeHandler,this)},disablePairing:function(){this.sourceDelegate.off("keyup",this.sourceChangeHandler,this)},sourceChangeHandler:function(e,t){var n=t;this.transformFunction&&(n=this.transformFunction(t)),this.destDelegate.setValue(n)},destChangeHandler:function(e,t){e.keyCode!=9&&e.keyCode!=16&&(this.disablePairing(),this.destDelegate.off("keyup",this.destChangeHandler))}})}),define("views/dashboards/table/controls/CloneDashboard",["underscore","module","views/shared/Modal","views/shared/controls/ControlGroup","models/Base","models/Dashboard","views/shared/FlashMessages","util/splunkd_utils","views/dashboards/table/controls/CloneSuccess","views/shared/delegates/PairedTextControls","views/shared/controls/TextControl"],function(e,t,n,r,i,s,o,u,a,f,l){return n.extend({moduleId:t.id,initialize:function(){n.prototype.initialize.apply(this,arguments),this.model.perms=new i({perms:"private"}),this.children.flashMessages=new o({model:{dashboard:this.model.dashboard,dashboardMeta:this.model.dashboard.meta}}),this.children.titleTextControl=new l({modelAttribute:"label",model:this.model.dashboard.meta,save:!1}),this.children.filenameTextControl=new l({modelAttribute:"name",model:this.model.dashboard.entry.content,save:!1}),this.children.filenameTextControl.setValue(u.nameFromString(this.model.dashboard.meta.get("label"))),this.pairedTextControls=new f({sourceDelegate:this.children.titleTextControl,destDelegate:this.children.filenameTextControl,transformFunction:u.nameFromString}),this.children.title=new r({controls:this.children.titleTextControl,label:e("Title").t()}),this.children.filename=new r({controls:this.children.filenameTextControl,label:e("ID").t(),help:e("Can only contain letters, numbers and underscores.").t(),tooltip:e("The ID is used as the filename on disk. Cannot be changed later.").t()}),this.children.description=new r({controlType:"Textarea",controlOptions:{modelAttribute:"description",model:this.model.dashboard.meta,placeholder:e("optional").t(),save:!1},label:e("New Description").t()}),this.children.permissions=new r({controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group btn-group-2",modelAttribute:"perms",model:this.model.perms,items:[{label:e("Private").t(),value:"private"},{label:e("Shared").t(),value:"shared"}],save:!1},label:e("Permissions").t()})},events:{"click a.modal-btn-primary":function(e){e.preventDefault(),this.submit()},keypress:function(e){n.handleKeyboardEvent(e,{enter:this.submit},this)}},submit:function(){var t=this.model.dashboard;t.meta.validate();if(t.meta.isValid()){t.meta.apply();var n=this,r;r=this.model.application.getPermissions(this.model.perms.get("perms")),t.save({},{data:r}).done(function(){n.collection&&n.collection.dashboards&&n.collection.dashboards.add(n.model.dashboard),e.defer(function(){var e=new a({model:{dashboard:t,application:n.model.application,scheduledView:n.model.scheduledView},collection:n.collection});e.render().show()}),n.hide(),n.remove()})}},render:function(){return this.$el.html(n.TEMPLATE),this.$(n.HEADER_TITLE_SELECTOR).html(e("Clone").t()),this.$(n.BODY_SELECTOR).prepend(this.children.flashMessages.render().el),this.$(n.BODY_SELECTOR).append(n.FORM_HORIZONTAL),this.$(n.BODY_FORM_SELECTOR).append(this.children.title.render().el),this.$(n.BODY_FORM_SELECTOR).append(this.children.filename.render().el),this.$(n.BODY_FORM_SELECTOR).append(this.children.description.render().el),this.$(n.BODY_FORM_SELECTOR).append(this.children.permissions.render().el),this.$(n.FOOTER_SELECTOR).append(n.BUTTON_CANCEL),this.$(n.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+e("Clone Dashboard").t()+"</a>"),this}})}),define("views/dashboards/table/controls/ConvertSuccess",["jquery","underscore","module","views/shared/Modal","uri/route","views/shared/documentcontrols/dialogs/permissions_dialog/Master"],function(e,t,n,r,i,s){return r.extend({moduleId:n.id,options:{refreshOnDismiss:!1},initialize:function(){r.prototype.initialize.apply(this,arguments),this.options.refreshOnDismiss&&this.on("hide hidden",function(){window.location.reload()})},events:e.extend({},r.prototype.events,{"click .edit-perms":function(n){n.preventDefault();var r=this,i=r.model,o=r.collection.roles;t.defer(function(){var t=new s({model:i.dashboard,collection:o,onHiddenRemove:!0});r.options.refreshOnDismiss&&t.on("hide hidden",function(){window.location.reload()}),e("body").append(t.render().el),t.show()}),r.options.refreshOnDismiss&&r.off("hide hidden"),r.hide(),r.remove()}}),render:function(){this.$el.html(r.TEMPLATE),this.$(r.HEADER_TITLE_SELECTOR).html(t("Dashboard has been converted.").t()),this.$(r.BODY_SELECTOR).append(r.FORM_HORIZONTAL);var e=this.model.dashboard.entry.acl.get("app"),n=this.model.dashboard.entry.get("name"),s=i.page(this.model.application.get("root"),this.model.application.get("locale"),e,n),o="/manager/"+e+"/data/ui/views/"+n+"?action=edit&ns="+e+"&redirect_override="+encodeURIComponent(window.location.pathname);return this.$(r.BODY_FORM_SELECTOR).append(t.template(this.messageTemplate,{dashboardLink:s,_:t})),this.$(r.FOOTER_SELECTOR).append(t.template(this.buttonTemplate,{dashboardLink:s,editLink:o,_:t})),this.$(r.FOOTER_SELECTOR).append(""),this},buttonTemplate:'<a href="<%= editLink %>" class="btn edit-panels"><%- _("Edit HTML").t() %></a><a href="<%= dashboardLink %>" class="btn btn-primary modal-btn-primary"><%- _("View").t() %></a>',messageTemplate:'<p><%- _("You may now view your dashboard, change additional settings, or edit the HTML.").t() %></p><p><%- _("Additional Settings").t() %>:<ul><li><a href="#" class="edit-perms"><%- _("Permissions").t() %></a></li></ul></p>'})}),define("views/dashboards/table/controls/ConvertDashboard",["underscore","jquery","module","views/shared/Modal","views/shared/controls/ControlGroup","models/Base","models/Dashboard","views/shared/FlashMessages","views/dashboards/table/controls/ConvertSuccess","views/shared/delegates/PairedTextControls","views/shared/controls/TextControl","util/splunkd_utils","uri/route","util/xml_utils"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d={NEW:0,REPLACE:1};return r.extend({moduleId:n.id,initialize:function(){var t=this;r.prototype.initialize.apply(this,arguments),this.model.perms=new s({perms:"private"}),this.model.convertMode=new s({mode:d.NEW}),this.children.flashMessages=new u({model:{dashboard:this.model.dashboard,dashboardMeta:this.model.dashboard.meta}}),this.children.titleTextControl=new l({modelAttribute:"label",model:this.model.dashboard.meta,save:!1}),this.children.filenameTextControl=new l({modelAttribute:"name",model:this.model.dashboard.entry.content,save:!1}),this.children.filenameTextControl.setValue(c.nameFromString(this.model.dashboard.meta.get("label"))),this.pairedTextControls=new f({sourceDelegate:this.children.titleTextControl,destDelegate:this.children.filenameTextControl,transformFunction:c.nameFromString}),this.children.mode=new i({controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group btn-group-2",modelAttribute:"mode",model:this.model.convertMode,items:[{label:e("Create New").t(),value:d.NEW},{label:e("Replace Current").t(),value:d.REPLACE}],save:!1},label:e("Dashboard").t(),help:e("Recommended").t()}),this.children.title=new i({controls:this.children.titleTextControl,label:e("Title").t()}),this.children.filename=new i({controls:this.children.filenameTextControl,label:e("ID").t(),help:e("Can only contain letters, numbers and underscores.").t(),tooltip:e("The ID is used as the filename on disk. Cannot be changed later.").t()}),this.children.description=new i({controlType:"Textarea",controlOptions:{modelAttribute:"description",model:this.model.dashboard.meta,placeholder:e("optional").t(),save:!1},label:e("Description").t()}),this.children.permissions=new i({controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group btn-group-2",modelAttribute:"perms",model:this.model.perms,items:[{label:e("Private").t(),value:"private"},{label:e("Shared").t(),value:"shared"}],save:!1},label:e("Permissions").t()}),this.model.convertMode.on("change:mode",function(){t.children.flashMessages.flashMsgCollection.reset(),t.model.convertMode.get("mode")===d.NEW?(t.children.title.show(),t.children.filename.show(),t.children.description.show(),t.children.permissions.show()):(t.children.flashMessages.flashMsgCollection.add({type:"warning",html:e("This change cannot be undone.").t()}),t.children.title.hide(),t.children.filename.hide(),t.children.description.hide(),t.children.permissions.hide())})},events:{"click a.modal-btn-primary":function(e){e.preventDefault(),this.submit()},keypress:function(e){r.handleKeyboardEvent(e,{enter:this.submit},this)}},submit:function(){var n=this,r=n.model.dashboard,i=n.model.currentDashboard,s=n.model.application,o=h.page(s.get("root"),s.get("locale"),i.entry.acl.get("app"),i.entry.get("name"))+"/converttohtml",u=n.collection&&n.collection.dashboards;if(this.model.convertMode.get("mode")===d.NEW){r.meta.validate();if(r.meta.isValid()){var f=r.meta.toJSON();r.entry.content.set("eai:data",i.entry.content.get("eai:data")),r.entry.content.set("eai:type","views"),r.meta.set(f),r.meta.apply(),t.post(o,{xmlString:r.entry.content.get("eai:data")}).done(function(t){r.entry.content.set("eai:type","html"),r.entry.content.set("eai:data",t),r.save({},{data:s.getPermissions(n.model.perms.get("perms"))}).done(function(){u&&n.collection.dashboards.add(n.model.dashboard),e.defer(function(){var e=new a({model:{dashboard:r,application:s},collection:n.collection});e.render().show()}),n.hide(),n.remove()})})}}else t.post(o,{xmlString:i.entry.content.get("eai:data")}).done(function(t){i.entry.content.set("eai:type","html"),i.entry.content.set("eai:data",t),i.save().done(function(){u&&i.trigger("updateCollection"),e.defer(function(){var e=new a({model:{dashboard:i,application:s},collection:n.collection,refreshOnDismiss:!u});e.render().show()}),n.hide(),n.remove()})})},render:function(){return this.$el.html(r.TEMPLATE),this.$(r.HEADER_TITLE_SELECTOR).html(e("Convert Dashboard to HTML").t()),this.$(r.BODY_SELECTOR).prepend(this.children.flashMessages.render().el),this.$(r.BODY_SELECTOR).append(r.FORM_HORIZONTAL),this.$(r.BODY_FORM_SELECTOR).append(this.children.mode.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.title.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.filename.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.description.render().el),this.$(r.BODY_FORM_SELECTOR).append(this.children.permissions.render().el),this.$(r.FOOTER_SELECTOR).append(r.BUTTON_CANCEL),this.$(r.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+e("Convert Dashboard").t()+"</a>"),this}})}),define("splunkjs/mvc/simpleform/formtokens",["require","underscore","backbone","models/classicurl","../mvc"],function(e){var t=e("underscore"),n=e("backbone"),r=e("models/classicurl"),i=e("../mvc"),s={_isInitialized:!1,_tokenOptionsByName:{},initialize:function(){var e=s;if(e._isInitialized)return;e._formLiveRaw=e._createTokenModel("form_raw"),e._formSubmittedRaw=e._createTokenModel("form_submitted_raw"),e._formLive=e._createTokenModel("form"),e._formSubmitted=e._createTokenModel("form_submitted"),new o(e._formSubmittedRaw,e._formLiveRaw),e._transformingArrow1=new o(e._formLiveRaw,e._formLive,{valueTransform:s._RAW_VALUE_TO_TRANSFORMED}),e._transformingArrow2=new o(e._formSubmittedRaw,e._formSubmitted,{valueTransform:s._RAW_VALUE_TO_TRANSFORMED});var t=e._createUrlModel();new o(t,e._formSubmittedRaw,{keyFilter:function(e){return e.indexOf("form.")===0},keyTransform:function(e){return e.substring("form.".length)}}),new o(e._formSubmittedRaw,t,{keyTransform:function(e){return"form."+e}}),new o(t,e._formSubmitted),new o(t,e._formLive),e._isInitialized=!0},_createUrlModel:function(){var e=s,t=e._createTokenModel("url");return new o(r,t),new o(t,r,{didForward:function(){r.save()}}),t},_RAW_VALUE_TO_TRANSFORMED:function(e,t){var n=s._tokenOptionsByName[t]||{};return typeof e=="string"&&(n["default"]&&e===""&&(e=n["default"]),n.prefix&&(e=n.prefix+e),n.suffix&&(e+=n.suffix)),e},register:function(e,t){var n=s;n._tokenOptionsByName[e]=t,n._isInitialized&&(n._transformingArrow1.forward(e),n._transformingArrow2.forward(e))},submit:function(){var e=s;if(!e._isInitialized)return;var t=new o(e._formLiveRaw,e._formSubmittedRaw);t.destroy()},_createTokenModel:function(e){return i.Components.getInstance(e,{create:!0})}},o=function(e,n,r){var i=this;r=r||{};var s=r.keyFilter||function(e){return!0},o=r.keyTransform||function(e){return e},u=r.valueTransform||function(e,t){return e},a=r.didForward||function(){};this.sourceModel=e,this.destModel=n,e.on("change",this._sourceModelListener=function(e,r){var i={};t.each(e.changed,function(e,t){if(s(t)){var n=o(t),r=u(e,t);i[n]=r}}),n.set(i),a()}),this.forward()};return t.extend(o.prototype,{forward:function(e){var n;e===undefined?n=this.sourceModel.attributes:(n={},this.sourceModel.has(e)&&(n[e]=this.sourceModel.get(e))),t.isEmpty(n)||(this.sourceModel.changed=n,this._sourceModelListener(this.sourceModel))},destroy:function(){this.sourceModel.off("change",this._sourceModelListener),this._sourceModelListener=null}}),s}),define("splunkjs/mvc/simpleform/input/base",["require","underscore","jquery","../../basesplunkview","../formtokens","../../tokenutils"],function(e){var t=e("underscore"),n=e("jquery"),r=e("../../basesplunkview"),i=e("../formtokens"),s=e("../../tokenutils"),o=r.extend({options:{submitOnChange:!1},initialize:function(){this.configure(),this.settings.enablePush("value");var e=this.settings.get("value",{tokens:!0});if(e!==undefined&&s.isToken(e)){var n=s.getTokens(e)[0].name,r=t.pick(this.settings.toJSON(),["default","prefix","suffix"]);i.register(n,r)}this.bindToComponent(this.options.formManager,this.onFormManagerChange,this),this.settings.on("change:token change:default change:prefix change:suffix",this.bindToFormManager,this),this.settings.on("change:label",this.renderLabel,this),this.inputId=t.uniqueId((this.id||"input")+"_")},onFormManagerChange:function(e,t){this.formModel&&this.formModel.off(null,null,this),this.formModel=t,this.bindToFormManager()},bindToFormManager:function(){if(!this.formModel)return;var e=this.token=this.settings.get("token"),n=this.formModel,r=this.settings;r.hasChanged("token")&&n.unregister(r.previous("token")),n.register(e,t.pick(r.toJSON(),["default","prefix","suffix"]),this.readyDfd()),n.on("change:"+e,this.onModelChange,this);if(n.has(e))this.setValue(n.get(e));else{var i=this.getValue();i?n.set(e,i):r.has("seed")&&n.set(e,r.get("seed"))}},readyDfd:function(){return null},destroy:function(){this.formModel&&(this.formModel.unregister(this.token),this.formModel.off(null,null,this)),r.prototype.destroy.apply(this,arguments)},handleChange:function(){this.formModel&&(this.formModel.set(this.token,this.getValue()),this.formModel.submit(this.settings.get("submitOnChange")?"soft":"change")),this.settings.set("value",this.getValue()),this.settings.get("submitOnChange")&&i.submit()},sendSoftSubmit:function(){this.formModel&&this.formModel.submit("soft"),this.trigger("submit",this)},onModelChange:function(){this.setValue(this.formModel.get(this.token))},setValue:function(e){throw"setValue not implemented"},getValue:function(){throw"getValue not implemented"},renderLabel:function(){var e=this.$("label");e.length||(e=n("<label></label>").appendTo(this.el)),e.attr("for",this.inputId);if(this.settings.has("label"))e.text(this.settings.get("label"));else{var t=e.text();t&&this.settings.set("label",t)}},val:function(e){return arguments.length>=1&&this.setValue(e),this.getValue()},on:function(){return this._applyToWrappedView("on",arguments)},off:function(){return this._applyToWrappedView("off",arguments)},trigger:function(){return this._applyToWrappedView("trigger",arguments)},_applyToWrappedView:function(e,t){var n=this._getWrappedView();return n===this?r.prototype[e].apply(this,t):n[e].apply(n,t)},_getWrappedView:function(){return this}});return o}),define("splunkjs/mvc/simpleform/input/timerange",["require","underscore","jquery","backbone","./base","views/shared/timerangepicker/Master","models/TimeRange","../../simplexml/controller","../../mvc","util/console"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("./base"),s=e("views/shared/timerangepicker/Master"),o=e("models/TimeRange"),u=e("../../simplexml/controller"),a=e("../../mvc"),f=e("util/console"),l=i.extend({initialize:function(){this.configure(),this.settings.enablePush("earliest_time"),this.settings.enablePush("latest_time"),this.model=new r.Model({}),this._readyDfd=n.Deferred();var e=u.model.app,i=u.model.user,a=u.model.appLocal,f=this.timesCollection=u.collection.times;if(this.settings.has("earliest")||this.settings.has("latest")){var l=!1,c=this.settings.get("earliest"),h=this.settings.get("latest");!t.isUndefined(c)&&c!==""&&(l=!0,this.settings.set("earliest_time",this.settings.get("earliest"))),!t.isUndefined(h)&&h!==""&&(l=!0,this.settings.set("latest_time",this.settings.get("latest"))),l&&this.setValue()}var p=this;this.settings.has("default")&&(n.when(f.dfd).done(function(){p.applyDefaultValue(!1)}),this.settings.on("change:default",this.applyDefaultValue,this),t.isString(this.settings.get("default"))||this.applyDefaultValue(!1)),this._pickerDfd=n.when(f.dfd,i.dfd,a.dfd).done(function(){p.picker=new s({el:n("<div></div>").appendTo(p.el),model:{state:p.model,timeRange:new o,user:u.model.user,appLocal:u.model.appLocal,application:u.model.app},collection:f})}),this.model.on("change",this.onChange,this),this.bindToComponent(this.options.formManager,this.onFormManagerChange,this),this.settings.on("change:token",function(){this.onFormManagerChange(null,this.formModel)},this),this.settings.has("token")||u.getStateModel().on("change:edit",this.onEditStateChange,this),this._bindRangeToDefaultTokens()},events:{"click .remove-timerange-picker a":function(e){e.preventDefault(),this.remove()}},_bindRangeToDefaultTokens:function(){var e,n,r=this.settings.has("token");r?(e=r+".earliest",n=r+".latest"):(e="earliest",n="latest");var i={};this.settings.has("earliest_time")||(i.earliest_time="$"+e+"$"),this.settings.has("latest_time")||(i.latest_time="$"+n+"$"),t.isEmpty(i)||this.settings.set(i,{tokens:!0}),this.settings.on("change:earliest_time change:latest_time",this.setValue,this);var s={};s.earliest_time=this.settings.get("earliest_time")||this.model.get("dispatch.earliest_time"),s.latest_time=this.settings.get("latest_time")||this.model.get("dispatch.latest_time"),this.settings.set(s)},applyDefaultValue:function(e){if(e===!0||!this.model.has("dispatch.earliest_time")){var n=this.settings.get("default");if(n)if(t.isString(n)){var r=this.timesCollection.find(function(e){return e.entry.content.get("label")===n});r?this.model.set({"dispatch.earliest_time":r.entry.content.get("earliest_time"),"dispatch.latest_time":r.entry.content.get("latest_time")}):(f.warn("Could not find matching preset for time range picker default value=%o",n),this.model.set({"dispatch.earliest_time":"0","dispatch.latest_time":"now"}))}else this.model.set({"dispatch.earliest_time":n.earliestTime,"dispatch.latest_time":n.latestTime});this.updateGlobalDefaultTimeRange()}this._readyDfd.resolve()},onFormManagerChange:function(e,t){this.formModel&&this.formModel.off(null,null,this),this.formModel=t,this.formModel.register(null,null,this.readyDfd())},readyDfd:function(){return this._readyDfd},setValue:function(){this.model.set({"dispatch.earliest_time":this.settings.get("earliest_time"),"dispatch.latest_time":this.settings.get("latest_time")})},onChange:function(){this.settings.set({earliest_time:this.model.get("dispatch.earliest_time"),latest_time:this.model.get("dispatch.latest_time")}),this.trigger("change"),this.formModel&&this.formModel.submit(this.settings.get("submitOnChange")?"soft":"change")},getValue:function(){var e=this.model.get("dispatch.earliest_time"),t=this.model.get("dispatch.latest_time");return{earliest_time:e,latest_time:t}},onEditStateChange:function(e){e.get("edit")&&!this.settings.has("token")?(n('<div class="remove-timerange-picker"><a href="#"><i class="icon-x-circle"></i></a></div>').appendTo(this.$el),n('<div class="timerange-edit-hint"></div>').html(t('Select default time range above. Time range only applies to <i class="icon-search-thin"></i> Inline Searches.').t()).appendTo(this.$el),this.model.on("change",this.updateGlobalDefaultTimeRange,this),this.applyDefaultValue(!0)):(this.model.off("change",this.updateGlobalDefaultTimeRange,this),this.$(".remove-timerange-picker").remove(),this.$(".timerange-edit-hint").remove())},updateGlobalDefaultTimeRange:function(){if(!this.settings.get("token")){var e={earliestTime:this.model.get("dispatch.earliest_time"),latestTime:this.model.get("dispatch.latest_time")};u.getStateModel().set("default_timerange",e),this.settings.set("default",e,{silent:!0})}},remove:function(){var e=this;n.when(this._pickerDfd).done(function(){e.picker.remove()}),u.getStateModel().off(null,null,this),this.timesCollection.off(null,null,this),this.model.off(),a.Components.revokeInstance(this.id),i.prototype.remove.call(this),this.settings.get("token")||u.getStateModel().set("default_timerange",null)},render:function(){return this.renderLabel(),this._pickerDfd.done(t.bind(this.renderTimePicker,this)),this.onEditStateChange(u.getStateModel()),this},renderTimePicker:function(){var e=this.model.toJSON(),r=this;n.when(this._pickerDfd).done(function(){r.picker.render()}),t.isEmpty(e)||(this.model.clear({silent:!0}),this.model.set(e))}});return l}),define("splunkjs/mvc/simpleform/formmanager",["require","underscore","jquery","../mvc","../basemanager","../utils","../simplexml/controller","backbone","util/console"],function(e){var t=e("underscore"),n=e("jquery"),r=e("../mvc"),i=e("../basemanager"),s=e("../utils"),o=e("../simplexml/controller"),u=e("backbone"),a=e("util/console"),f=i.extend({defaultOptions:{submitOnChange:!1,softSubmit:!0,triggerSearchOnSoftSubmit:!1},constructor:function(e){i.prototype.constructor.call(this,{},t.defaults(e||{},this.defaultOptions))},initialize:function(e,n){this.meta=new i(n.metadata||{}),this._ready=[],this.globalModel=n.globalModel||r.Global,a.DEBUG_ENABLED&&this.on("change",function(e){t.each(e.changed,function(t,n){a.log("FORM MANAGER CHANGE key=%o value: %o -> %o",n,e.previous(n),t)})}),this.formModel=new u.Model,this.globalSyncer=s.syncModels(this.globalModel,this.formModel,{auto:"push",exclude:t.keys(this.toJSON())}),this.on("change",function(e){this.globalSyncer.exclude(t.keys(e.toJSON())),this._applyMetadata(this.formModel)},this),this.softSubmit=n.softSubmit,this.submitOnChange=n.submitOnChange,this.triggerSearchOnSoftSubmit=n.triggerSearchOnSoftSubmit,n.persist&&(this.persistentStore=o.getPersistentStore(n.persist.storage),this.persister=s.bindModel({source:this,dest:this.persistentStore,prefix:n.persist.prefix,alias:{earliest:"earliest",latest:"latest"},save:!0}).auto("pull"))},submit:function(e){return a.log("FormManager.submit(%o)",e),e==="change"&&this.submitOnChange!==!0?!1:e==="soft"&&this.softSubmit!==!0?!1:(this._submit(e),!0)},register:function(e,t,n){e&&(this.meta.set(e,t),!this.has(e)&&t&&t.hasOwnProperty("default")&&this.set(e,t["default"])),n&&this._ready.push(n)},unregister:function(e){this.meta.unset(e),this.unset(e)},_applyMetadata:function(e){var n=this.toJSON(),r={},i=this.meta;t(n).each(function(e,t){if(i.has(t)){var n=i.get(t),s=[];!e&&n["default"]&&(e=n["default"]),n.prefix&&s.push(n.prefix),s.push(e),n.suffix&&s.push(n.suffix),e=s.join("")}r[t]=e}),t(i.toJSON()).each(function(e,t){n.hasOwnProperty(t)||(e["default"]?r[t]=[e.prefix||"",e["default"],e.suffix||""].join(""):r[t]=undefined)}),e.set(r)},_submit:t.debounce(function(e){var t=this.toJSON();(e=="soft"&&this.triggerSearchOnSoftSubmit||e===undefined)&&this.trigger("submit",t,this),this.persister&&this.persister.push(),this.globalModel&&this._applyMetadata(this.globalModel)}),submitOnReady:function(){if(this._ready.length){var e=this,t=this._ready;n.when.apply(n,t).then(function(){e.submit()})}else this.submit()},save:function(){this.set.apply(this,arguments),this.submit("soft")}});return f}),define("splunkjs/mvc/simplexml/editdashboard",["require","exports","module","underscore","jquery","views/Base","views/shared/delegates/Popdown","collections/services/authorization/Roles","views/shared/documentcontrols/dialogs/permissions_dialog/Master","./dialog/dashboardtitle","./dialog/addpanel","views/dashboards/table/controls/SchedulePDF","models/services/ScheduledView","util/pdf_utils","views/dashboards/table/controls/CloneDashboard","views/dashboards/table/controls/ConvertDashboard","models/Dashboard","./controller","util/console","../../mvc","../utils","uri/route","views/shared/dialogs/TextDialog","../simpleform/input/timerange","../simpleform/formmanager","splunk.util","splunk.config","util/splunkd_utils"],function(e,t,n){var r=e("underscore"),i=e("jquery"),s=e("views/Base"),o=e("views/shared/delegates/Popdown"),u=e("collections/services/authorization/Roles"),a=e("views/shared/documentcontrols/dialogs/permissions_dialog/Master"),f=e("./dialog/dashboardtitle"),l=e("./dialog/addpanel"),c=e("views/dashboards/table/controls/SchedulePDF"),h=e("models/services/ScheduledView"),p=e("util/pdf_utils"),d=e("views/dashboards/table/controls/CloneDashboard"),v=e("views/dashboards/table/controls/ConvertDashboard"),m=e("models/Dashboard"),g=e("./controller"),y=e("util/console"),b=e("../../mvc"),w=e("../utils"),E=e("uri/route"),S=e("views/shared/dialogs/TextDialog"),x=e("../simpleform/input/timerange"),T=e("../simpleform/formmanager"),N=e("splunk.util"),C=e("splunk.config"),k=e("util/splunkd_utils"),L=s.extend({moduleId:n.id,className:"edit-menu",initialize:function(){s.prototype.initialize.apply(this,arguments),this.model.state.on("change:edit",this.onEditModeChange,this),this.model.state.on("change:editable change:pdf_available",this.render,this),this.model.state.on("change:default_timerange",this.handleDefaultTimeRangeChange,this),this.model.state.user.on("change",this.render,this),this._ready=!1;var e=this;r.defer(function(){e._ready=!0})},events:{"click a.edit-panels":function(e){e.preventDefault(),this.model.state.set("edit",!0)},"click a.edit-done":function(e){e.preventDefault(),this.model.state.set("edit",!1)},"click a.print-dashboard":function(e){e.preventDefault(),window.print()},"click a.generate-pdf":function(e){e.preventDefault();var t=this.model.dashboard.entry.get("name"),n=this.model.dashboard.entry.acl.get("app"),i={},s=0;r.map(b.Components.get("dashboard").getElementIds(),function(e){var t=b.Components.get(e);t&&t.getExportParams&&r.extend(i,t.getExportParams("sid_"+s)),s++}),p.isPdfServiceAvailable().done(function(e,r){if(r==="pdfgen"){var s=g.model.view.getFlattenedXML({useLoadjob:!1,indent:!1});y.DEBUG_ENABLED&&y.log(s),p.downloadReportFromXML(s,n,i)}else r==="deprecated"&&p.getRenderURL(t,n,i).done(function(e){window.open(e)})})},"click a.schedule-pdf":function(e){e.preventDefault();var t=new h,n=t.findByName(this.model.dashboard.entry.get("name"),this.model.application.get("app"),this.model.application.get("owner")),s=this;n.done(function(){var e=new c({model:{scheduledView:t,dashboard:s.model.dashboard,application:s.model.application},onHiddenRemove:!0});e.render().appendTo(i("body")),e.show()}).fail(function(){alert(r("Error loading PDF Schedule information").t())})},"click a.add-panel":function(e){e.preventDefault(),this.children.addPanelDialog=new l({}),this.children.addPanelDialog.render().appendTo(i("body")).show()},"click a.add-trp":function(e){e.preventDefault();var t=i('<div class="input input-timerangepicker" id="field3"><label>&nbsp;</label></div>'),n=i("body>.dashboard-body>.fieldset"),r=n.find(".form-submit");r.length?t.insertBefore(r):t.appendTo(n);var s="timerange",o=1;while(b.Components.has(s))s="timerange"+o++;b.Components.has("fieldset")||new T({id:"fieldset",persist:{storage:"uri",prefix:"form."},submitOnChange:!1});var u=(new x({id:"timerange",submitOnChange:!0,formManager:"fieldset",el:t})).render();u.on("change",function(){var e=u.val(),t=b.Components.get("url"),n=b.Components.get("submitted"),r=b.Components.get("default");t.set("earliest",e.earliest_time),t.set("latest",e.latest_time),n.set("earliest",e.earliest_time),n.set("latest",e.latest_time),r.set("earliest",e.earliest_time),r.set("latest",e.latest_time)}),g.trigger("formupdate")},"click a.delete":function(e){e.preventDefault();var t=new S({id:"modal-delete-dashboard"});t.settings.set("primaryButtonLabel",r("Delete").t()),t.settings.set("cancelButtonLabel",r("Cancel").t()),t.settings.set("titleLabel",r("Delete").t()),t.setText(N.sprintf(r("Are you sure you want to delete %s?").t(),this.model.dashboard.entry.content.get("label"))),t.render().appendTo(document.body),t.once("click:primaryButton",function(){this.model.dashboard.destroy().done(function(){var e=w.getPageInfo();w.redirect(E.page(e.root,e.locale,e.app,"dashboards"))})},this),t.show()},"click a.edit-title-desc":function(e){e.preventDefault(),this.children.titleDialog=new f({model:this.model.state,onHiddenRemove:!0}),i("body").append(this.children.titleDialog.render().el),this.children.titleDialog.show()},"click a.edit-perms":function(e){e.preventDefault(),this.children.permissionsDialog=new a({model:{document:this.model.dashboard,nameModel:this.model.dashboard.entry.content},collection:this.collection,nameLabel:"Dashboard",nameKey:"label",onHiddenRemove:!0}),i("body").append(this.children.permissionsDialog.render().el),this.children.permissionsDialog.show()},"click a.convert-to-html":function(e){e.preventDefault();var t=new m;t.meta.set(this.model.dashboard.meta.toJSON());var n=this.children.convertDialog=new v({model:{dashboard:t,currentDashboard:this.model.dashboard,application:this.model.application},collection:{roles:this.collection},onHiddenRemove:!0});i("body").append(n.render().el),n.show()},"click a.clone":function(e){e.preventDefault();var t=new m;t.setXML(this.model.dashboard.entry.content.get("eai:data")),t.meta.set(this.model.dashboard.meta.toJSON());var n=this.children.cloneDialog=new d({model:{dashboard:t,application:this.model.application},collection:{roles:this.collection},onHiddenRemove:!0});i("body").append(n.render().el),n.show()}},onEditModeChange:function(){var e=this.model.state.get("edit");this.$(".dashboard-view-controls")[e?"hide":"show"](),this.$(".dashboard-edit-controls")[e?"show":"hide"]()},handleDefaultTimeRangeChange:function(e){if(this._ready&&this.model.state.get("edit")){var t=i("body>.dashboard-body>.fieldset").children().length>0,n=e.get("default_timerange"),r;n&&(r=n),this.model.dashboard.saveFormSettings(t,!!n,r)}this.render()},render:function(){var e=this.model.application.toJSON(),t={dashboard:this.model.dashboard.isDashboard(),editLinkViewMode:E.manager(e.root,e.locale,e.app,["data","ui","views",e.page],{data:{action:"edit",ns:e.app,redirect_override:E.page(e.root,e.locale,e.app,e.page)}}),editLinkEditMode:E.manager(e.root,e.locale,e.app,["data","ui","views",e.page],{data:{action:"edit",ns:e.app,redirect_override:E.page(e.root,e.locale,e.app,e.page)+"/edit"}}),dashboardType:this.model.dashboard.getViewType(),editable:this.model.state.get("editable"),canWrite:this.model.dashboard.entry.acl.canWrite(),canEditHtml:r.contains(this.model.state.user.getCapabilities(),"edit_view_html"),removable:this.model.dashboard.entry.acl.get("removable"),isSimpleXML:this.model.dashboard.isSimpleXML(),isHTML:this.model.dashboard.isHTML(),isPdfServiceAvailable:this.model.state.get("pdf_available"),showAddTRP:!this.model.state.get("default_timerange"),_:r};return this.$el.html(this.compiledTemplate(t)),t.canWrite&&(this.children.popdown=new o({el:this.$el.find(".dashboard-view-controls")})),this.$(".generate-pdf").tooltip({animation:!1,title:r("Export PDF").t()}),this.$(".print-dashboard").tooltip({animation:!1,title:r("Print").t()}),this.onEditModeChange(),this},template:'                <span class="dashboard-view-controls">                    <% if(canWrite) { %>                    <a class="dropdown-toggle btn " href="#"><%- _("Edit").t() %> <span class="caret"></span></a><div class="dropdown-menu dropdown-menu-narrow">                        <div class="arrow"></div>                        <% if (editable || (!isHTML || canEditHtml) || (isSimpleXML && canEditHtml)) { %>                        <ul class="first-group">                            <% if(editable) { %>                            <li><a href="#" class="edit-panels"><%- _("Edit Panels").t() %></a></li>                            <% } %>                            <% if (!isHTML || canEditHtml) { %>                            <li><a href="<%- editLinkViewMode %>"><%- _("Edit Source").t() %> <span class="dashboard-source-type"><%= dashboardType %></span></a></li>                            <% } %>                            <% if (isSimpleXML && canEditHtml) { %>                            <li><a href="#" class="convert-to-html"><%- _("Convert to HTML").t() %></a></li>                            <% } %>                        </ul>                        <% } %>                        <% if(isSimpleXML || canWrite) { %>                        <ul class="second-group">                            <% if(isSimpleXML && editable) { %>                            <li><a href="#" class="edit-title-desc"><%- _("Edit Title or Description").t() %></a></li>                            <% } %>                            <li><a href="#" class="edit-perms"><%- _("Edit Permissions").t() %></a></li>                            <% if(isSimpleXML && isPdfServiceAvailable) { %>                            <li><a class="schedule-pdf" href="#"><%- _("Schedule PDF Delivery").t() %></a></li>                            <% } %>                        </ul>                        <% } %>                        <% if ((!isHTML || canEditHtml) || (canWrite && removable)) { %>                        <ul class="third-group">                            <% if (!isHTML || canEditHtml) { %>                            <li><a href="#" class="clone"><%- _("Clone").t() %></a></li>                            <% } %>                            <% if(canWrite && removable) { %>                            <li><a href="#" class="delete"><%- _("Delete").t() %></a></li>                            <% } %>                        </ul>                        <% } %>                    </div><% } %><div class="btn-group">                    <% if(isSimpleXML && isPdfServiceAvailable) { %>                        <a class="btn generate-pdf" href="#"><i class="icon-export"></i></a>                    <% } %>                        <a class="btn print-dashboard" href="#"><i class="icon-print"></i></a>                    </div>                                    </span>                <span class="dashboard-edit-controls" style="display:none;">                    <div class="btn-group">                        <a class="btn add-panel" href="#"><i class="icon-plus"></i> <%- _("Add Panel").t() %></a>                         <% if(showAddTRP) { %>                        <a class="btn add-trp" href="#"><i class="icon-clock"></i> <%- _("Add Time Range Picker").t() %></a>                         <% } %>                        <a class="btn edit-source" href="<%- editLinkEditMode %>"><i class="icon-code"></i> <%- _("Edit Source").t() %></a>                     </div><a class="btn btn-primary edit-done" href="#"><%- _("Done").t() %></a>                </span>            '});return s.extend({className:"splunk-dashboard-controls",initialize:function(){s.prototype.initialize.apply(this,arguments),this.rolesCollection=new u,this.rolesCollection.fetch(),this.children.editMenu=new L({model:{state:this.model.state,dashboard:this.model.dashboard,application:this.model.application},collection:this.rolesCollection})},render:function(){return this.$el.append(this.children.editMenu.render().el),this}})}),define("splunkjs/mvc/simplexml/dragndrop",["require","backbone","underscore","jquery","util/console"],function(e){var t=e("backbone"),n=e("underscore"),r=e("jquery"),i=e("util/console"),s=r.Deferred(),o=document.createElement("div"),u="draggable"in o||"ondragstart"in o&&"ondrop"in o,a=!1,f=a?"sortable5":"sortable";return a?(i.log("loading html5 sortable"),e(["splunkjs/contrib/jquery.sortable.html5"],s.resolve)):(i.log("loading jquery ui sortable"),e(["jquery.ui.sortable"],s.resolve)),t.View.extend({render:function(){return s.done(this.startDragAndDrop.bind(this)),this},events:{"mouseover .drag-handle":function(e){r(e.target).parents(".dashboard-panel").addClass("drag-hover")},"mouseout .drag-handle":function(e){r(e.target).parents(".dashboard-panel").removeClass("drag-hover")}},startDragAndDrop:function(){this.$el.addClass("dragndrop-enabled"),n.defer(this.enableDragAndDrop.bind(this))},enableDragAndDrop:function(){var e=this,t,s=n.debounce(e.updateDimensions.bind(this),0),o=this.enableDragAndDrop.bind(this),u=n.once(function(){i.log("sort STOP");if(t){try{t[f]("destroy")}catch(s){}n.defer(o),e.trigger("sortupdate"),t=null,r(window).trigger("resize")}});this.createNewDropRow(),t=this.$(".dashboard-row")[f]({handle:".drag-handle",connectWith:this.$(".dashboard-row"),placeholder:{element:function(){return r('<div class="sortable-placeholder"><div class="dashboard-panel"></div></div>')},update:function(t,n){e.updateRow(n.parents(".dashboard-row"))}},tolerance:"pointer"}).on("sort",function(e){s()}).on("sortupdate",function(e){u()}).on("stop",function(e){u()}),s(),r(window).trigger("resize")},destroy:function(){this.$el.removeClass("dragndrop-enabled"),this.cleanupEmptyRows();try{this.$(".dashboard-row")[f]("destroy")}catch(e){}this.updateDimensions()},updateRow:function(e){var t=r(e).children().not(".ui-sortable-helper"),i=String(Math.floor(1e4/t.not(".sortable-dragging").length)/100)+"%";t.css({width:i});var s=r(e).find(".dashboard-panel");s.css({"min-height":100}).css({"min-height":n.max(n.map(s,function(e){return r(e).height()}))})},updateDimensions:function(){n(this.$(".dashboard-row")).each(this.updateRow)},createNewDropRow:function(){this.cleanupEmptyRows(),this.$(".dashboard-row").after(r('<div class="dashboard-row empty"></div>')),this.$(".dashboard-row").first().before(r('<div class="dashboard-row empty"></div>'))},cleanupEmptyRows:function(){this.$(".dashboard-row").each(function(){var e=r(this);(e.is(":empty")||e.html().match(/^\s+$/))&&e.remove()}),this.$(".dashboard-row.empty").removeClass("empty")},getItemOrder:function(){return n(this.$(".dashboard-row")).map(function(e){return n(r(e).find(".dashboard-panel")).map(function(e){return n(r(e).find(".dashboard-element")).map(function(e){return r(e).attr("id")})})})}})}),define("splunkjs/mvc/simpleform/fieldsetview",["require","exports","module","underscore","jquery","views/Base","../simplexml/controller"],function(e,t){var n=e("underscore"),r=e("jquery"),i=e("views/Base"),s=e("../simplexml/controller");return i.extend({moduleId:t.id,className:"fieldset",initialize:function(){s.on("formupdate",this.render,this),i.prototype.initialize.apply(this,arguments)},render:function(){return n.any(this.$el.find("label"),function(e){var t=r(e).text();return!!r.trim(t)})?this.$el.removeClass("hide-label"):this.$el.addClass("hide-label"),this}})}),define("splunkjs/mvc/simplexml/dashboard/title",["require","underscore","jquery","backbone"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=r.View.extend({initialize:function(){this.model.on("change:edit change:label",this.render,this)},render:function(){return this.model.has("label")||this.model.set({label:this.$el.text()},{silent:!0}),this.$(".edit-label").remove(),this.$el.text(t(this.model.get("label")).t()),this.model.get("edit")&&n('<span class="edit-label">'+t("Edit").t()+": </span>").prependTo(this.$el),this}});return i}),define("splunkjs/mvc/simplexml/dashboard/description",["require","underscore","backbone"],function(e){var t=e("underscore"),n=e("backbone");return n.View.extend({initialize:function(){this.listenTo(this.model,"change:description",this.render,this),this.listenTo(this.model,"change:edit",this.render,this)},render:function(){var e=t(this.model.get("description")||"").t(),n=this.model.get("edit");return this.$el.text(e)[e&&!n?"show":"hide"](),this}})}),define("splunkjs/mvc/simplexml/dashboard/row",["require","underscore","jquery","backbone"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone");return r.View.extend({events:{cellRemoved:"onContentChange"},initialize:function(){this.listenTo(this.model,"change:edit",this.onEditStateChange,this)},onEditStateChange:function(){this.$el.off("DOMSubtreeModified");if(!this.model.get("edit")&&this.$(".dashboard-panel").length>1){var e=t.debounce(this.alignItemHeights.bind(this),100);this.$el.bind("DOMSubtreeModified",e),e()}},onContentChange:function(){this.$el.off("DOMSubtreeModified");var e=this.$(".dashboard-cell");if(e.length===0)return this.remove();e.css({width:String(100/e.length)+"%"}),e.length>1&&this.alignItemHeights(),this.onEditStateChange()},alignItemHeights:function(){var e=this.$el,r=e.find(".dashboard-panel");r.css({"min-height":0}).css({"min-height":t.max(t.map(r,function(e){return n(e).height()}))})},render:function(){return this.onEditStateChange(),this}})}),define("splunkjs/mvc/simplexml/dashboard/panel",["require","jquery","backbone"],function(e){var t=e("jquery"),n=e("backbone");return n.View.extend({initialize:function(){this.listenTo(this.model,"change:edit",this.onEditStateChange,this)},onEditStateChange:function(e){e.get("edit")?(this._dragHandle||(this._dragHandle=t('<div class="drag-handle"><div class="handle-inner"></div></div>')),this._dragHandle.prependTo(this.el)):this._dragHandle&&this._dragHandle.detach()},render:function(){return this.onEditStateChange(this.model),this}})}),define("splunkjs/mvc/simplexml/dashboard",["require","../basesplunkview","backbone","../mvc","underscore","jquery","./controller","./editdashboard","./dragndrop","util/console","../simpleform/fieldsetview","./dashboard/title","./dashboard/description","./dashboard/row","./dashboard/panel"],function(e){var t=e("../basesplunkview"),n=e("backbone"),r=e("../mvc"),i=e("underscore"),s=e("jquery"),o=e("./controller"),u=e("./editdashboard"),a=e("./dragndrop"),f=e("util/console"),l=e("../simpleform/fieldsetview"),c=e("./dashboard/title"),h=e("./dashboard/description"),p=e("./dashboard/row"),d=e("./dashboard/panel"),v=t.extend({initialize:function(){this.model=o.getStateModel(),this.editControls=new u({model:{state:this.model,dashboard:this.model.view,application:this.model.app}}),this.model.on("change:edit",this.onEditStateChange,this)},render:function(){this.editControls.render().appendTo(this.$(".edit-dashboard-menu"));var e=this.model;this.rows=i.map(this.$(".dashboard-row"),function(t){return(new p({el:t,model:e})).render()}),this.titleView=(new c({model:this.model,el:this.$(".dashboard-header h2")})).render();var t=this.$("p.description");t.length||(t=s('<p class="description"></p>').appendTo(this.$(".dashboard-header")).hide()),this.descriptionView=(new h({el:t,model:e})).render();var n=this.$el.children(".fieldset");n.length||(n=s('<div class="fieldset"></div>').insertAfter(this.$(".dashboard-header"))),this.fieldsetView=(new l({el:n})).render();var r=s('<div class="edit-dashboard-menu pull-right"></div>').prependTo(this.$(".dashboard-header"));return this.editControls.render().appendTo(r),this.panels=i(this.$(".dashboard-panel")).map(function(t){return(new d({el:t,model:e})).render()}),this.onEditStateChange(),i.defer(function(){s("body").removeClass("preload")}),this.model.view.captureItemOrder(this.getItemOrder()),this},getController:function(){return o},getStateModel:function(){return this.model},getItemOrder:function(){return i(this.$(".dashboard-row")).map(function(e){return i(s(e).find(".dashboard-panel")).map(function(e){return i(s(e).find(".dashboard-element")).map(function(e){return s(e).attr("id")})})})},getElementIds:function(){return i.flatten(this.getItemOrder())},enterEditMode:function(){this.leaveEditMode(),this.model.get("editable")?(f.log("Entering edit mode"),this.dragnDrop=new a({el:this.el}),this.model.view.captureItemOrder(this.getItemOrder()),this.dragnDrop.on("sortupdate",i.debounce(this.updatePanelOrder,0),this),this.dragnDrop.render()):(f.log("Aborting edit mode: Dashboard is not editable"),this.model.set("edit",!1))},updatePanelOrder:function(){this.model.view.setItemOrder(this.getItemOrder())},leaveEditMode:function(){this.dragnDrop&&(this.dragnDrop.off(),this.dragnDrop.destroy(),this.updatePanelOrder(),this.dragnDrop=null)},onEditStateChange:function(){this.model.get("edit")?o.onViewModelLoad(this.enterEditMode,this):this.leaveEditMode()},removeElement:function(e){var t=this.$("#"+e).parents(".dashboard-cell"),n=t.parents(".dashboard-row");t.remove(),n.trigger("cellRemoved")},createNewElement:function(e){var t=s(i.template(this.rowTemplate,e));return t.appendTo(this.$el),this.rows.push((new p({el:t,model:this.model})).render()),this.panels.push((new d({el:t.find(".dashboard-panel"),model:this.model})).render()),t.find(".dashboard-element")},rowTemplate:'  <div class="dashboard-row">                            <div class="dashboard-cell" style="width: 100%;">                                <div class="dashboard-panel">                                    <div class="dashboard-element" id="<%= id %>">                                        <div class="panel-head"><h3><%- title %></h3></div>                                        <div class="panel-body"></div>                                    </div>                                </div>                            </div>                        </div>'});return v}),define("splunkjs/mvc/simplexml/element/table",["require","underscore","jquery","backbone","../../../mvc","./base","../../tableview","util/console","../mapper","splunk.util"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("../../../mvc"),s=e("./base"),o=e("../../tableview"),u=e("util/console"),a=e("../mapper"),f=e("splunk.util"),l=a.extend({tagName:"table",map:function(e,t,n){t.options.wrap=String(f.normalizeBoolean(e.get("display.statistics.wrap",n))),t.options.displayRowNumbers=String(f.normalizeBoolean(e.get("display.statistics.rowNumbers",n))),t.options.dataOverlayMode=e.get("display.statistics.overlay",n),t.options.drilldown=e.get("display.statistics.drilldown",n),t.options.labelField=null,t.options.valueField=null,t.tags={fields:e.get("display.statistics.fields",n)},t.options.drilldown===!1?delete t.options.drilldown:t.options.drilldown===!0&&(t.options.drilldown="row")}});a.register("statistics",l);var c=o.extend({prefix:"display.statistics.",reportDefaults:{"display.general.type":"statistics","display.statistics.count":10,"display.statistics.drilldown":"cell"},getResultsLinkOptions:function(e){return{}}});s.registerVisualization("statistics",c);var h=s.extend({initialVisualization:"statistics"});return h}),define("splunkjs/mvc/simplexml/element/chart",["require","underscore","jquery","backbone","../../../mvc","./base","../../chartview","../mapper","util/console"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("../../../mvc"),s=e("./base"),o=e("../../chartview"),u=e("../mapper"),a=e("util/console"),f="display.visualizations.charting.",l="display.visualizations.";u.register("visualizations:charting",u.extend({tagName:"chart",map:function(e,n,r){t(e.toJSON(r)).each(function(t,i){i.substring(0,f.length)===f&&(n.options[i.substring(l.length)]=e.get(i,r))}),r["charting.drilldown"]&&(n.removeOptions=["drilldown"])}}));var c=o.extend({reportDefaults:{"display.visualizations.show":!0,"display.visualizations.type":"charting","display.general.type":"visualizations"},getResultsLinkOptions:function(){return{}}});s.registerVisualization("visualizations:charting",c),s.registerVisualization("visualizations",c);var h=s.extend({initialVisualization:"visualizations:charting"});return h}),define("splunkjs/mvc/simplexml/element/event",["require","underscore","jquery","backbone","../../../mvc","./base","../../eventsviewerview","../mapper","util/console"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("../../../mvc"),s=e("./base"),o=e("../../eventsviewerview"),u=e("../mapper"),a=e("util/console"),f="display.events.",l=u.extend({tagName:"event",map:function(e,n,r){t(e.toJSON(r)).each(function(t,i){if(i.substring(0,f.length)===f){var s=e.get(i,r);n.options[i.substring(f.length)]=s!=null?String(s):null}})}});u.register("events:raw",l),u.register("events:list",l),u.register("events:table",l);var c=o.extend({reportDefaults:{"display.general.type":"events","display.events.count":10},getResultsLinkOptions:function(){return{}}});s.registerVisualization("events",c);var h=s.extend({initialVisualization:"events"});return h}),define("splunkjs/mvc/simplexml/element/single",["require","underscore","../../../mvc","./base","../../singleview","../mapper","util/console"],function(e){var t=e("underscore"),n=e("../../../mvc"),r=e("./base"),i=e("../../singleview"),s=e("../mapper"),o=e("util/console");s.register("visualizations:singleValue",s.extend({tagName:"single",map:function(e,n,r){var i="display.visualizations.singlevalue.";o.log(e.toJSON(r)),t(e.toJSON(r)).each(function(e,t){t.substring(0,i.length)===i&&(n.options[t.substring(i.length)]=e)}),o.log("single export options: ",n.options)}}));var u=i.extend({reportDefaults:{"display.visualizations.show":!0,"display.visualizations.type":"singleValue","display.general.type":"visualizations"},getResultsLinkOptions:function(e){return{"link.visible":!1}}});r.registerVisualization("visualizations:singleValue",u);var a=r.extend({initialVisualization:"visualizations:singleValue"});return a}),define("splunkjs/mvc/simplexml/element/map",["require","underscore","jquery","backbone","../../../mvc","./base","../../splunkmapview","../mapper","util/console"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("../../../mvc"),s=e("./base"),o=e("../../splunkmapview"),u=e("../mapper"),a=e("util/console"),f="display.visualizations.mapping.",l="display.visualizations.";u.register("visualizations:mapping",u.extend({tagName:"map",map:function(e,n,r){t(e.toJSON()).each(function(t,i){i.substring(0,f.length)===f&&(n.options[i.substring(l.length)]=e.get(i,r))})}}));var c=o.extend({options:t.extend({},o.prototype.options,{drilldown:!0}),reportDefaults:{"display.visualizations.show":!0,"display.visualizations.type":"mapping","display.general.type":"visualizations"},getResultsLinkOptions:function(){return{}}});s.registerVisualization("visualizations:mapping",c);var h=s.extend({initialVisualization:"visualizations:mapping",createPanelElementEditor:function(){}});return h}),define("splunkjs/mvc/simplexml/element/list",["require","underscore","jquery","backbone","../../../mvc","./base","util/console"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("../../../mvc"),s=e("./base"),o=e("util/console"),u=s.extend({initialVisualization:"statistics",constructor:function(e){return t.extend(e,{displayRowNumbers:!1,fields:[e.labelField||"",e.valueField||""],sortKey:e.initialSort||e.labelField,sortDirection:e.initialSortDir||"asc"}),o.log("[%o] Creating table with options: %o",e.id,e),s.prototype.constructor.call(this,e)}});return u}),define("splunkjs/mvc/simplexml/element/html",["require","underscore","jquery","backbone","../../../mvc","../../utils","./base","../controller","../../tokenutils","splunk.util"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("../../../mvc"),s=e("../../utils"),o=e("./base"),u=e("../controller"),a=e("../../tokenutils"),f=e("splunk.util"),l=o.extend({configure:function(){this.options.settingsOptions=t.extend({tokenEscaper:a.getEscaper("html")},this.options.settingsOptions||{}),o.prototype.configure.apply(this,arguments)},initialize:function(){this.configure(),this.model=new r.Model,this.reportReady=n.Deferred(),this.reportReady.resolve(this.model),this.model.mapToXML=t.bind(this.mapToXML,this),i.enableDynamicTokens(this.settings,s.escapeFn("html")),this.settings.on("change",this.render,this),this.listenTo(u.getStateModel(),"change:edit",this.onEditModeChange,this)},mapToXML:function(e,t,n){return{type:"html",content:this.settings.get("html",n),cdata:!0,attributes:{encoded:"1"}}},updateTitle:function(){this.$(".panel-head").remove(),u.isEditMode()&&n('<div class="panel-head"><h3><span class="untitled">&lt;HTML&gt;</span></h3></div>').prependTo(this.$el)},createPanelElementEditor:function(){},createRefreshTimeIndicator:function(){},render:function(){return this.$("script").remove(),this.settings.has("html")||this.settings.set("html",n.trim(this.$(".panel-body").html()),{tokens:!0}),this.$(".panel-body").html(this.settings.get("html")),this.$("a").each(function(){var e=n(this),t=e.attr("href");t&&t[0]==="/"&&t[1]!=="/"&&e.attr("href",f.make_url(t))}),this.onEditModeChange(u.getStateModel()),this},getExportParams:function(){return{}}});return l}),define("splunkjs/mvc/simplexml/urltokenmodel",["require","exports","module","../basetokenmodel","models/classicurl"],function(e,t,n){var r=e("../basetokenmodel"),i=e("models/classicurl"),s=r.extend({moduleId:n.id,initialize:function(){var e=this;i.on("change",function(t,n){e.set(t.changed)}),this.on("change",function(e,t){i.set(e.changed),i.save()}),this.set(i.attributes)}});return s}),define("splunkjs/mvc/postprocess",["require","exports","module","underscore","./mvc","./utils","./searchmanager","./basemanager","./searchmodel","./splunkresultsmodel","./settings"],function(e,t,n){function c(e,t){return t?[e.replace(/[\|\s]$/g,""),t.replace(/^[\|\s]/g,"")].join(" | "):e}var r=e("underscore"),i=e("./mvc"),s=e("./utils"),o=e("./searchmanager"),u=e("./basemanager"),a=e("./searchmodel"),f=e("./splunkresultsmodel"),l=e("./settings"),h=f.extend({_requestOptions:function(){var e=f.prototype._requestOptions.call(this),t=this.get("manager"),n=t.query.postProcessResolve();return n&&(e.search=c(n,e.search)),e}}),p=a.SearchQuery.extend({resolve:function(){var e=this._manager.parent.query.resolve(),t=a.SearchQuery.prototype.resolve.apply(this,arguments);return c(e,t)},postProcessResolve:function(){return a.SearchQuery.prototype.resolve.apply(this,arguments)}}),d=u.extend({moduleId:n.id,isPostProcess:!0,initialize:function(e,t){this.set(t||{}),i.Components.bind("change:"+e.manager,this.onManagerChange,this),i.Components.has(e.manager)&&this.onManagerChange(i.Components,i.Components.get(e.manager)),this.query=new p({search:this.get("postProcess")},t),this.query._manager=this,this.query.on("change",function(){this.trigger("change:data",this,this.job&&this.job.properties())},this)},onManagerChange:function(e,t){this.parent&&(this.parent.off(null,null,this),delete this.job),this.parent=t,this.search=this.parent.search,t.on("search:start",this.onSearchStart,this),t.on("all",this.trigger,this)},get:function(e){return this.parent&&this.parent.has(e)?this.parent.get(e):u.prototype.get.apply(this,arguments)},onSearchStart:function(e){this.job=e},data:function(e,t){return t=r.defaults({manager:this,source:e},t),new h(t)},replayLastSearchEvent:function(){this.parent&&this.parent.replayLastSearchEvent.apply(this.parent,arguments)}});return d}),define("splunkjs/mvc/simpleform/input/submit",["require","underscore","jquery","../../basesplunkview","../formtokens","../../mvc"],function(e){var t=e("underscore"),n=e("jquery"),r=e("../../basesplunkview"),i=e("../formtokens"),s=e("../../mvc"),o=r.extend({className:"splunk-submit-button",options:{text:t("Search").t(),useIcon:!1,submitType:undefined},events:{"click button":"onButtonClick"},initialize:function(){this.configure(),s.enableDynamicTokens(this.settings),this.settings.on("change",this.render,this),this.bindToComponent(this.options.formManager,this.onFormManagerChange,this)},onFormManagerChange:function(e,t){this.formModel&&this.formModel.off(null,null,this),this.formModel=t},onButtonClick:function(){this.formModel&&this.formModel.submit(this.options.submitType),i.submit(),this.trigger("submit",this)},render:function(){var e=this.$("button");return e.length||(e=n('<button class="btn btn-primary"></button>').appendTo(this.el)),this.settings.get("useIcon")?e.html('<i class="icon-search"></i>'):this.settings.has("text")?e.text(this.settings.get("text")):this.settings.set("text",e.text()),this}});return o}),define("splunkjs/mvc/simpleform/input/text",["require","underscore","jquery","./base","../../textboxview"],function(e){var t=e("underscore"),n=e("jquery"),r=e("./base"),i=e("../../textboxview"),s=r.extend({initialize:function(){var e=t.defaults({el:n('<div class="splunk-view"></div>').appendTo(this.el),id:t.uniqueId(this.id+"-input")},this.options);this.textbox=new i(e),this.textbox.on("change",this.handleChange,this),r.prototype.initialize.call(this),this.delegateEvents({"change input":"handleChange","keyup input":"checkEnterKey"})},getValue:function(){return this.textbox.val()},setValue:function(e){this.textbox.val(e)},render:function(){return this.renderLabel(),this.textbox.render(),this},_getWrappedView:function(){return this.textbox},checkEnterKey:function(e){e.keyCode===13&&this.sendSoftSubmit()}});return s}),define("splunkjs/mvc/simpleform/input/dropdown",["require","underscore","jquery","./base","../../selectview"],function(e){var t=e("underscore"),n=e("jquery"),r=e("./base"),i=e("../../selectview"),s=r.extend({initialize:function(){var e=t.defaults({el:n('<div class="splunk-view"></div>').appendTo(this.el),id:t.uniqueId(this.id+"-input")},this.options);this.select=new i(e),this.select.on("change",this.handleChange,this),r.prototype.initialize.call(this)},getValue:function(){return this.select.val()},setValue:function(e){this.select.val(e)},render:function(){return this.renderLabel(),this.select.render(),this},_getWrappedView:function(){return this.select}});return s}),define("splunkjs/mvc/simpleform/input/radio",["require","underscore","jquery","./base","../../radiogroupview"],function(e){var t=e("underscore"),n=e("jquery"),r=e("./base"),i=e("../../radiogroupview"),s=r.extend({events:{"change input":"handleChange"},initialize:function(){var e=t.defaults({el:n('<div class="splunk-view"></div>').appendTo(this.el),id:t.uniqueId(this.id+"-input")},this.options);this.radiogroup=new i(e),r.prototype.initialize.call(this)},getValue:function(){return this.radiogroup.val()},setValue:function(e){this.radiogroup.settings.set("default",e),this.radiogroup.val(e)},render:function(){return this.renderLabel(),this.radiogroup.render(),this},_getWrappedView:function(){return this.radiogroup}});return s}),define("splunkjs/mvc/simpleform/input",["require","./input/submit","./input/text","./input/dropdown","./input/radio","./input/timerange"],function(e){return{Submit:e("./input/submit"),Text:e("./input/text"),Dropdown:e("./input/dropdown"),Radio:e("./input/radio"),TimeRangePicker:e("./input/timerange")}}),define("splunkjs/mvc/simplexml",["require","./simplexml/controller","./simplexml/dashboard","./simplexml/element/table","./simplexml/element/chart","./simplexml/element/event","./simplexml/element/single","./simplexml/element/map","./simplexml/element/list","./simplexml/element/html","./simplexml/urltokenmodel","./searchmanager","./savedsearchmanager","./searchtemplate","./postprocess","./drilldown","./headerview","./footerview","./simpleform/formmanager","./simpleform/formtokens","./simpleform/input","./simpleform/input/submit","./simpleform/input/text","./simpleform/input/dropdown","./simpleform/input/radio","./simpleform/input/timerange","./utils"],function(e){e("./simplexml/controller"),e("./simplexml/dashboard"),e("./simplexml/element/table"),e("./simplexml/element/chart"),e("./simplexml/element/event"),e("./simplexml/element/single"),e("./simplexml/element/map"),e("./simplexml/element/list"),e("./simplexml/element/html"),e("./simplexml/urltokenmodel"),e("./searchmanager"),e("./savedsearchmanager"),e("./searchtemplate"),e("./postprocess"),e("./drilldown"),e("./headerview"),e("./footerview"),e("./simpleform/formmanager"),e("./simpleform/formtokens"),e("./simpleform/input"),e("./simpleform/input/submit"),e("./simpleform/input/text"),e("./simpleform/input/dropdown"),e("./simpleform/input/radio"),e("./simpleform/input/timerange"),e("./utils")});