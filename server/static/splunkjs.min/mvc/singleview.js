define("views/shared/SingleValue",["jquery","underscore","module","views/Base","splunk.util","uri/route"],function(e,t,n,r,i,s){var o=function(e,n){if(t.isFunction(e))try{e=e(n)}catch(r){return""}return e};return r.extend({moduleId:n.id,className:"single-value",initialize:function(e){r.prototype.initialize.apply(this,arguments),this.model.state.on("change:display.visualizations.singlevalue.beforeLabel change:display.visualizations.singlevalue.afterLabel change:display.visualizations.singlevalue.underLabel change:display.visualizations.singlevalue.additionalClass",this.debouncedRender,this),this.model.searchResultsColumn.on("change:fields",this.render,this)},getResultField:function(n){var r=e.extend(!0,[],this.model.searchResultsColumn.get("columns")),i=this.getFieldNames();t(r).each(function(e,t){e.push(i[t])}),i=t(i).filter(function(e){return e==="_time"||e.charAt(0)!="_"}),r=t(r).filter(function(e){return t.indexOf(i,e[e.length-1])>=0});for(var s=0;s<r.length;s++)if(r[s][1]===n)return r[s][0];return r[0]&&r[0][0]?r[0][0]:""},getFieldNames:function(){var n=this.model.searchResultsColumn.get("fields");return!n||n.length===0?[]:t.isObject(n[0])?t(n).pluck("name"):e.extend([],n)},setSeverity:function(){if(this.model.searchResultsColumn.get("fields")){var e=t(this.model.searchResultsColumn.get("fields")).pluck("name"),n=e.indexOf("range");n>-1&&this.$("span.single-result").addClass(this.model.searchResultsColumn.get("columns")[n][0])}},render:function(){var e=this.getResultField(this.model.state.get("display.visualizations.singlevalue.field")),t=this.compiledTemplate({extracted:e,beforeLabel:o(this.model.state.get("display.visualizations.singlevalue.beforeLabel")||"",e),afterLabel:o(this.model.state.get("display.visualizations.singlevalue.afterLabel")||"",e),underLabel:o(this.model.state.get("display.visualizations.singlevalue.underLabel")||"",e)}),n=[this.model.state.get("display.visualizations.singlevalue.additionalClass"),this.getResultField(this.model.state.get("display.visualizations.singlevalue.classField"))];return this.$el.addClass(n.join(" ")),this.$el.html(t),this.wrapLinks(),this.setSeverity(),this},wrapLinks:function(){var n=this.model.state.get("display.visualizations.singlevalue.linkFields")||"",r=this.model.state.get("display.visualizations.singlevalue.linkView"),o=this.model.state.get("display.visualizations.singlevalue.linkSearch"),u,a;r&&(r.charAt(0)==="/"?a=i.make_full_url(r,{q:o}):this.model.application?a=s.page(this.model.application.get("root"),this.model.application.get("locale"),this.model.application.get("app"),r,{data:{q:o}}):a=[r,i.propToQueryString({q:o})].join("?"),u=e("<a />").attr("href",a),t.each({beforelabel:"before-label",afterlabel:"after-label",underlabel:"under-label",result:"single-result"},function(e,t){n.indexOf(t)>-1&&r&&this.$("."+e).wrap(u)},this))},template:'                <span class="before-label">                    <%- beforeLabel %>                </span>                <span class="single-result">                    <%- extracted %>                </span>                <span class="after-label">                    <%- afterLabel %>                </span>                <br>                <span class="under-label">                    <%- underLabel %>                </span>            '})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("splunkjs/css/single-value.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,define("splunkjs/mvc/singleview",["require","exports","module","jquery","./mvc","./basesplunkview","./settings","views/shared/SingleValue","backbone","./utils","./messages","underscore","css!../css/single-value"],function(e,t,n){var r=e("jquery"),i=e("./mvc"),s=e("./basesplunkview"),o=e("./settings"),u=e("views/shared/SingleValue"),a=e("backbone"),f=e("./utils"),l=e("./messages"),c=e("underscore");e("css!../css/single-value");var h=s.extend({moduleId:n.id,className:"splunk-single",options:{data:"preview",beforeLabel:"",afterLabel:"",field:"",classField:""},omitFromSettings:["el","reportModel"],initialize:function(){this.configure(),i.enableDynamicTokens(this.settings),this.model=this.options.reportModel||new a.Model,this.settings._sync=f.syncModels(this.settings,this.model,{auto:!0,prefix:"display.visualizations.singlevalue.",include:["additionalClass","linkView","field","linkFields","classField","beforeLabel","afterLabel","underLabel","linkSearch"]}),this.results=new a.Model({columns:[],fields:[]});var e=f.getPageInfo();this.model.application=new a.Model({root:e.root,locale:e.locale,app:e.app,page:e.page}),this.bindToComponent(this.options.managerid,this._onManagerChange,this),this.settings.on("change",this.render,this)},_onManagerChange:function(e,t){this.manager&&(this.manager.off(null,null,this),this.manager=null),this.resultsModel&&(this.resultsModel.off(null,null,this),this.resultsModel=null),this._searchStatus=null,this._clearResults();if(!t)return;this.manager=t,t.on("search:start search:progress",this.onSearchProgress,this),t.on("search:done",this.onSearchDone,this),t.on("search:error",this.onSearchError,this),t.on("search:fail",this.onSearchFailed,this),this.resultsModel=this.manager.data(this.settings.get("data"),{output_mode:"json_cols",count:1,offset:0,show_empty_fields:"True"}),this.resultsModel.on("data",this._onDataUpdate,this),t.replayLastSearchEvent(this)},onSearchProgress:function(e){var t=((e||{}).content||{}).resultPreviewCount||0;this._searchStatus={state:"running",previewCount:t},this.render()},onSearchDone:function(e){var t=((e||{}).content||{}).resultPreviewCount||0;this._searchStatus={state:"done",previewCount:t},this.render()},onSearchError:function(e,t){var n=e;t&&t.data&&t.data.messages&&t.data.messages.length&&(n=c(t.data.messages).pluck("text").join("; ")),this._searchStatus={state:"error",message:n},this.render()},onSearchFailed:function(e){var t=c("The search failed.").t();e&&e.content&&e.content.messages&&(t=c(e.content.messages).pluck("text").join("; ")),this._searchStatus={state:"error",message:t},this.render()},_clearResults:function(){this.results.set({columns:null,fields:null},{unset:!0})},_onDataUpdate:function(){this.resultsModel.hasData()?this.results.set({columns:this.resultsModel.data().columns,fields:this.resultsModel.data().fields}):this._clearResults(),this.render()},render:function(){var e=this._searchStatus||null,t=e&&e.previewCount,n=t&&this.resultsModel&&this.resultsModel.hasData(),i=null;if(e)switch(e.state){case"running":t||(i="waiting");break;case"cancelled":i="cancelled";break;case"done":t?n||(i="waiting"):i="no-results";break;case"error":i={level:"warning",icon:"warning-sign",message:e.message}}return i?(this.messageElement||(this.messageElement=r('<div class="msg"></div>')),i==="waiting"?this.messageElement.addClass("waiting").html('<div class="single-value"><span class="single-result">&hellip;</span></div>'):i==="no-results"?this.messageElement.addClass("no-results").html('<div class="single-value"><span class="single-result">N/A</span></div>'):l.render(i,this.messageElement.removeClass("waiting")),this.$el.append(this.messageElement)):this.messageElement&&(this.messageElement.remove(),this.messageElement=null),e&&n&&!i?(this.singleValue||(this.singleValue=new u({model:{searchResultsColumn:this.results,state:this.model,application:this.model.application}})),this.singleValue.render().appendTo(this.el)):this.singleValue&&(this.singleValue.remove(),this.singleValue=null),this.trigger("rendered",this),this},remove:function(){this.singleValue&&this.singleValue.remove(),this.settings&&(this.settings.off(),this.settings._sync&&this.settings._sync.destroy()),s.prototype.remove.call(this)}});return h}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer('/*!\n * Splunk shoestrap\n * import and override bootstrap vars & mixins\n */\n.clearfix {\n  *zoom: 1;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.clearfix:after {\n  clear: both;\n}\n.hide-text {\n  font: 0/0 a;\n  color: transparent;\n  text-shadow: none;\n  background-color: transparent;\n  border: 0;\n}\n.input-block-level {\n  display: block;\n  width: 100%;\n  min-height: 26px;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.ie7-force-layout {\n  *min-width: 0;\n}\n/* component for displaying a single value with some annotations\n\n	<div class="single-value shared-singlevalue" data-view="views/shared/SingleValue">\n	    <span class="before-label">before</span>\n	    <span class="single-result">Single Value Result</span>\n	    <span class="after-label">after</span>\n	    <br>\n	    <span class="under-label">under</span>\n	</div>\n\n*/\n.single-value {\n  margin: 20px;\n  display: inline-block;\n  *display: inline;\n  /* IE7 inline-block hack */\n\n  *zoom: 1;\n  text-align: center;\n}\n.single-value .single-result {\n  font-size: 24px;\n  font-weight: bold;\n  word-wrap: break-word;\n}\n.single-value .under-label {\n  text-transform: uppercase;\n  color: #999;\n  font-size: 11px;\n}\n.single-value .severe {\n  color: #ff1f24;\n}\n.single-value .high {\n  color: #ff7e00;\n}\n.single-value .elevated {\n  color: #ffb800;\n}\n.single-value .guarded {\n  color: #4da6df;\n}\n.single-value .low {\n  color: #00b932;\n}\n.single-value .None {\n  color: #999;\n}\n.single-value.severe .single-result {\n  color: #ff1f24;\n}\n.single-value.high .single-result {\n  color: #ff7e00;\n}\n.single-value.elevated .single-result {\n  color: #ffb800;\n}\n.single-value.guarded .single-result {\n  color: #4da6df;\n}\n.single-value.low .single-result {\n  color: #00b932;\n}\n.single-value.None .single-result {\n  color: #999;\n}\n')}),requirejs.s.contexts._.nextTick=requirejs.nextTick;