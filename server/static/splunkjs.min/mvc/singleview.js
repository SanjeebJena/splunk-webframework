define("views/shared/SingleValue",["jquery","underscore","module","views/Base","splunk.util","uri/route"],function(e,t,n,r,i,s){var o=function(e,n){if(t.isFunction(e))try{e=e(n)}catch(r){return""}return e};return r.extend({moduleId:n.id,className:"single-value",initialize:function(e){r.prototype.initialize.apply(this,arguments),this.model.state.on("change:display.visualizations.singlevalue.beforeLabel change:display.visualizations.singlevalue.afterLabel change:display.visualizations.singlevalue.underLabel change:display.visualizations.singlevalue.additionalClass",this.debouncedRender,this),this.model.searchResultsColumn.on("change:fields",this.render,this)},getResultField:function(n){var r=e.extend(!0,[],this.model.searchResultsColumn.get("columns")),i=this.getFieldNames();t(r).each(function(e,t){e.push(i[t])}),i=t(i).filter(function(e){return e==="_time"||e==="_raw"||e.charAt(0)!="_"}),r=t(r).filter(function(e){return t.indexOf(i,e[e.length-1])>=0});if(!n)return n=i[0],r.length&&r[0].length?r[0][0]:t("N/A").t();for(var s=0;s<r.length;s++)if(r[s][r[s].length-1]===n)return r[s][0];return t("N/A").t()},getFieldNames:function(){var n=this.model.searchResultsColumn.get("fields");return!n||n.length===0?[]:t.isObject(n[0])?t(n).pluck("name"):e.extend([],n)},setSeverity:function(){if(this.model.searchResultsColumn.get("fields")){var e=t(this.model.searchResultsColumn.get("fields")).pluck("name"),n=e.indexOf("range");n>-1&&this.$("span.single-result").addClass(this.model.searchResultsColumn.get("columns")[n][0])}},render:function(){var e=this.getResultField(this.model.state.get("display.visualizations.singlevalue.field")),t=this.compiledTemplate({extracted:e,beforeLabel:o(this.model.state.get("display.visualizations.singlevalue.beforeLabel")||"",e),afterLabel:o(this.model.state.get("display.visualizations.singlevalue.afterLabel")||"",e),underLabel:o(this.model.state.get("display.visualizations.singlevalue.underLabel")||"",e)}),n=[this.model.state.get("display.visualizations.singlevalue.additionalClass"),this.getResultField(this.model.state.get("display.visualizations.singlevalue.classField"))];return this.$el.addClass(n.join(" ")),this.$el.html(t),this.wrapLinks(),this.setSeverity(),this},wrapLinks:function(){var n=this.model.state.get("display.visualizations.singlevalue.linkFields")||"",r=this.model.state.get("display.visualizations.singlevalue.linkView"),o=this.model.state.get("display.visualizations.singlevalue.linkSearch"),u,a;r&&o&&(r.charAt(0)==="/"?a=i.make_full_url(r,{q:o}):this.model.application?a=s.page(this.model.application.get("root"),this.model.application.get("locale"),this.model.application.get("app"),r,{data:{q:o}}):a=[r,i.propToQueryString({q:o})].join("?"),u=e("<a />").attr("href",a),t.each({beforelabel:"before-label",afterlabel:"after-label",underlabel:"under-label",result:"single-result"},function(e,t){n.indexOf(t)>-1&&r&&this.$("."+e).wrap(u)},this))},template:'                <span class="before-label">                    <%- beforeLabel %>                </span>                <span class="single-result">                    <%- extracted %>                </span>                <span class="after-label">                    <%- afterLabel %>                </span>                <br>                <span class="under-label">                    <%- underLabel %>                </span>            '})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("splunkjs/css/single-value.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,define("splunkjs/mvc/singleview",["require","exports","module","underscore","jquery","./mvc","./basesplunkview","./settings","views/shared/SingleValue","backbone","./utils","./messages","./tokenawaremodel","css!../css/single-value"],function(e,t,n){var r=e("underscore"),i=e("jquery"),s=e("./mvc"),o=e("./basesplunkview"),u=e("./settings"),a=e("views/shared/SingleValue"),f=e("backbone"),l=e("./utils"),c=e("./messages"),h=e("./tokenawaremodel");e("css!../css/single-value");var p=o.extend({moduleId:n.id,className:"splunk-single",options:{data:"preview",beforeLabel:"",afterLabel:"",field:"",classField:"",linkView:"search"},omitFromSettings:["el","reportModel"],initialize:function(){this.configure(),this.model=this.options.reportModel||h._createReportModel(),this.settings._sync=l.syncModels(this.settings,this.model,{auto:!0,prefix:"display.visualizations.singlevalue.",include:["additionalClass","linkView","field","linkFields","classField","beforeLabel","afterLabel","underLabel","linkSearch"]}),this.results=new f.Model({columns:[],fields:[]});var e=l.getPageInfo();this.model.application=new f.Model({root:e.root,locale:e.locale,app:e.app,page:e.page}),this.bindToComponentSetting("managerid",this._onManagerChange,this),this.settings.on("change",this.render,this),this.manager||this._onManagerChange(s.Components,null)},_onManagerChange:function(e,t){this.manager&&(this.manager.off(null,null,this),this.manager=null),this.resultsModel&&(this.resultsModel.off(null,null,this),this.resultsModel=null),this._searchStatus=null,this._clearResults();if(!t){this._searchStatus={state:"nomanager"},this.render();return}this._searchStatus={state:"start"},this.manager=t,t.on("search:start search:progress",this.onSearchProgress,this),t.on("search:done",this.onSearchDone,this),t.on("search:error",this.onSearchError,this),t.on("search:fail",this.onSearchFailed,this),this.resultsModel=this.manager.data(this.settings.get("data"),{output_mode:"json_cols",count:1,offset:0,show_empty_fields:"True"}),this.resultsModel.on("data",this._onDataUpdate,this),this.resultsModel.on("error",this.onSearchError,this);var n=t.replayLastSearchEvent(this);n||this.render()},onSearchProgress:function(e){var t=((e||{}).content||{}).resultPreviewCount||0;this._searchStatus={state:"running",previewCount:t},this.render()},onSearchDone:function(e){var t=((e||{}).content||{}).resultPreviewCount||0;this._searchStatus={state:"done",previewCount:t},this.render()},onSearchError:function(e,t){var n=c.getSearchErrorMessage(t)||e;this._searchStatus={state:"error",message:n},this.render()},onSearchFailed:function(e){var t=c.getSearchFailureMessage(e);this._searchStatus={state:"error",message:t},this.render()},_clearResults:function(){this.results.set({columns:null,fields:null},{unset:!0})},_onDataUpdate:function(){this.resultsModel.hasData()?this.results.set({columns:this.resultsModel.data().columns,fields:this.resultsModel.data().fields}):(this._clearResults(),this._searchStatus&&(this._searchStatus.previewCount=0)),this.render()},render:function(){var e=this._searchStatus||null,t=e&&e.previewCount,n=t&&this.resultsModel&&this.resultsModel.hasData(),r=null;if(e)switch(e.state){case"nomanager":r="no-search";break;case"start":r="empty";break;case"running":t||(r="waiting");break;case"cancelled":r="cancelled";break;case"done":t?n||(r="waiting"):r="no-results";break;case"error":r={level:"error",icon:"warning-sign",message:e.message}}return r?(this.messageElement||(this.messageElement=i('<div class="msg"></div>')),r==="waiting"?this.messageElement.addClass("waiting").html('<div class="single-value"><span class="single-result">&hellip;</span></div>'):r==="no-results"?this.messageElement.addClass("no-results").html('<div class="single-value"><span class="single-result">N/A</span></div>'):c.render(r,this.messageElement.removeClass("waiting")),this.$el.append(this.messageElement)):this.messageElement&&(this.messageElement.remove(),this.messageElement=null),e&&n&&!r?(this.singleValue||(this.singleValue=new a({model:{searchResultsColumn:this.results,state:this.model,application:this.model.application}})),this.singleValue.render().appendTo(this.el)):this.singleValue&&(this.singleValue.remove(),this.singleValue=null),this.trigger("rendered",this),this},remove:function(){this.singleValue&&this.singleValue.remove(),this.settings&&(this.settings.off(),this.settings._sync&&this.settings._sync.destroy()),o.prototype.remove.call(this)}});return p}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer('.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:"";line-height:0;}\n.clearfix:after{clear:both;}\n.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}\n.input-block-level{display:block;width:100%;min-height:26px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}\n.ie7-force-layout{*min-width:0;}\n.single-value{margin:20px;display:inline-block;*display:inline;*zoom:1;text-align:center;}.single-value .single-result{font-size:24px;font-weight:bold;word-wrap:break-word;}\n.single-value .before-label{margin-right:1em;}\n.single-value .after-label{margin-left:1em;}\n.single-value .under-label{text-transform:uppercase;color:#999999;font-size:11px;}\n.single-value .severe,.single-value.severe .single-result{color:#d85d3c;}\n.single-value .high,.single-value.high .single-result{color:#f7902b;}\n.single-value .elevated,.single-value.elevated .single-result{color:#fac51c;}\n.single-value .guarded,.single-value.guarded .single-result{color:#6ab7c7;}\n.single-value .low,.single-value.low .single-result{color:#65a637;}\n.single-value .None,.single-value.None .single-result{color:#999999;}\n')}),requirejs.s.contexts._.nextTick=requirejs.nextTick;